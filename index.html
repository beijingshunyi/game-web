<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸‡èŠ±æ¶ˆæ¶ˆä¹</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            padding: 10px;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            position: relative;
        }
        /* é¦–é¡µæ ·å¼ */
        .home-page {
            padding: 20px 15px;
            text-align: center;
        }
        .game-logo {
            font-size: 36px;
            font-weight: 800;
            margin-bottom: 15px;
            background: linear-gradient(to right, #6a11cb, #2575fc);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(106, 17, 203, 0.3);
        }
        .player-info {
            display: flex;
            justify-content: space-around;
            background: rgba(106, 17, 203, 0.1);
            padding: 12px;
            border-radius: 15px;
            margin: 15px 0;
        }
        .info-item {
            text-align: center;
        }
        .info-value {
            font-size: 20px;
            font-weight: 700;
            color: #6a11cb;
        }
        .info-label {
            font-size: 12px;
            color: #666;
        }
        .start-button {
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 30px;
            margin: 15px 0;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(106, 17, 203, 0.4);
            transition: all 0.3s ease;
            width: 80%;
            max-width: 300px;
        }
        .start-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(106, 17, 203, 0.6);
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 25px 0;
        }
        .feature-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 15px;
            padding: 20px 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(106, 17, 203, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(to right, #6a11cb, #2575fc);
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(106, 17, 203, 0.25);
            background: linear-gradient(135deg, #ffffff 0%, #f0f2ff 100%);
        }
        .feature-card.ranking {
            background: linear-gradient(135deg, #fff9c4 0%, #ffd54f 100%);
        }
        .feature-card.ranking::before {
            background: linear-gradient(to right, #fbc02d, #ff8f00);
        }
        .feature-card.achievements {
            background: linear-gradient(135deg, #c8e6c9 0%, #81c784 100%);
        }
        .feature-card.achievements::before {
            background: linear-gradient(to right, #388e3c, #1b5e20);
        }
        .feature-card.shop {
            background: linear-gradient(135deg, #bbdefb 0%, #64b5f6 100%);
        }
        .feature-card.shop::before {
            background: linear-gradient(to right, #1976d2, #0d47a1);
        }
        .feature-card.checkin {
            background: linear-gradient(135deg, #ffcdd2 0%, #e57373 100%);
        }
        .feature-card.checkin::before {
            background: linear-gradient(to right, #d32f2f, #b71c1c);
        }
        .feature-icon {
            font-size: 32px;
            margin-bottom: 12px;
            text-align: center;
            background: linear-gradient(to right, #6a11cb, #2575fc);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .feature-card.ranking .feature-icon {
            background: linear-gradient(to right, #fbc02d, #ff8f00);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .feature-card.achievements .feature-icon {
            background: linear-gradient(to right, #388e3c, #1b5e20);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .feature-card.shop .feature-icon {
            background: linear-gradient(to right, #1976d2, #0d47a1);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .feature-card.checkin .feature-icon {
            background: linear-gradient(to right, #d32f2f, #b71c1c);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .feature-title {
            font-weight: 700;
            margin-bottom: 8px;
            font-size: 16px;
            color: #333;
            text-align: center;
        }
        .feature-desc {
            font-size: 12px;
            color: #6a11cb;
            text-align: center;
            font-weight: 500;
        }
        .feature-card.ranking .feature-desc {
            color: #f57f17;
        }
        .feature-card.achievements .feature-desc {
            color: #1b5e20;
        }
        .feature-card.shop .feature-desc {
            color: #0d47a1;
        }
        .feature-card.checkin .feature-desc {
            color: #b71c1c;
        }
        /* åº•éƒ¨ä¿¡æ¯ */
        .footer-info {
            text-align: center;
            padding: 15px 10px;
            font-size: 11px;
            color: #666;
            border-top: 1px solid #eee;
            margin-top: 15px;
        }
        .footer-info a {
            color: #6a11cb;
            text-decoration: none;
        }
        .footer-info a:hover {
            text-decoration: underline;
        }
        /* é¦–é¡µæ¬¢è¿åŒºåŸŸ */
        .welcome-section {
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            color: white;
            padding: 20px 15px;
            border-radius: 15px;
            margin: 15px 0;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }
        .welcome-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        .welcome-subtitle {
            font-size: 14px;
            margin-bottom: 15px;
            opacity: 0.9;
        }
        .decoration {
            position: absolute;
            font-size: 20px;
            opacity: 0.2;
        }
        .dec-1 { top: 8px; left: 8px; }
        .dec-2 { top: 8px; right: 8px; }
        .dec-3 { bottom: 8px; left: 8px; }
        .dec-4 { bottom: 8px; right: 8px; }
        .game-stats {
            display: flex;
            justify-content: space-around;
            background: rgba(255, 255, 255, 0.2);
            padding: 12px;
            border-radius: 15px;
            margin: 15px 0;
        }
        .stat-item {
            text-align: center;
        }
        .stat-value {
            font-size: 18px;
            font-weight: 700;
        }
        .stat-label {
            font-size: 11px;
            opacity: 0.8;
        }
        /* ç”¨æˆ·ä¸ªäººä¿¡æ¯æ ·å¼ */
        .user-profile {
            display: flex;
            align-items: center;
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
            padding: 15px;
            border-radius: 15px;
            margin: 15px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff9a9e, #fad0c4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #6a11cb;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            margin-right: 15px;
            font-size: 14px;
        }
        .user-details {
            flex: 1;
        }
        .user-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        .user-id {
            font-size: 12px;
            opacity: 0.9;
        }
        .user-coins {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
        }
        .coin-icon {
            margin-right: 5px;
            font-size: 18px;
        }
        .coin-amount {
            font-size: 18px;
        }
        /* æ¸¸æˆé¡µé¢æ ·å¼ */
        .game-page {
            display: none;
        }
        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .header {
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff9a9e, #fad0c4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #6a11cb;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            font-size: 14px;
        }
        .coins {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 20px;
        }
        .coin-icon {
            color: gold;
            font-size: 16px;
        }
        .coin-count {
            font-weight: 600;
            font-size: 14px;
        }
        .nav-buttons {
            display: flex;
            gap: 8px;
        }
        .nav-button {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            color: #6a11cb;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
            position: relative;
            font-size: 16px;
            font-weight: bold;
        }
        .nav-button:hover {
            background: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        .nav-button .button-label {
            position: absolute;
            bottom: -20px;
            font-size: 10px;
            white-space: nowrap;
            color: white;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }
        /* æ¸¸æˆåŒºåŸŸ */
        .game-area {
            padding: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .level-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 400px;
            margin-bottom: 12px;
            font-weight: 600;
            color: #6a11cb;
            font-size: 14px;
            background: rgba(106, 17, 203, 0.1);
            padding: 8px 12px;
            border-radius: 12px;
        }
        .move-timer {
            color: #6a11cb;
            font-weight: bold;
        }
        .progress-container {
            width: 100%;
            max-width: 400px;
            height: 12px;
            background: #e0e0e0;
            border-radius: 10px;
            margin-bottom: 12px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, #6a11cb, #2575fc);
            border-radius: 10px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(106, 17, 203, 0.5);
        }
        .game-board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 4px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border: 3px solid #6a11cb;
            border-radius: 12px;
            padding: 8px;
            max-width: 100%;
            width: 100%;
            margin: 0 auto;
            touch-action: manipulation;
            position: relative;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
        }
        .game-cell {
            aspect-ratio: 1;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        .game-cell::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 50%);
            border-radius: 10px;
            z-index: 1;
        }
        .game-cell > * {
            position: relative;
            z-index: 2;
        }
        .game-cell.special {
            animation: pulse 1.5s infinite;
        }
        .game-cell.selected {
            transform: scale(0.9);
            box-shadow: 0 0 0 3px #6a11cb, 0 0 15px rgba(106, 17, 203, 0.6);
            z-index: 10;
        }
        .game-cell.matched {
            animation: matched 0.5s ease forwards;
        }
        .game-cell.falling {
            transition: transform 0.3s ease;
        }
        /* ç‰¹æ®Šæ–¹å—æ ·å¼ */
        .game-cell.special.bomb {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            animation: pulse 1.5s infinite;
        }
        .game-cell.special.rainbow {
            background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
            animation: rainbow 2s infinite;
        }
        @keyframes rainbow {
            0% { background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%); }
            16% { background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%); }
            33% { background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%); }
            50% { background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); }
            66% { background: linear-gradient(135deg, #a6c0fe 0%, #f68084 100%); }
            83% { background: linear-gradient(135deg, #fccb90 0%, #d57eeb 100%); }
            100% { background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%); }
        }
        /* éšœç¢ç‰©æ ·å¼ */
        .ice {
            background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%);
            border: 2px solid #4dd0e1;
            box-shadow: 0 0 10px rgba(77, 208, 225, 0.5);
        }
        .lock {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            border: 2px solid #9c27b0;
            box-shadow: 0 0 10px rgba(156, 39, 176, 0.5);
        }
        .stone {
            background: linear-gradient(135deg, #e0e0e0 0%, #bdbdbd 100%);
            border: 2px solid #616161;
            box-shadow: 0 0 10px rgba(97, 97, 97, 0.5);
        }
        .time-bomb {
            background: linear-gradient(135deg, #ffcdd2 0%, #ef5350 100%);
            border: 2px solid #f44336;
            animation: pulse 1s infinite;
            box-shadow: 0 0 15px rgba(244, 67, 54, 0.7);
        }
        /* é“å…·æ  */
        .tools-bar {
            display: flex;
            justify-content: space-around;
            width: 100%;
            max-width: 400px;
            margin: 15px 0;
            background: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        .tool-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }
        .tool-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            margin-bottom: 8px;
            position: relative;
            transition: all 0.3s ease;
        }
        .tool-icon:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        .tool-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4757;
            color: white;
            font-size: 10px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .tool-name {
            font-size: 11px;
            color: #666;
        }
        /* åº•éƒ¨åŠŸèƒ½åŒº */
        .footer {
            padding: 12px;
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }
        .action-button {
            padding: 10px 15px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(106, 17, 203, 0.4);
            font-size: 13px;
            min-width: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        .action-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(106, 17, 203, 0.6);
        }
        .action-button:active {
            transform: translateY(-1px);
        }
        .action-button:disabled {
            background: #cccccc;
            transform: none;
            box-shadow: none;
            cursor: not-allowed;
        }
        /* å¼¹çª—æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 20px;
            max-width: 90%;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: modalAppear 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        .modal-content.ranking-modal {
            background: linear-gradient(135deg, #fff9c4 0%, #ffd54f 100%);
        }
        .modal-content.achievements-modal {
            background: linear-gradient(135deg, #c8e6c9 0%, #81c784 100%);
        }
        .modal-content.shop-modal {
            background: linear-gradient(135deg, #bbdefb 0%, #64b5f6 100%);
        }
        .modal-content.checkin-modal {
            background: linear-gradient(135deg, #ffcdd2 0%, #e57373 100%);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(106, 17, 203, 0.2);
        }
        .modal-content.ranking-modal .modal-header {
            border-bottom: 2px solid rgba(245, 127, 23, 0.3);
        }
        .modal-content.achievements-modal .modal-header {
            border-bottom: 2px solid rgba(27, 94, 32, 0.3);
        }
        .modal-content.shop-modal .modal-header {
            border-bottom: 2px solid rgba(13, 71, 161, 0.3);
        }
        .modal-content.checkin-modal .modal-header {
            border-bottom: 2px solid rgba(183, 28, 28, 0.3);
        }
        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: #6a11cb;
        }
        .modal-content.ranking-modal .modal-title {
            color: #f57f17;
        }
        .modal-content.achievements-modal .modal-title {
            color: #1b5e20;
        }
        .modal-content.shop-modal .modal-title {
            color: #0d47a1;
        }
        .modal-content.checkin-modal .modal-title {
            color: #b71c1c;
        }
        .close-button {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #999;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        .close-button:hover {
            background: rgba(0, 0, 0, 0.1);
            color: #666;
        }
        .modal-buttons {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }
        .modal-button {
            padding: 10px 15px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        .primary-button {
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
            box-shadow: 0 4px 15px rgba(106, 17, 203, 0.4);
        }
        .primary-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(106, 17, 203, 0.6);
        }
        /* é“å…·å•†åº— */
        .tools-shop {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        .tool-shop-item {
            background: white;
            border-radius: 15px;
            padding: 15px 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(106, 17, 203, 0.1);
        }
        .tool-shop-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(to right, #6a11cb, #2575fc);
        }
        .tool-shop-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        .tool-shop-icon {
            font-size: 36px;
            margin-bottom: 8px;
        }
        .tool-shop-name {
            font-weight: 700;
            margin-bottom: 5px;
            font-size: 15px;
            color: #333;
        }
        .tool-shop-price {
            color: gold;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 16px;
            background: linear-gradient(to right, #FFD700, #FFA500);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .ranking-coins {
            font-weight: 700;
            color: gold;
            font-size: 14px;
            background: linear-gradient(to right, #FFD700, #FFA500);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        /* ç­¾åˆ°å¼¹çª— */
        .sign-in-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        .sign-in-modal h2 {
            font-size: 24px;
            margin-bottom: 15px;
            text-align: center;
        }
        .sign-in-modal p {
            font-size: 16px;
            margin-bottom: 10px;
            text-align: center;
        }
        .sign-in-modal button {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
        }
        .sign-in-modal button:hover {
            background-color: #0056b3;
        }
        /* éšè—æ»šåŠ¨æ¡ */
        .sign-in-modal::-webkit-scrollbar {
            display: none;
        }
        .sign-in-modal {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* æˆå°±ç³»ç»Ÿ */
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        .achievement-item {
            background: white;
            border-radius: 12px;
            padding: 12px 8px;
            text-align: center;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(106, 17, 203, 0.1);
        }
        .achievement-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(to right, #6a11cb, #2575fc);
        }
        .achievement-item.locked {
            opacity: 0.6;
            background: #f5f5f5;
        }
        .achievement-item.locked::before {
            background: #ccc;
        }
        .achievement-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }
        .achievement-name {
            font-size: 12px;
            font-weight: 600;
            color: #333;
        }
        .achievement-item.locked .achievement-name {
            color: #999;
        }
        /* æ’è¡Œæ¦œ */
        .ranking-list {
            max-height: 60vh;
            overflow-y: auto;
            padding-right: 5px;
        }
        .ranking-list::-webkit-scrollbar {
            width: 6px;
        }
        .ranking-list::-webkit-scrollbar-thumb {
            background: #6a11cb;
            border-radius: 3px;
        }
        .ranking-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 10px;
            background: white;
            border-radius: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(106, 17, 203, 0.1);
        }
        .ranking-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: linear-gradient(to bottom, #6a11cb, #2575fc);
        }
        .ranking-item.top-1 {
            background: linear-gradient(135deg, #fff9c4 0%, #ffd54f 100%);
            box-shadow: 0 5px 15px rgba(245, 127, 23, 0.3);
        }
        .ranking-item.top-1::before {
            background: linear-gradient(to bottom, #fbc02d, #ff8f00);
        }
        .ranking-item.top-2 {
            background: linear-gradient(135deg, #e0e0e0 0%, #9e9e9e 100%);
            box-shadow: 0 5px 15px rgba(158, 158, 158, 0.3);
        }
        .ranking-item.top-2::before {
            background: linear-gradient(to bottom, #9e9e9e, #616161);
        }
        .ranking-item.top-3 {
            background: linear-gradient(135deg, #ffcc80 0%, #ffa726 100%);
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.3);
        }
        .ranking-item.top-3::before {
            background: linear-gradient(to bottom, #fb8c00, #ef6c00);
        }
        .ranking-position {
            font-weight: 800;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
            font-size: 14px;
        }
        .ranking-item.top-1 .ranking-position {
            background: linear-gradient(to right, #fbc02d, #ff8f00);
        }
        .ranking-item.top-2 .ranking-position {
            background: linear-gradient(to right, #9e9e9e, #616161);
        }
        .ranking-item.top-3 .ranking-position {
            background: linear-gradient(to right, #fb8c00, #ef6c00);
        }
        .ranking-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff9a9e, #fad0c4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin: 0 12px;
            font-size: 16px;
            color: #6a11cb;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .ranking-info {
            flex: 1;
            text-align: left;
        }
        .ranking-name {
            font-weight: 700;
            font-size: 15px;
            margin-bottom: 3px;
            color: #333;
        }
        .ranking-coins {
            font-weight: 700;
            color: gold;
            font-size: 14px;
            background: linear-gradient(to right, #FFD700, #FFA500);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        /* ç­¾åˆ°å¼¹çª— */
        .checkin-content {
            padding: 15px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin: 15px 0;
            border: 1px solid rgba(106, 17, 203, 0.1);
        }
        .checkin-title {
            font-size: 18px;
            font-weight: 700;
            color: #b71c1c;
            margin-bottom: 15px;
        }
        .checkin-info {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }
        .checkin-item {
            text-align: center;
        }
        .checkin-label {
            font-size: 13px;
            color: #666;
            margin-bottom: 5px;
        }
        .checkin-value {
            font-size: 18px;
            font-weight: 700;
            color: #b71c1c;
        }
        .checkin-reward {
            background: linear-gradient(135deg, #ffcdd2 0%, #e57373 100%);
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
            text-align: center;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        }
        .checkin-reward-text {
            font-size: 16px;
            font-weight: 700;
            color: #b71c1c;
            margin-bottom: 10px;
        }
        .checkin-reward-amount {
            font-size: 24px;
            font-weight: 800;
            color: gold;
            background: linear-gradient(to right, #FFD700, #FFA500);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 500px) {
            .header {
                padding: 10px;
            }
            
            .game-board {
                max-width: 100%;
            }
            
            .footer {
                padding: 10px;
                gap: 8px;
            }
            
            .action-button {
                padding: 8px 12px;
                font-size: 12px;
                min-width: 70px;
            }
            
            .game-logo {
                font-size: 32px;
            }
            
            .welcome-title {
                font-size: 18px;
            }
            
            .welcome-subtitle {
                font-size: 13px;
            }
        }
        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .pop {
            animation: pop 0.3s ease;
        }
        @keyframes firework {
            0% { transform: translate(0, 0); opacity: 1; }
            100% { transform: translate(var(--x), var(--y)); opacity: 0; }
        }
        .firework-particle {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            pointer-events: none;
            animation: firework 1s ease-out forwards;
        }
        @keyframes matched {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
            100% { transform: scale(0); opacity: 0; }
        }
        @keyframes fall {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(0); }
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        @keyframes modalAppear {
            0% { transform: scale(0.7); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        /* æ¸¸æˆæ¬¢è¿æç¤º */
        .game-welcome {
            text-align: center;
            padding: 10px;
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
            font-weight: 600;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¦–é¡µ -->
        <div class="home-page" id="home-page">
            <div class="welcome-section">
                <div class="decoration dec-1 floating floating-1">ğŸ¬</div>
                <div class="decoration dec-2 floating floating-2">ğŸ­</div>
                <div class="decoration dec-3 floating floating-3">ğŸ«</div>
                <div class="decoration dec-4 floating floating-4">ğŸ§</div>
                <div class="welcome-title">æ¬¢è¿æ¥åˆ°ä¸‡èŠ±æ¶ˆæ¶ˆä¹</div>
                <div class="welcome-subtitle">æŒ‘æˆ˜ä½ çš„æ¶ˆé™¤æŠ€å·§ï¼Œæ”¶é›†ä¸‡èŠ±å¸ï¼Œè§£é”æˆå°±</div>
            </div>
            
            <!-- æ·»åŠ ä¸ªäººä¿¡æ¯åŒºåŸŸ -->
            <div class="user-profile">
                <div class="user-avatar">
                    <div class="avatar-icon">ç©å®¶æœ‹å‹</div>
                </div>
                <div class="user-details">
                    <div class="user-name">ç©å®¶æœ‹å‹</div>
                    <div class="user-id">ID: <span id="user-id-display">-</span></div>
                </div>
                <div class="user-coins">
                    <span class="coin-icon">ğŸª™</span>
                    <span class="coin-amount" id="home-user-coins">20</span>
                </div>
            </div>
            
            <div class="game-stats">
                <div class="stat-item">
                    <div class="stat-value">6000</div>
                    <div class="stat-label">ç²¾å½©å…³å¡</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">50+</div>
                    <div class="stat-label">ç‹¬ç‰¹é“å…·</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">âˆ</div>
                    <div class="stat-label">æ— å°½ä¹è¶£</div>
                </div>
            </div>
            
            <div class="player-info">
                <div class="info-item">
                    <div class="info-value" id="home-coins">20</div>
                    <div class="info-label">ä¸‡èŠ±å¸</div>
                </div>
                <div class="info-item">
                    <div class="info-value" id="home-level">1</div>
                    <div class="info-label">å½“å‰å…³å¡</div>
                </div>
                <div class="info-item">
                    <div class="info-value" id="home-achievements">3</div>
                    <div class="info-label">æˆå°±</div>
                </div>
            </div>
            
            <button class="start-button" id="start-game">å¼€å§‹æ¸¸æˆ</button>
            
            <div class="feature-grid">
                <div class="feature-card" onclick="openModal('ranking-modal')">
                    <div class="feature-icon">ğŸ†</div>
                    <div class="feature-title">æ’è¡Œæ¦œ</div>
                    <div class="feature-desc">æŸ¥çœ‹ç©å®¶æ’å</div>
                </div>
                <div class="feature-card" onclick="openModal('achievements-modal')">
                    <div class="feature-icon">â­</div>
                    <div class="feature-title">æˆå°±ç³»ç»Ÿ</div>
                    <div class="feature-desc">è§£é”æ¸¸æˆæˆå°±</div>
                </div>
                <div class="feature-card" onclick="openModal('shop-modal')">
                    <div class="feature-icon">ğŸ›’</div>
                    <div class="feature-title">é“å…·å•†åº—</div>
                    <div class="feature-desc">è´­ä¹°æ¸¸æˆé“å…·</div>
                </div>
                <div class="feature-card" onclick="openModal('checkin-modal')">
                    <div class="feature-icon">ğŸ“…</div>
                    <div class="feature-title">æ¯æ—¥ç­¾åˆ°</div>
                    <div class="feature-desc">é¢†å–ç­¾åˆ°å¥–åŠ±</div>
                </div>
                <div class="feature-card" onclick="openModal('withdraw-modal')">
                    <div class="feature-icon">ğŸ’°</div>
                    <div class="feature-title">æç°</div>
                    <div class="feature-desc">ä¸‡èŠ±å¸æç°</div>
                </div>
            </div>
            
            <div class="footer-info">
                <p>æœ¬æ¸¸æˆç”±åŒ—äº¬ä¿®è½¦ã€ä¸‡èŠ±æ¥¼ã€‘èµåŠ©ï¼›ç”± <a href="https://t.me/bjxc010" target="_blank">@bjxc010</a> å¼€å‘</p>
                <p>Â© 2025 ä¸‡èŠ±æ¥¼ - æ¶ˆæ¶ˆä¹ ç‰ˆæƒæ‰€æœ‰</p>
            </div>
        </div>
        <!-- æ¸¸æˆé¡µé¢ -->
        <div class="game-page" id="game-page">
            <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
            <div class="header">
                <div class="user-info">
                    <div class="avatar">ç©å®¶æœ‹å‹</div>
                    <div class="coins">
                        <span class="coin-icon">ğŸª™</span>
                        <span class="coin-count" id="coin-count">20</span>
                    </div>
                </div>
                <div class="nav-buttons">
                    <button class="nav-button" id="checkin-btn" title="ç­¾åˆ°">
                        ğŸ“…
                        <span class="button-label">ç­¾åˆ°</span>
                    </button>
                    <button class="nav-button" id="ranking-btn" title="æ’è¡Œæ¦œ">
                        ğŸ†
                        <span class="button-label">æ’è¡Œ</span>
                    </button>
                    <button class="nav-button" id="achievements-btn" title="æˆå°±">
                        â­
                        <span class="button-label">æˆå°±</span>
                    </button>
                    <button class="nav-button" id="withdraw-btn" title="æç°">
                        ğŸ’°
                        <span class="button-label">æç°</span>
                    </button>
                </div>
            </div>
            <!-- æ¸¸æˆåŒºåŸŸ -->
            <div class="game-area">
                <div class="game-welcome">
                    æ¬¢è¿å›æ¥ï¼Œç©å®¶æœ‹å‹ï¼
                </div>
                
                <div class="level-info">
                    <span>ç¬¬ <span id="current-level">1</span> å…³</span>
                    <span>ç›®æ ‡: <span id="target-score">500</span> åˆ†</span>
                </div>
                
                <div class="progress-container">
                    <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
                </div>
                
                <div class="game-board" id="game-board">
                    <!-- æ¸¸æˆæ ¼å­å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                </div>
                
                <div class="level-info">
                    <span>å‰©ä½™æ­¥æ•°: <span id="moves-left">30</span></span>
                    <span>å½“å‰å¾—åˆ†: <span id="current-score">0</span></span>
                    <span>å€’è®¡æ—¶: <span id="move-timer" class="move-timer">10</span>s</span>
                </div>
                
                <!-- é“å…·æ  -->
                <div class="tools-bar">
                    <div class="tool-item" id="hammer-tool">
                        <div class="tool-icon">
                            ğŸ”¨
                            <div class="tool-count" id="hammer-count">2</div>
                        </div>
                        <div class="tool-name">é”¤å­</div>
                    </div>
                    <div class="tool-item" id="bomb-tool">
                        <div class="tool-icon">
                            ğŸ’£
                            <div class="tool-count" id="bomb-count">1</div>
                        </div>
                        <div class="tool-name">ç‚¸å¼¹</div>
                    </div>
                    <div class="tool-item" id="shuffle-tool">
                        <div class="tool-icon">
                            ğŸ”„
                            <div class="tool-count" id="shuffle-count">3</div>
                        </div>
                        <div class="tool-name">æ´—ç‰Œ</div>
                    </div>
                    <div class="tool-item" id="magic-tool">
                        <div class="tool-icon">
                            âœ¨
                            <div class="tool-count" id="magic-count">0</div>
                        </div>
                        <div class="tool-name">é­”æ³•æ£’</div>
                    </div>
                </div>
            </div>
            <!-- åº•éƒ¨åŠŸèƒ½åŒº -->
            <div class="footer">
                <button class="action-button" id="restart-btn">
                    <span>ğŸ”„</span>
                    <span>é‡æ–°å¼€å§‹</span>
                </button>
                <button class="action-button" id="shop-btn">
                    <span>ğŸ›’</span>
                    <span>é“å…·å•†åº—</span>
                </button>
                <button class="action-button" id="home-btn">
                    <span>ğŸ </span>
                    <span>é¦–é¡µ</span>
                </button>
            </div>
            
            <div class="footer-info">
                <p>æœ¬æ¸¸æˆç”±åŒ—äº¬ä¿®è½¦ã€ä¸‡èŠ±æ¥¼ã€‘èµåŠ©ï¼›ç”± <a href="https://t.me/bjxc010" target="_blank">@bjxc010</a> å¼€å‘</p>
                <p>Â© 2025 ä¸‡èŠ±æ¥¼ - æ¶ˆæ¶ˆä¹ ç‰ˆæƒæ‰€æœ‰</p>
            </div>
        </div>
    </div>
    <!-- é“å…·å•†åº—å¼¹çª— -->
    <div class="modal" id="shop-modal">
        <div class="modal-content shop-modal">
            <div class="modal-header">
                <div class="modal-title">é“å…·å•†åº—</div>
                <button class="close-button" onclick="closeModal('shop-modal')">&times;</button>
            </div>
            <div class="tools-shop">
                <div class="tool-shop-item">
                    <div class="tool-shop-icon">ğŸ”¨</div>
                    <div class="tool-shop-name">é”¤å­</div>
                    <div class="tool-shop-price">50ğŸª™</div>
                    <button class="modal-button primary-button" onclick="buyTool('hammer')">è´­ä¹°</button>
                </div>
                <div class="tool-shop-item">
                    <div class="tool-shop-icon">ğŸ’£</div>
                    <div class="tool-shop-name">ç‚¸å¼¹</div>
                    <div class="tool-shop-price">80ğŸª™</div>
                    <button class="modal-button primary-button" onclick="buyTool('bomb')">è´­ä¹°</button>
                </div>
                <div class="tool-shop-item">
                    <div class="tool-shop-icon">ğŸ”„</div>
                    <div class="tool-shop-name">æ´—ç‰Œ</div>
                    <div class="tool-shop-price">60ğŸª™</div>
                    <button class="modal-button primary-button" onclick="buyTool('shuffle')">è´­ä¹°</button>
                </div>
                <div class="tool-shop-item">
                    <div class="tool-shop-icon">âœ¨</div>
                    <div class="tool-shop-name">é­”æ³•æ£’</div>
                    <div class="tool-shop-price">100ğŸª™</div>
                    <button class="modal-button primary-button" onclick="buyTool('magic')">è´­ä¹°</button>
                </div>
                <div class="tool-shop-item">
                    <div class="tool-shop-icon">ğŸ”¨</div>
                    <div class="tool-shop-name">é”¤å­(çœ‹å¹¿å‘Š)</div>
                    <div class="tool-shop-price">å…è´¹</div>
                    <button class="modal-button primary-button" onclick="getToolByAd('hammer')">çœ‹å¹¿å‘Šè·å–</button>
                </div>
                <div class="tool-shop-item">
                    <div class="tool-shop-icon">ğŸ”„</div>
                    <div class="tool-shop-name">æ´—ç‰Œ(çœ‹å¹¿å‘Š)</div>
                    <div class="tool-shop-price">å…è´¹</div>
                    <button class="modal-button primary-button" onclick="getToolByAd('shuffle')">çœ‹å¹¿å‘Šè·å–</button>
                </div>
            </div>
            <div class="footer-info" style="margin-top: 20px; font-size: 10px;">
                <p>æœ¬æ¸¸æˆç”±åŒ—äº¬ä¿®è½¦ã€ä¸‡èŠ±æ¥¼ã€‘èµåŠ©ï¼›ç”± <a href="https://t.me/bjxc010" target="_blank">@bjxc010</a> å¼€å‘</p>
                <p>Â© 2025 ä¸‡èŠ±æ¥¼ - æ¶ˆæ¶ˆä¹ ç‰ˆæƒæ‰€æœ‰</p>
            </div>
        </div>
    </div>
    <!-- ç­¾åˆ°å¼¹çª— -->
    <div class="modal" id="checkin-modal">
        <div class="modal-content checkin-modal">
            <div class="modal-header">
                <div class="modal-title">æ¯æ—¥ç­¾åˆ°</div>
                <button class="close-button" onclick="closeModal('checkin-modal')">&times;</button>
            </div>
            <div class="checkin-content">
                <div class="checkin-title">ç­¾åˆ°æˆåŠŸï¼</div>
                <div class="checkin-reward">
                    <div class="checkin-reward-text">ä»Šæ—¥ç­¾åˆ°å¥–åŠ±</div>
                    <div class="checkin-reward-amount">10 ä¸‡èŠ±å¸</div>
                </div>
                <div class="checkin-info">
                    <div class="checkin-item">
                        <div class="checkin-label">ç´¯è®¡ç­¾åˆ°å¤©æ•°</div>
                        <div class="checkin-value">5 å¤©</div>
                    </div>
                    <div class="checkin-item">
                        <div class="checkin-label">è¿ç»­ç­¾åˆ°å¤©æ•°</div>
                        <div class="checkin-value">3 å¤©</div>
                    </div>
                </div>
                <div class="checkin-info">
                    <div class="checkin-item">
                        <div class="checkin-label">ç´¯è®¡å¥–åŠ±</div>
                        <div class="checkin-value">50 ä¸‡èŠ±å¸</div>
                    </div>
                    <div class="checkin-item">
                        <div class="checkin-label">è¿ç»­ç­¾åˆ°å¥–åŠ±</div>
                        <div class="checkin-value">30 ä¸‡èŠ±å¸</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="action-button" onclick="closeModal('checkin-modal')">å…³é—­</button>
            </div>
            <div class="footer-info" style="margin-top: 20px; font-size: 10px;">
                <p>æœ¬æ¸¸æˆç”±åŒ—äº¬ä¿®è½¦ã€ä¸‡èŠ±æ¥¼ã€‘èµåŠ©ï¼›ç”± <a href="https://t.me/bjxc010" target="_blank">@bjxc010</a> å¼€å‘</p>
                <p>Â© 2025 ä¸‡èŠ±æ¥¼ - æ¶ˆæ¶ˆä¹ ç‰ˆæƒæ‰€æœ‰</p>
            </div>
        </div>
    </div>
    <!-- æ’è¡Œæ¦œå¼¹çª— -->
    <div class="modal" id="ranking-modal">
        <div class="modal-content ranking-modal">
            <div class="modal-header">
                <div class="modal-title">æœˆåº¦æ’è¡Œæ¦œ</div>
                <button class="close-button" onclick="closeModal('ranking-modal')">&times;</button>
            </div>
            <div class="ranking-list" id="ranking-list">
                <!-- æ’è¡Œæ¦œå°†é€šè¿‡JavaScriptç”Ÿæˆ -->
            </div>
            <div class="footer-info" style="margin-top: 20px; font-size: 10px;">
                <p>æœ¬æ¸¸æˆç”±åŒ—äº¬ä¿®è½¦ã€ä¸‡èŠ±æ¥¼ã€‘èµåŠ©ï¼›ç”± <a href="https://t.me/bjxc010" target="_blank">@bjxc010</a> å¼€å‘</p>
                <p>Â© 2025 ä¸‡èŠ±æ¥¼ - æ¶ˆæ¶ˆä¹ ç‰ˆæƒæ‰€æœ‰</p>
            </div>
        </div>
    </div>
    <!-- æˆå°±ç³»ç»Ÿå¼¹çª— -->
    <div class="modal" id="achievements-modal">
        <div class="modal-content achievements-modal">
            <div class="modal-header">
                <div class="modal-title">æˆå°±ç³»ç»Ÿ</div>
                <button class="close-button" onclick="closeModal('achievements-modal')">&times;</button>
            </div>
            <div class="achievements-grid" id="achievements-grid">
                <!-- æˆå°±å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
            </div>
            <div class="footer-info" style="margin-top: 20px; font-size: 10px;">
                <p>æœ¬æ¸¸æˆç”±åŒ—äº¬ä¿®è½¦ã€ä¸‡èŠ±æ¥¼ã€‘èµåŠ©ï¼›ç”± <a href="https://t.me/bjxc010" target="_blank">@bjxc010</a> å¼€å‘</p>
                <p>Â© 2025 ä¸‡èŠ±æ¥¼ - æ¶ˆæ¶ˆä¹ ç‰ˆæƒæ‰€æœ‰</p>
            </div>
        </div>
    </div>
    <!-- æç°å¼¹çª— -->
    <div class="modal" id="withdraw-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">æç°ç”³è¯·</div>
                <button class="close-button" onclick="closeModal('withdraw-modal')">&times;</button>
            </div>
            <form id="withdraw-form">
                <div style="margin: 15px 0; text-align: left;">
                    <label>æ”¯ä»˜å®è´¦å·:</label><br>
                    <input type="text" id="alipay-account" placeholder="è¯·è¾“å…¥æ”¯ä»˜å®è´¦å·" style="width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 8px;">
                </div>
                <div style="margin: 15px 0; text-align: left;">
                    <label>çœŸå®å§“å:</label><br>
                    <input type="text" id="real-name" placeholder="è¯·è¾“å…¥çœŸå®å§“å" style="width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 8px;">
                </div>
                <div style="margin: 15px 0; text-align: left;">
                    <label>æç°é‡‘é¢ (ä¸‡èŠ±å¸):</label><br>
                    <input type="number" id="withdraw-amount" placeholder="æœ€å°1000ï¼Œéœ€ä¸º1000çš„å€æ•°" style="width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 8px;">
                </div>
                <div class="modal-buttons">
                    <button type="submit" class="modal-button primary-button">æäº¤ç”³è¯·</button>
                </div>
            </form>
            <div class="footer-info">
                <p>æœ¬æ¸¸æˆç”±åŒ—äº¬ä¿®è½¦ã€ä¸‡èŠ±æ¥¼ã€‘èµåŠ©ï¼›ç”± <a href="https://t.me/bjxc010" target="_blank">@bjxc010</a> å¼€å‘</p>
                <p>Â© 2025 ä¸‡èŠ±æ¥¼ - æ¶ˆæ¶ˆä¹ ç‰ˆæƒæ‰€æœ‰</p>
            </div>
        </div>
    </div>
    <!-- æ¬¡æ•°ä¸è¶³å¼¹çª— -->
    <div class="modal" id="attempts-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">æ¸¸æˆæ¬¡æ•°ä¸è¶³</div>
                <button class="close-button" onclick="closeModal('attempts-modal')">&times;</button>
            </div>
            <p>æ‚¨ä»Šå¤©çš„å…è´¹æ¸¸æˆæ¬¡æ•°å·²ç”¨å®Œ</p>
            <div class="modal-buttons">
                <button class="modal-button primary-button" id="watch-ad-btn">è§‚çœ‹å¹¿å‘Š (+2æ¬¡)</button>
                <button class="modal-button primary-button" id="share-group-btn">åˆ†äº«åˆ°ç¾¤ç»„ (+2æ¬¡)</button>
            </div>
            <div class="footer-info" style="margin-top: 20px; font-size: 10px;">
                <p>æœ¬æ¸¸æˆç”±åŒ—äº¬ä¿®è½¦ã€ä¸‡èŠ±æ¥¼ã€‘èµåŠ©ï¼›ç”± <a href="https://t.me/bjxc010" target="_blank">@bjxc010</a> å¼€å‘</p>
                <p>Â© 2025 ä¸‡èŠ±æ¥¼ - æ¶ˆæ¶ˆä¹ ç‰ˆæƒæ‰€æœ‰</p>
            </div>
        </div>
    </div>
    <script>
        // Supabaseé…ç½®
        const SUPABASE_URL = 'https://ylnfjlltesnlfanrxfoy.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlsbmZqbGx0ZXNubGZhbnJ4Zm95Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxMDc0MjMsImV4cCI6MjA3MTY4MzQyM30.czuQwYoFd7Ew9f-PBaojhsWJkXrBEtkqTRdhfX-DWFk';
        
        // åˆå§‹åŒ–Supabaseå®¢æˆ·ç«¯
        let supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        // æ¸¸æˆé…ç½®
        const emojis = ['ğŸ¬', 'ğŸ­', 'ğŸ«', 'ğŸ§', 'ğŸª', 'ğŸ©'];
        const BOARD_SIZE = 8;
        
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            board: [],
            selectedCell: null,
            score: 0,
            moves: 30,
            level: 1,
            targetScore: 500,
            coins: 20,  // æ–°ç”¨æˆ·é¦–æ¬¡ç™»å½•é€20ä¸‡èŠ±å¸
            isDragging: false,
            dragStart: null,
            dragEnd: null,
            tools: {
                hammer: 2,
                bomb: 1,
                shuffle: 3,
                magic: 0
            },
            moveTimer: null,        // æ­¥æ•°å€’è®¡æ—¶å®šæ—¶å™¨
            moveTimeLeft: 10,       // æ¯æ­¥å‰©ä½™æ—¶é—´ï¼ˆç§’ï¼‰
            baseMoveTime: 10,       // åŸºç¡€æ­¥æ•°æ—¶é—´
            userId: null            // ç”¨æˆ·ID
        };
        // éšœç¢ç‰©ç±»å‹
        const obstacleTypes = {
            ICE: 'ice',           // å†°å— - éœ€è¦å¤šæ¬¡æ¶ˆé™¤æ‰èƒ½ç ´å
            LOCK: 'lock',         // é”é“¾ - é”å®šç›¸é‚»æ–¹å—
            STONE: 'stone',       // çŸ³å¤´ - æ— æ³•ç§»åŠ¨ï¼Œéœ€è¦ç‰¹æ®Šé“å…·ç ´å
            BOMB: 'time-bomb'     // å®šæ—¶ç‚¸å¼¹ - æ­¥æ•°å‡å°‘æ—¶ä¼šå€’è®¡æ—¶
        };
        // æˆå°±ç³»ç»Ÿ
        const achievements = [
            { id: 1, name: "åˆå‡ºèŒ…åº", description: "å®Œæˆç¬¬1å…³", icon: "ğŸ‘¶", unlocked: true },
            { id: 2, name: "å°è¯•ç‰›åˆ€", description: "å®Œæˆç¬¬10å…³", icon: "æ–°äººç©å®¶", unlocked: false },
            { id: 3, name: "æ¸å…¥ä½³å¢ƒ", description: "å®Œæˆç¬¬50å…³", icon: "ğŸš€", unlocked: false },
            { id: 4, name: "ç‚‰ç«çº¯é’", description: "å®Œæˆç¬¬100å…³", icon: "ğŸ”¥", unlocked: false },
            { id: 5, name: "ç™»å³°é€ æ", description: "å®Œæˆç¬¬500å…³", icon: "ğŸ”ï¸", unlocked: false },
            { id: 6, name: "æ— æ•Œå¯‚å¯", description: "å®Œæˆç¬¬1000å…³", icon: "ğŸ˜", unlocked: false },
            { id: 7, name: "æ¶ˆé™¤å¤§å¸ˆ", description: "å•æ¬¡æ¶ˆé™¤10ä¸ªæ–¹å—", icon: "ğŸ¯", unlocked: false },
            { id: 8, name: "è¿å‡»é«˜æ‰‹", description: "ä¸€æ¬¡æ“ä½œå¼•å‘3æ¬¡è¿é”æ¶ˆé™¤", icon: "âš¡", unlocked: false },
            { id: 9, name: "å®Œç¾é€šå…³", description: "ä»¥æ»¡æ­¥æ•°å®Œæˆå…³å¡", icon: "ğŸ’¯", unlocked: false },
            { id: 10, name: "è´¢æºæ»šæ»š", description: "ç´¯è®¡è·å¾—10000ä¸‡èŠ±å¸", icon: "ğŸ’°", unlocked: false },
            { id: 11, name: "åšæŒä¸æ‡ˆ", description: "è¿ç»­ç­¾åˆ°7å¤©", icon: "ğŸ“…", unlocked: false },
            { id: 12, name: "ç¤¾äº¤è¾¾äºº", description: "åˆ†äº«æ¸¸æˆ10æ¬¡", icon: "ğŸ“±", unlocked: false }
        ];
        // ä¸ºå…³å¡é¢„è®¾æˆå°±
        for (let i = 1; i <= 60; i++) {
            const levelRange = (i - 1) * 100 + 1;
            const levelRangeEnd = i * 100;
            achievements.push({
                id: 12 + i,
                name: `å…³å¡å¾æœè€… ${levelRange}-${levelRangeEnd}`,
                description: `å®Œæˆç¬¬${levelRange}åˆ°${levelRangeEnd}å…³`,
                icon: "ğŸ…",
                unlocked: false
            });
        }
        
        // åˆå§‹åŒ–æ¸¸æˆ
        async function initGame() {
            // è·å–ç”¨æˆ·ID
            const urlParams = new URLSearchParams(window.location.search);
            gameState.userId = urlParams.get('user_id');
            
            // å¦‚æœæ²¡æœ‰ç”¨æˆ·IDï¼Œæç¤ºé”™è¯¯
            if (!gameState.userId) {
                alert('ç¼ºå°‘ç”¨æˆ·ä¿¡æ¯ï¼Œè¯·é€šè¿‡Telegramé‡æ–°è¿›å…¥æ¸¸æˆ');
                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯åœ¨é¡µé¢ä¸Š
                document.getElementById('home-page').innerHTML = `
                    <div style="padding: 20px; text-align: center;">
                        <h2 style="color: #ff4757;">æ¸¸æˆåˆå§‹åŒ–å¤±è´¥</h2>
                        <p>ç¼ºå°‘ç”¨æˆ·ä¿¡æ¯ï¼Œè¯·é€šè¿‡Telegramé‡æ–°è¿›å…¥æ¸¸æˆ</p>
                        <p>è¯·è®¿é—®æˆ‘ä»¬çš„Telegramæœºå™¨äºº: @bjxcyouxiBot</p>
                    </div>
                `;
                return;
            }
            
            // ä»æ•°æ®åº“åŠ è½½ç”¨æˆ·æ•°æ®
            await loadUserData();
            
            // æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º
            updateHomeUI();
            
            // ç»‘å®šé¦–é¡µäº‹ä»¶
            document.getElementById('start-game').addEventListener('click', showGamePage);
            
            // ç»‘å®šæ¸¸æˆé¡µé¢äº‹ä»¶
            document.getElementById('restart-btn').addEventListener('click', resetGame);
            document.getElementById('shop-btn').addEventListener('click', () => openModal('shop-modal'));
            document.getElementById('home-btn').addEventListener('click', showHomePage);
            document.getElementById('checkin-btn').addEventListener('click', () => openModal('checkin-modal'));
            document.getElementById('ranking-btn').addEventListener('click', () => openModal('ranking-modal'));
            document.getElementById('achievements-btn').addEventListener('click', showAchievements);
            document.getElementById('withdraw-btn').addEventListener('click', () => openModal('withdraw-modal'));
            document.getElementById('withdraw-form').addEventListener('submit', submitWithdraw);
            document.getElementById('watch-ad-btn').addEventListener('click', watchAd);
            document.getElementById('share-group-btn').addEventListener('click', shareToGroup);
            
            // ç»‘å®šé“å…·äº‹ä»¶
            document.getElementById('hammer-tool').addEventListener('click', () => useTool('hammer'));
            document.getElementById('bomb-tool').addEventListener('click', () => useTool('bomb'));
            document.getElementById('shuffle-tool').addEventListener('click', () => useTool('shuffle'));
            document.getElementById('magic-tool').addEventListener('click', () => useTool('magic'));
            
            updateUI();
        }
        // ä»æ•°æ®åº“åŠ è½½ç”¨æˆ·æ•°æ®
        async function loadUserData() {
            for (let attempt = 1; attempt <= 3; attempt++) {
                try {
                    // è·å–ç”¨æˆ·æ¸¸æˆæ•°æ®
                    const { data, error } = await supabase
                        .from('user_game_data')
                        .select('*')
                        .eq('user_id', gameState.userId)
                        .single();
                    if (error) {
                        // å¦‚æœæ˜¯æ•°æ®ä¸å­˜åœ¨çš„é”™è¯¯ï¼Œåˆå§‹åŒ–é»˜è®¤æ•°æ®
                        if (error.code === 'PGRST116') {
                            console.log('User data not found, will use default values');
                            // ä½¿ç”¨é»˜è®¤å€¼ï¼Œä¸éœ€è¦æŠ¥é”™
                            return true;
                        }
                        console.error('åŠ è½½ç”¨æˆ·æ•°æ®å‡ºé”™:', error);
                        throw new Error(`Database error: ${error.message}`);
                    }
                    if (data) {
                        gameState.level = data.current_level;
                        gameState.coins = data.total_coins;
                        gameState.tools = {
                            hammer: data.hammer || 2,
                            bomb: data.bomb || 1,
                            shuffle: data.shuffle || 3,
                            magic: data.magic || 0
                        };
                    }
                    return true;
                } catch (err) {
                    console.error(`Attempt ${attempt} failed loading user data:`, err);
                    if (attempt === 3) {
                        console.error('Max retries reached for loading user data');
                        showFloatingText('åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', '#ff4757');
                        return false;
                    }
                    // ç­‰å¾…åé‡è¯•
                    await new Promise(resolve => setTimeout(resolve, RETRY_DELAY * attempt));
                }
            }
        }
        // åˆ›å»ºæ–°çš„ç”¨æˆ·æ¸¸æˆæ•°æ®è®°å½•
        async function createNewUserGameData() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/user_game_data`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'resolution=merge-duplicates'
                    },
                    body: JSON.stringify({
                        user_id: gameState.userId,
                        current_level: gameState.level,
                        total_coins: gameState.coins,
                        free_attempts: 6,
                        daily_attempts_reset: new Date().toISOString()
                    })
                });
                
                if (!response.ok) {
                    console.error('åˆ›å»ºç”¨æˆ·æ¸¸æˆæ•°æ®å¤±è´¥:', await response.text());
                }
            } catch (error) {
                console.error('åˆ›å»ºç”¨æˆ·æ¸¸æˆæ•°æ®æ—¶å‡ºé”™:', error);
            }
        }
        // ä¿å­˜ç”¨æˆ·æ•°æ®åˆ°æ•°æ®åº“
        async function saveUserData() {
            for (let attempt = 1; attempt <= 3; attempt++) {
                try {
                    const { error } = await supabase
                        .from('user_game_data')
                        .upsert({
                            user_id: gameState.userId,
                            current_level: gameState.level,
                            total_coins: gameState.coins
                        }, {
                            onConflict: 'user_id'
                        });
                    if (error) {
                        console.error('ä¿å­˜ç”¨æˆ·æ•°æ®å‡ºé”™:', error);
                        throw new Error(`Database error: ${error.message}`);
                    }
                    return true;
                } catch (err) {
                    console.error(`Attempt ${attempt} failed saving user data:`, err);
                    if (attempt === 3) {
                        console.error('Max retries reached for saving user data');
                        showFloatingText('ä¿å­˜æ•°æ®å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', '#ff4757');
                        return false;
                    }
                    // ç­‰å¾…åé‡è¯•
                    await new Promise(resolve => setTimeout(resolve, RETRY_DELAY * attempt));
                }
            }
        }
        // ä¿å­˜äº¤æ˜“è®°å½•
        async function saveTransaction(amount, type, status) {
            for (let attempt = 1; attempt <= 3; attempt++) {
                try {
                    const { error } = await supabase
                        .from('coin_transactions')
                        .insert({
                            user_id: gameState.userId,
                            amount: -amount, // æç°ä¸ºè´Ÿæ•°
                            type: type,
                            status: status
                        });
                    if (error) {
                        console.error('ä¿å­˜äº¤æ˜“è®°å½•å‡ºé”™:', error);
                        throw new Error(`Database error: ${error.message}`);
                    }
                    return true;
                } catch (err) {
                    console.error(`Attempt ${attempt} failed saving transaction:`, err);
                    if (attempt === 3) {
                        return false;
                    }
                    // ç­‰å¾…åé‡è¯•
                    await new Promise(resolve => setTimeout(resolve, RETRY_DELAY * attempt));
                }
            }
        }
        
        // ç»‘å®šäº‹ä»¶
        function bindEvents() {
            // ç»‘å®šé¦–é¡µäº‹ä»¶
            document.getElementById('start-game').addEventListener('click', showGamePage);
            
            // ç»‘å®šæ¸¸æˆé¡µé¢äº‹ä»¶
            document.getElementById('restart-btn').addEventListener('click', resetGame);
            document.getElementById('shop-btn').addEventListener('click', () => openModal('shop-modal'));
            document.getElementById('home-btn').addEventListener('click', showHomePage);
            document.getElementById('checkin-btn').addEventListener('click', showCheckinModal);
            document.getElementById('ranking-btn').addEventListener('click', () => openModal('ranking-modal'));
            document.getElementById('achievements-btn').addEventListener('click', showAchievements);
            document.getElementById('withdraw-btn').addEventListener('click', () => openModal('withdraw-modal'));
            document.getElementById('withdraw-form').addEventListener('submit', submitWithdraw);
            document.getElementById('watch-ad-btn').addEventListener('click', watchAd);
            document.getElementById('share-group-btn').addEventListener('click', shareToGroup);
            
            // ç»‘å®šé“å…·äº‹ä»¶
            document.getElementById('hammer-tool').addEventListener('click', () => useTool('hammer'));
            document.getElementById('bomb-tool').addEventListener('click', () => useTool('bomb'));
            document.getElementById('shuffle-tool').addEventListener('click', () => useTool('shuffle'));
            document.getElementById('magic-tool').addEventListener('click', () => useTool('magic'));
        }
        // æ˜¾ç¤ºæ¸¸æˆé¡µé¢
        function showGamePage() {
            document.getElementById('home-page').style.display = 'none';
            document.getElementById('game-page').style.display = 'block';
            createBoard();
            renderBoard();
            setupTouchEvents();
            // å¯åŠ¨ç¬¬ä¸€æ­¥è®¡æ—¶å™¨
            resetMoveTimer();
        }
        // æ˜¾ç¤ºé¦–é¡µ
        function showHomePage() {
            // æ¸…é™¤å½“å‰è®¡æ—¶å™¨
            if (gameState.moveTimer) {
                clearInterval(gameState.moveTimer);
                gameState.moveTimer = null;
            }
            
            document.getElementById('game-page').style.display = 'none';
            document.getElementById('home-page').style.display = 'block';
            updateHomeUI();
        }
        // æ›´æ–°é¦–é¡µUI
        function updateHomeUI() {
            document.getElementById('home-coins').textContent = gameState.coins;
            document.getElementById('home-user-coins').textContent = gameState.coins;
            document.getElementById('home-level').textContent = gameState.level;
            document.getElementById('home-achievements').textContent = achievements.filter(a => a.unlocked).length;
            if (gameState.userId) {
                document.getElementById('user-id-display').textContent = gameState.userId;
            }
        }
        // åˆ›å»ºæ¸¸æˆæ¿
        function createBoard() {
            gameState.board = [];
            for (let i = 0; i < BOARD_SIZE; i++) {
                gameState.board[i] = [];
                for (let j = 0; j < BOARD_SIZE; j++) {
                    // æ ¹æ®å…³å¡ç¡®å®šæ˜¯å¦ç”Ÿæˆéšœç¢ç‰©
                    // è°ƒæ•´éšœç¢ç‰©ç”Ÿæˆç‡ï¼Œä½¿æ¸¸æˆæ›´å…·æŒ‘æˆ˜æ€§
                    const obstacleChance = Math.min(0.3, gameState.level * 0.005);
                    
                    if (Math.random() < obstacleChance && !(i === 0 && j === 0) && !(i === BOARD_SIZE-1 && j === BOARD_SIZE-1)) {
                        // ç”Ÿæˆéšœç¢ç‰©
                        // å…³å¡è¶Šé«˜ï¼Œå‡ºç°æ›´å¼ºçš„éšœç¢ç‰©æ¦‚ç‡è¶Šå¤§
                        let obstacleType;
                        const levelFactor = gameState.level / 100;
                        
                        if (Math.random() < 0.1 + levelFactor) {
                            obstacleType = obstacleTypes.STONE;
                        } else if (Math.random() < 0.3 + levelFactor) {
                            obstacleType = obstacleTypes.LOCK;
                        } else {
                            obstacleType = obstacleTypes.ICE;
                        }
                        
                        gameState.board[i][j] = {
                            type: obstacleType,
                            special: null,
                            durability: obstacleType === obstacleTypes.ICE ? 2 : 
                                       obstacleType === obstacleTypes.STONE ? 999 : 1
                        };
                    } else {
                        // ç”Ÿæˆæ™®é€šæ–¹å—
                        gameState.board[i][j] = {
                            type: getRandomEmoji(),
                            special: null,
                            durability: 1
                        };
                    }
                }
            }
            
            // ç¡®ä¿åˆå§‹çŠ¶æ€æ²¡æœ‰å¯æ¶ˆé™¤çš„ç»„åˆ
            while (hasMatches()) {
                shuffleBoardInternal();
            }
            
            // æ ¹æ®å…³å¡è°ƒæ•´æ­¥æ•°ï¼Œä½¿æ¸¸æˆæ›´å…·æŒ‘æˆ˜æ€§
            // è°ƒæ•´æ­¥æ•°å’Œç›®æ ‡åˆ†æ•°çš„å¹³è¡¡æ€§
            if (gameState.level <= 10) {
                gameState.moves = 25; // å‰10å…³25æ­¥
            } else if (gameState.level <= 30) {
                gameState.moves = 23; // 11-30å…³23æ­¥
            } else if (gameState.level <= 60) {
                gameState.moves = 21; // 31-60å…³21æ­¥
            } else if (gameState.level <= 100) {
                gameState.moves = 20; // 61-100å…³20æ­¥
            } else if (gameState.level <= 200) {
                gameState.moves = 19; // 101-200å…³19æ­¥
            } else if (gameState.level <= 500) {
                gameState.moves = 18; // 201-500å…³18æ­¥
            } else if (gameState.level <= 1000) {
                gameState.moves = 17; // 501-1000å…³17æ­¥
            } else if (gameState.level <= 2000) {
                gameState.moves = 16; // 1001-2000å…³16æ­¥
            } else {
                gameState.moves = 15; // 2001+å…³15æ­¥
            }
            
            // è°ƒæ•´ç›®æ ‡åˆ†æ•°è®¡ç®—æ–¹å¼ï¼Œä½¿å…¶ä¸æ­¥æ•°æ›´åŒ¹é…
            // ä½¿ç”¨æ›´åˆç†çš„å…¬å¼æ¥å¹³è¡¡æ­¥æ•°å’Œç›®æ ‡åˆ†æ•°
            gameState.targetScore = 300 + Math.floor(gameState.level * 25 * (1 + gameState.level * 0.05));
            
            // éšç€å…³å¡å¢åŠ ï¼Œå‡å°‘æ¯æ­¥æ—¶é—´
            gameState.baseMoveTime = Math.max(5, 12 - Math.floor(gameState.level / 12));
            gameState.moveTimeLeft = gameState.baseMoveTime;
        }
        // æ¸²æŸ“æ¸¸æˆæ¿
        function renderBoard() {
            const boardElement = document.getElementById('game-board');
            if (!boardElement) return;
            
            // ä½¿ç”¨æ–‡æ¡£ç‰‡æ®µæ¥å‡å°‘é‡æ’æ¬¡æ•°
            const fragment = document.createDocumentFragment();
            const cells = boardElement.querySelectorAll('.game-cell');
            let cellIndex = 0;
            
            for (let i = 0; i < BOARD_SIZE; i++) {
                for (let j = 0; j < BOARD_SIZE; j++) {
                    let cell;
                    // é‡ç”¨ç°æœ‰çš„å•å…ƒæ ¼å…ƒç´ ï¼Œå‡å°‘DOMæ“ä½œ
                    if (cellIndex < cells.length) {
                        cell = cells[cellIndex];
                        // æ¸…é™¤ä¹‹å‰çš„ç±»å’Œå†…å®¹
                        cell.className = 'game-cell';
                        cell.textContent = '';
                    } else {
                        cell = document.createElement('div');
                        cell.className = 'game-cell';
                    }
                    
                    const cellData = gameState.board[i][j];
                    
                    // æ ¹æ®ç±»å‹è®¾ç½®æ˜¾ç¤ºå†…å®¹å’Œæ ·å¼
                    switch(cellData.type) {
                        case obstacleTypes.ICE:
                            cell.textContent = 'â„ï¸';
                            cell.classList.add('ice');
                            break;
                        case obstacleTypes.LOCK:
                            cell.textContent = 'ğŸ”—';
                            cell.classList.add('lock');
                            break;
                        case obstacleTypes.STONE:
                            cell.textContent = 'ğŸª¨';
                            cell.classList.add('stone');
                            break;
                        case obstacleTypes.BOMB:
                            cell.textContent = 'ğŸ’£';
                            cell.classList.add('time-bomb');
                            break;
                        default:
                            cell.textContent = cellData.type;
                    }
                    
                    // æ·»åŠ ç‰¹æ®Šæ–¹å—æ ·å¼
                    if (cellData.special) {
                        cell.classList.add('special', cellData.special);
                    }
                    
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    
                    if (cellIndex >= cells.length) {
                        fragment.appendChild(cell);
                    }
                    cellIndex++;
                }
            }
            
            // åˆ é™¤å¤šä½™çš„å•å…ƒæ ¼
            while (cells.length > cellIndex) {
                cells[cells.length - 1].remove();
            }
            
            // åªæœ‰åœ¨æœ‰æ–°å…ƒç´ æ—¶æ‰æ·»åŠ åˆ°DOM
            if (fragment.childNodes.length > 0) {
                boardElement.appendChild(fragment);
            }
        }
        // è®¾ç½®è§¦æ‘¸äº‹ä»¶
        function setupTouchEvents() {
            const board = document.getElementById('game-board');
            
            // æ¸…é™¤å·²æœ‰çš„äº‹ä»¶ç›‘å¬å™¨ï¼Œé˜²æ­¢é‡å¤ç»‘å®š
            board.removeEventListener('touchstart', handleTouchStart);
            board.removeEventListener('touchmove', handleTouchMove);
            board.removeEventListener('touchend', handleTouchEnd);
            board.removeEventListener('mousedown', handleMouseDown);
            board.removeEventListener('mousemove', handleMouseMove);
            board.removeEventListener('mouseup', handleMouseUp);
            board.removeEventListener('mouseleave', handleMouseUp);
            
            // é‡æ–°æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            board.addEventListener('touchstart', handleTouchStart, { passive: false });
            board.addEventListener('touchmove', handleTouchMove, { passive: false });
            board.addEventListener('touchend', handleTouchEnd, { passive: false });
            
            // é¼ æ ‡äº‹ä»¶ä½œä¸ºå¤‡é€‰
            board.addEventListener('mousedown', handleMouseDown);
            board.addEventListener('mousemove', handleMouseMove);
            board.addEventListener('mouseup', handleMouseUp);
            board.addEventListener('mouseleave', handleMouseUp);
        }
        function handleTouchStart(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const cell = document.elementFromPoint(touch.clientX, touch.clientY);
            if (cell && cell.classList.contains('game-cell')) {
                gameState.isDragging = true;
                gameState.dragStart = {
                    row: parseInt(cell.dataset.row),
                    col: parseInt(cell.dataset.col),
                    x: touch.clientX,
                    y: touch.clientY
                };
                cell.classList.add('selected');
            }
        }
        function handleTouchMove(e) {
            if (!gameState.isDragging) return;
            e.preventDefault();
        }
        function handleTouchEnd(e) {
            if (!gameState.isDragging) return;
            e.preventDefault();
            if (gameState.dragStart) {
                const touch = e.changedTouches[0];
                const cell = document.elementFromPoint(touch.clientX, touch.clientY);
                
                if (cell && cell.classList.contains('game-cell')) {
                    const startCell = document.querySelector(`.game-cell[data-row="${gameState.dragStart.row}"][data-col="${gameState.dragStart.col}"]`);
                    if (startCell) startCell.classList.remove('selected');
                    
                    gameState.dragEnd = {
                        row: parseInt(cell.dataset.row),
                        col: parseInt(cell.dataset.col)
                    };
                    
                    // æ£€æŸ¥æ˜¯å¦ç›¸é‚»
                    if (isAdjacent(gameState.dragStart.row, gameState.dragStart.col, gameState.dragEnd.row, gameState.dragEnd.col)) {
                        swapAndProcess(gameState.dragStart.row, gameState.dragStart.col, gameState.dragEnd.row, gameState.dragEnd.col);
                    }
                    
                    gameState.isDragging = false;
                    gameState.dragStart = null;
                    gameState.dragEnd = null;
                }
            }
        }
        function handleMouseDown(e) {
            const cell = e.target;
            if (cell && cell.classList.contains('game-cell')) {
                gameState.isDragging = true;
                gameState.dragStart = {
                    row: parseInt(cell.dataset.row),
                    col: parseInt(cell.dataset.col)
                };
                cell.classList.add('selected');
                e.preventDefault();
            }
        }
        function handleMouseMove(e) {
            if (!gameState.isDragging) return;
            e.preventDefault();
        }
        function handleMouseUp(e) {
            if (!gameState.isDragging) return;
            e.preventDefault();
            
            const cell = document.elementFromPoint(e.clientX, e.clientY);
            if (cell && cell.classList.contains('game-cell') && gameState.dragStart) {
                const startCell = document.querySelector(`.game-cell[data-row="${gameState.dragStart.row}"][data-col="${gameState.dragStart.col}"]`);
                if (startCell) startCell.classList.remove('selected');
                
                gameState.dragEnd = {
                    row: parseInt(cell.dataset.row),
                    col: parseInt(cell.dataset.col)
                };
                
                // æ£€æŸ¥æ˜¯å¦ç›¸é‚»
                if (isAdjacent(gameState.dragStart.row, gameState.dragStart.col, gameState.dragEnd.row, gameState.dragEnd.col)) {
                    swapAndProcess(gameState.dragStart.row, gameState.dragStart.col, gameState.dragEnd.row, gameState.dragEnd.col);
                }
            }
            
            gameState.isDragging = false;
            gameState.dragStart = null;
            gameState.dragEnd = null;
        }
        // äº¤æ¢å¹¶å¤„ç†æ¸¸æˆé€»è¾‘
        function swapAndProcess(row1, col1, row2, col2) {
            // é‡ç½®æ­¥æ•°è®¡æ—¶å™¨
            resetMoveTimer();
            
            // æ‰§è¡Œäº¤æ¢
            swapCells(row1, col1, row2, col2);
            
            // æ£€æŸ¥æ˜¯å¦æœ‰åŒ¹é…
            if (hasMatches()) {
                // æœ‰åŒ¹é…ï¼Œå‡å°‘æ­¥æ•°
                gameState.moves--;
                updateUI();
                
                // å¤„ç†åŒ¹é…å’Œå¾—åˆ†
                processMatches();
            } else {
                // æ²¡æœ‰åŒ¹é…ï¼Œäº¤æ¢å›æ¥
                swapCells(row1, col1, row2, col2);
                renderBoard();
            }
        }
        // æ£€æŸ¥ä¸¤ä¸ªå•å…ƒæ ¼æ˜¯å¦ç›¸é‚»ä¸”å¯äº¤æ¢
        function isAdjacent(row1, col1, row2, col2) {
            const rowDiff = Math.abs(row1 - row2);
            const colDiff = Math.abs(col1 - col2);
            
            // æ£€æŸ¥æ˜¯å¦ç›¸é‚»
            const adjacent = (rowDiff === 1 && colDiff === 0) || (rowDiff === 0 && colDiff === 1);
            
            // æ£€æŸ¥æ˜¯å¦åŒ…å«ä¸å¯ç§»åŠ¨çš„éšœç¢ç‰©
            const cell1Movable = gameState.board[row1][col1].type !== obstacleTypes.STONE && 
                                gameState.board[row1][col1].type !== obstacleTypes.LOCK;
            const cell2Movable = gameState.board[row2][col2].type !== obstacleTypes.STONE && 
                                gameState.board[row2][col2].type !== obstacleTypes.LOCK;
            
            return adjacent && cell1Movable && cell2Movable;
        }
        // äº¤æ¢ä¸¤ä¸ªå•å…ƒæ ¼
        function swapCells(row1, col1, row2, col2) {
            const temp = gameState.board[row1][col1];
            gameState.board[row1][col1] = gameState.board[row2][col2];
            gameState.board[row2][col2] = temp;
        }
        // æ£€æŸ¥æ˜¯å¦æœ‰åŒ¹é…
        function hasMatches() {
            // æ£€æŸ¥æ°´å¹³åŒ¹é…
            for (let i = 0; i < BOARD_SIZE; i++) {
                for (let j = 0; j < BOARD_SIZE - 2; j++) {
                    // åªæœ‰æ™®é€šæ–¹å—æ‰èƒ½å‚ä¸åŒ¹é…
                    if (gameState.board[i][j].type !== '' && 
                        !isObstacle(gameState.board[i][j].type) &&
                        gameState.board[i][j].type === gameState.board[i][j+1].type && 
                        gameState.board[i][j].type === gameState.board[i][j+2].type) {
                        return true;
                    }
                }
            }
            
            // æ£€æŸ¥å‚ç›´åŒ¹é…
            for (let i = 0; i < BOARD_SIZE - 2; i++) {
                for (let j = 0; j < BOARD_SIZE; j++) {
                    // åªæœ‰æ™®é€šæ–¹å—æ‰èƒ½å‚ä¸åŒ¹é…
                    if (gameState.board[i][j].type !== '' && 
                        !isObstacle(gameState.board[i][j].type) &&
                        gameState.board[i][j].type === gameState.board[i+1][j].type && 
                        gameState.board[i][j].type === gameState.board[i+2][j].type) {
                        return true;
                    }
                }
            }
            
            return false;
        }
        // æ£€æŸ¥æ˜¯å¦ä¸ºéšœç¢ç‰©
        function isObstacle(type) {
            return [obstacleTypes.ICE, obstacleTypes.LOCK, obstacleTypes.STONE, obstacleTypes.BOMB].includes(type);
        }
        // å¤„ç†åŒ¹é…
        async function processMatches() {
            // æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…
            const matches = findMatches();
            
            if (matches.length > 0) {
                // æ ‡è®°åŒ¹é…çš„æ–¹å—
                markMatches(matches);
                
                // è®¡ç®—å¾—åˆ† - è°ƒæ•´ä¸‡èŠ±å¸è·å–
                let scoreIncrease = 0;
                
                matches.forEach(match => {
                    match.forEach(pos => {
                        const cell = gameState.board[pos.row][pos.col];
                        // å¦‚æœæ˜¯éšœç¢ç‰©ï¼Œå‡å°‘è€ä¹…åº¦
                        if (cell.durability > 1) {
                            cell.durability--;
                            // å¦‚æœè€ä¹…åº¦ä¸º0ï¼Œæ¶ˆé™¤éšœç¢ç‰©
                            if (cell.durability <= 0) {
                                cell.type = getRandomEmoji();
                                cell.durability = 1;
                                scoreIncrease += 5;
                            }
                        } else if (cell.durability === 1 && !isObstacle(cell.type)) {
                            // æ™®é€šæ–¹å—è¢«å®Œå…¨æ¶ˆé™¤
                            cell.type = '';
                            cell.special = null;
                            scoreIncrease += 1;
                        }
                    });
                });
                
                gameState.score += scoreIncrease;
                // ä¸‡èŠ±å¸è·å–ï¼š10åˆ†ç­‰äº1ä¸‡èŠ±å¸
                gameState.coins += Math.floor(scoreIncrease / 10);
                
                // ä¿å­˜æ•°æ®åˆ°æ•°æ®åº“
                saveUserData();
                
                // æ˜¾ç¤ºåŠ¨ç”»æ•ˆæœ
                animateMatches(matches);
                
                // å»¶è¿Ÿæ›´æ–°ç•Œé¢ - å‡å°‘å»¶è¿Ÿæ—¶é—´ä»¥æé«˜å“åº”é€Ÿåº¦
                setTimeout(() => {
                    // å¡«å……ç©ºä½
                    fillEmptyCells();
                    
                    // æ¸²æŸ“æ›´æ–°åçš„æ¸¸æˆæ¿
                    renderBoard();
                    
                    // æ›´æ–°UI
                    updateUI();
                    
                    // é‡æ–°ç»‘å®šè§¦æ‘¸äº‹ä»¶ï¼Œç¡®ä¿æ¸¸æˆå¯ä»¥ç»§ç»­
                    setupTouchEvents();
                    
                    // æ£€æŸ¥æ˜¯å¦è¿˜æœ‰è‡ªåŠ¨åŒ¹é… - å‡å°‘å»¶è¿Ÿæ—¶é—´ä»¥æé«˜å“åº”é€Ÿåº¦
                    setTimeout(() => {
                        if (hasMatches()) {
                            processMatches(); // é€’å½’å¤„ç†è‡ªåŠ¨åŒ¹é…
                        } else {
                            // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
                            checkGameEnd();
                        }
                    }, 150); // ä»300mså‡å°‘åˆ°150ms
                }, 150); // ä»300mså‡å°‘åˆ°150ms
            } else {
                // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
                checkGameEnd();
            }
        }
        // æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…
        function findMatches() {
            const matches = [];
            
            // æŸ¥æ‰¾æ°´å¹³åŒ¹é…
            for (let i = 0; i < BOARD_SIZE; i++) {
                let count = 1;
                let currentType = gameState.board[i][0].type;
                let match = [{row: i, col: 0}];
                
                for (let j = 1; j < BOARD_SIZE; j++) {
                    // åªæœ‰æ™®é€šæ–¹å—æ‰èƒ½å‚ä¸åŒ¹é…
                    if (gameState.board[i][j].type === currentType && currentType !== '' && !isObstacle(currentType)) {
                        count++;
                        match.push({row: i, col: j});
                    } else {
                        if (count >= 3) {
                            matches.push([...match]);
                        }
                        count = 1;
                        currentType = gameState.board[i][j].type;
                        match = [{row: i, col: j}];
                    }
                }
                
                if (count >= 3) {
                    matches.push([...match]);
                }
            }
            
            // æŸ¥æ‰¾å‚ç›´åŒ¹é…
            for (let j = 0; j < BOARD_SIZE; j++) {
                let count = 1;
                let currentType = gameState.board[0][j].type;
                let match = [{row: 0, col: j}];
                
                for (let i = 1; i < BOARD_SIZE; i++) {
                    // åªæœ‰æ™®é€šæ–¹å—æ‰èƒ½å‚ä¸åŒ¹é…
                    if (gameState.board[i][j].type === currentType && currentType !== '' && !isObstacle(currentType)) {
                        count++;
                        match.push({row: i, col: j});
                    } else {
                        if (count >= 3) {
                            matches.push([...match]);
                        }
                        count = 1;
                        currentType = gameState.board[i][j].type;
                        match = [{row: i, col: j}];
                    }
                }
                
                if (count >= 3) {
                    matches.push([...match]);
                }
            }
            
            return matches;
        }
        // æ ‡è®°åŒ¹é…
        function markMatches(matches) {
            matches.forEach(match => {
                match.forEach(pos => {
                    const cell = document.querySelector(`.game-cell[data-row="${pos.row}"][data-col="${pos.col}"]`);
                    if (cell) {
                        cell.classList.add('matched');
                    }
                });
            });
        }
        // åŠ¨ç”»åŒ¹é…æ•ˆæœ
        function animateMatches(matches) {
            matches.forEach(match => {
                match.forEach(pos => {
                    const cell = document.querySelector(`.game-cell[data-row="${pos.row}"][data-col="${pos.col}"]`);
                    if (cell) {
                        cell.classList.add('matched');
                    }
                });
            });
        }
        // å¡«å……ç©ºä½ - ä¼˜åŒ–æ­¤å‡½æ•°ä»¥æé«˜æ€§èƒ½
        function fillEmptyCells() {
            for (let j = 0; j < BOARD_SIZE; j++) {
                let emptySpaces = 0;
                
                // ä»åº•éƒ¨å¼€å§‹å¤„ç†æ¯ä¸€åˆ—
                for (let i = BOARD_SIZE - 1; i >= 0; i--) {
                    if (gameState.board[i][j].type === '') {
                        emptySpaces++;
                    } else if (emptySpaces > 0 && 
                              gameState.board[i][j].type !== obstacleTypes.STONE && 
                              gameState.board[i][j].type !== obstacleTypes.LOCK) {
                        // ç§»åŠ¨å¯ç§»åŠ¨çš„æ–¹å—åˆ°ç©ºä½ï¼ˆçŸ³å¤´å’Œé”é“¾ä¸èƒ½ç§»åŠ¨ï¼‰
                        gameState.board[i + emptySpaces][j] = {...gameState.board[i][j]};
                        gameState.board[i][j] = {type: '', special: null, durability: 1};
                    }
                }
                
                // å¡«å……é¡¶éƒ¨çš„ç©ºä½
                for (let i = 0; i < emptySpaces; i++) {
                    if (gameState.board[i][j].type === '') {
                        gameState.board[i][j] = {
                            type: getRandomEmoji(),
                            special: null,
                            durability: 1
                        };
                    }
                }
            }
        }
        // è·å–éšæœºè¡¨æƒ…ç¬¦å·
        function getRandomEmoji() {
            return emojis[Math.floor(Math.random() * emojis.length)];
        }
        // éšæœºæ‰“ä¹±æ¸¸æˆæ¿å†…éƒ¨
        function shuffleBoardInternal() {
            for (let i = 0; i < BOARD_SIZE; i++) {
                for (let j = 0; j < BOARD_SIZE; j++) {
                    // åªæ‰“ä¹±æ™®é€šæ–¹å—ï¼Œä¿ç•™éšœç¢ç‰©
                    if (!isObstacle(gameState.board[i][j].type)) {
                        gameState.board[i][j] = {
                            type: getRandomEmoji(),
                            special: null,
                            durability: 1
                        };
                    }
                }
            }
        }
        // ä½¿ç”¨é“å…·
        function useTool(toolName) {
            if (gameState.tools[toolName] > 0) {
                gameState.tools[toolName]--;
                updateToolCounts();
                
                switch (toolName) {
                    case 'hammer':
                        showFloatingText("ä½¿ç”¨äº†é”¤å­é“å…·ï¼Œç‚¹å‡»ä¸€ä¸ªæ–¹å—æ¶ˆé™¤å®ƒ", "#6a11cb");
                        // è¿›å…¥é€‰æ‹©æ¨¡å¼
                        enableTargetSelectionMode('hammer');
                        break;
                    case 'bomb':
                        showFloatingText("ä½¿ç”¨äº†ç‚¸å¼¹é“å…·ï¼Œç‚¹å‡»ä¸­å¿ƒç‚¹æ¶ˆé™¤3x3åŒºåŸŸå†…çš„æ–¹å—", "#ff4757");
                        // è¿›å…¥é€‰æ‹©æ¨¡å¼
                        enableTargetSelectionMode('bomb');
                        break;
                    case 'shuffle':
                        shuffleBoard();
                        showFloatingText("ä½¿ç”¨äº†æ´—ç‰Œé“å…·", "#ffa502");
                        break;
                    case 'magic':
                        showFloatingText("ä½¿ç”¨äº†é­”æ³•æ£’é“å…·ï¼Œè‡ªåŠ¨å®Œæˆä¸€æ¬¡æœ€ä½³æ¶ˆé™¤", "#2ed573");
                        // è‡ªåŠ¨å¯»æ‰¾å¹¶æ‰§è¡Œæœ€ä½³æ¶ˆé™¤
                        performMagicMove();
                        break;
                }
                
                // ä¿å­˜é“å…·ä½¿ç”¨æƒ…å†µ
                saveUserData();
            } else {
                showFloatingText(`æ²¡æœ‰${getToolName(toolName)}é“å…·äº†ï¼Œè¯·å…ˆè´­ä¹°`, "#ff4757");
            }
        }
        // å¯ç”¨ç›®æ ‡é€‰æ‹©æ¨¡å¼
        function enableTargetSelectionMode(toolName) {
            const board = document.getElementById('game-board');
            board.addEventListener('click', function handler(e) {
                if (e.target.classList.contains('game-cell')) {
                    const row = parseInt(e.target.dataset.row);
                    const col = parseInt(e.target.dataset.col);
                    
                    switch (toolName) {
                        case 'hammer':
                            // é”¤å­æ¶ˆé™¤å•ä¸ªæ–¹å—
                            if (gameState.board[row][col].type !== obstacleTypes.STONE) {
                                gameState.board[row][col] = {type: '', special: null, durability: 1};
                                showFloatingText("é”¤å­é“å…·ä½¿ç”¨æˆåŠŸ", "#6a11cb");
                            } else {
                                showFloatingText("æ— æ³•ç ´åçŸ³å¤´éšœç¢ç‰©", "#ff4757");
                            }
                            break;
                        case 'bomb':
                            // ç‚¸å¼¹æ¶ˆé™¤3x3åŒºåŸŸ
                            for (let i = Math.max(0, row - 1); i <= Math.min(BOARD_SIZE - 1, row + 1); i++) {
                                for (let j = Math.max(0, col - 1); j <= Math.min(BOARD_SIZE - 1, col + 1); j++) {
                                    if (gameState.board[i][j].type !== obstacleTypes.STONE) {
                                        gameState.board[i][j] = {type: '', special: null, durability: 1};
                                    }
                                }
                            }
                            showFloatingText("ç‚¸å¼¹é“å…·ä½¿ç”¨æˆåŠŸ", "#ff4757");
                            break;
                    }
                    
                    // æ›´æ–°æ¸¸æˆæ¿
                    renderBoard();
                    board.removeEventListener('click', handler);
                }
            });
        }
        // æ‰§è¡Œé­”æ³•ç§»åŠ¨
        function performMagicMove() {
            // å¯»æ‰¾æœ€ä½³æ¶ˆé™¤ä½ç½®
            for (let i = 0; i < BOARD_SIZE; i++) {
                for (let j = 0; j < BOARD_SIZE; j++) {
                    // æ£€æŸ¥æ°´å¹³äº¤æ¢
                    if (j < BOARD_SIZE - 1) {
                        // æ£€æŸ¥ä¸¤ä¸ªæ–¹å—æ˜¯å¦éƒ½å¯ä»¥ç§»åŠ¨
                        if (gameState.board[i][j].type !== obstacleTypes.STONE && 
                            gameState.board[i][j].type !== obstacleTypes.LOCK &&
                            gameState.board[i][j+1].type !== obstacleTypes.STONE && 
                            gameState.board[i][j+1].type !== obstacleTypes.LOCK) {
                            // äº¤æ¢
                            swapCells(i, j, i, j+1);
                            if (hasMatches()) {
                                // æ‰¾åˆ°æœ‰æ•ˆç§»åŠ¨ï¼Œæ‰§è¡Œæ¶ˆé™¤
                                gameState.moves--; // ä½¿ç”¨é­”æ³•æ£’æ¶ˆè€—ä¸€æ­¥
                                updateUI();
                                // ä½¿ç”¨è¾ƒå°çš„å»¶è¿Ÿæ¥æé«˜å“åº”é€Ÿåº¦
                                setTimeout(() => {
                                    processMatches();
                                }, 50);
                                return;
                            }
                            // æ¢å›æ¥
                            swapCells(i, j, i, j+1);
                        }
                    }
                    
                    // æ£€æŸ¥å‚ç›´äº¤æ¢
                    if (i < BOARD_SIZE - 1) {
                        // æ£€æŸ¥ä¸¤ä¸ªæ–¹å—æ˜¯å¦éƒ½å¯ä»¥ç§»åŠ¨
                        if (gameState.board[i][j].type !== obstacleTypes.STONE && 
                            gameState.board[i][j].type !== obstacleTypes.LOCK &&
                            gameState.board[i+1][j].type !== obstacleTypes.STONE && 
                            gameState.board[i+1][j].type !== obstacleTypes.LOCK) {
                            // äº¤æ¢
                            swapCells(i, j, i+1, j);
                            if (hasMatches()) {
                                // æ‰¾åˆ°æœ‰æ•ˆç§»åŠ¨ï¼Œæ‰§è¡Œæ¶ˆé™¤
                                gameState.moves--; // ä½¿ç”¨é­”æ³•æ£’æ¶ˆè€—ä¸€æ­¥
                                updateUI();
                                // ä½¿ç”¨è¾ƒå°çš„å»¶è¿Ÿæ¥æé«˜å“åº”é€Ÿåº¦
                                setTimeout(() => {
                                    processMatches();
                                }, 50);
                                return;
                            }
                            // æ¢å›æ¥
                            swapCells(i, j, i+1, j);
                        }
                    }
                }
            }
            
            showFloatingText("æœªæ‰¾åˆ°æœ‰æ•ˆç§»åŠ¨", "#ff4757");
        }
        // æ´—ç‰ŒåŠŸèƒ½ - åªæ´—å¯ç§»åŠ¨çš„æ–¹å—
        function shuffleBoard() {
            // æ”¶é›†æ‰€æœ‰å¯ç§»åŠ¨çš„æ–¹å—
            const movableCells = [];
            const positions = [];
            
            for (let i = 0; i < BOARD_SIZE; i++) {
                for (let j = 0; j < BOARD_SIZE; j++) {
                    // åªæ”¶é›†å¯ç§»åŠ¨çš„æ™®é€šæ–¹å—
                    if (gameState.board[i][j].type !== obstacleTypes.STONE && 
                        gameState.board[i][j].type !== obstacleTypes.LOCK && 
                        gameState.board[i][j].durability <= 1 &&
                        gameState.board[i][j].type !== '') {
                        movableCells.push(gameState.board[i][j]);
                        positions.push({row: i, col: j});
                    }
                }
            }
            
            // æ´—ç‰Œå¯ç§»åŠ¨æ–¹å—
            for (let i = movableCells.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [movableCells[i], movableCells[j]] = [movableCells[j], movableCells[i]];
            }
            
            // é‡æ–°åˆ†é…æ´—ç‰Œåçš„æ–¹å—
            for (let i = 0; i < positions.length; i++) {
                const pos = positions[i];
                gameState.board[pos.row][pos.col] = movableCells[i];
            }
            
            renderBoard();
            showFloatingText("æ£‹ç›˜å·²é‡æ–°æ’åˆ—", "#2575fc");
            
            // é‡æ–°ç»‘å®šè§¦æ‘¸äº‹ä»¶ï¼Œç¡®ä¿æ¸¸æˆå¯ä»¥ç»§ç»­
            setupTouchEvents();
        }
        // è·å–é“å…·åç§°
        function getToolName(toolName) {
            const names = {
                'hammer': 'é”¤å­',
                'bomb': 'ç‚¸å¼¹',
                'shuffle': 'æ´—ç‰Œ',
                'magic': 'é­”æ³•æ£’'
            };
            return names[toolName] || toolName;
        }
        // è´­ä¹°é“å…· - è°ƒæ•´é“å…·ä»·æ ¼
        function buyTool(toolName) {
            const prices = {
                'hammer': 50,     // é”¤å­ï¼š50ğŸª™
                'bomb': 80,       // ç‚¸å¼¹ï¼š80ğŸª™
                'shuffle': 60,    // æ´—ç‰Œï¼š60ğŸª™
                'magic': 100      // é­”æ³•æ£’ï¼š100ğŸª™
            };
            
            const price = prices[toolName];
            if (gameState.coins >= price) {
                gameState.coins -= price;
                gameState.tools[toolName]++;
                updateUI();
                showFloatingText(`æˆåŠŸè´­ä¹°${getToolName(toolName)}é“å…·`, "#2ed573");
                closeModal('shop-modal');
                
                // ä¿å­˜æ•°æ®åˆ°æ•°æ®åº“
                saveUserData();
            } else {
                showFloatingText("ä¸‡èŠ±å¸ä¸è¶³ï¼Œæ— æ³•è´­ä¹°è¯¥é“å…·", "#ff4757");
            }
        }
        // é€šè¿‡è§‚çœ‹å¹¿å‘Šè·å–é“å…·
        function getToolByAd(toolName) {
            // æ¨¡æ‹Ÿè§‚çœ‹å¹¿å‘Š
            setTimeout(() => {
                gameState.tools[toolName]++;
                updateToolCounts();
                showFloatingText(`é€šè¿‡è§‚çœ‹å¹¿å‘Šè·å¾—${getToolName(toolName)}é“å…·`, "#2ed573");
                closeModal('shop-modal');
                
                // ä¿å­˜æ•°æ®åˆ°æ•°æ®åº“
                saveUserData();
            }, 1000);
        }
        // æ›´æ–°UI
        function updateUI() {
            document.getElementById('current-level').textContent = gameState.level;
            document.getElementById('target-score').textContent = gameState.targetScore;
            document.getElementById('moves-left').textContent = gameState.moves;
            document.getElementById('current-score').textContent = gameState.score;
            document.getElementById('coin-count').textContent = gameState.coins;
            
            // æ›´æ–°é“å…·æ•°é‡
            updateToolCounts();
            
            // æ›´æ–°è¿›åº¦æ¡
            const progress = Math.min(100, Math.max(0, (gameState.score / gameState.targetScore) * 100));
            document.getElementById('progress-bar').style.width = `${progress}%`;
            
            // æ›´æ–°å€’è®¡æ—¶æ˜¾ç¤º
            updateMoveTimerDisplay();
        }
        // æ›´æ–°é“å…·æ•°é‡
        function updateToolCounts() {
            document.getElementById('hammer-count').textContent = gameState.tools.hammer;
            document.getElementById('bomb-count').textContent = gameState.tools.bomb;
            document.getElementById('shuffle-count').textContent = gameState.tools.shuffle;
            document.getElementById('magic-count').textContent = gameState.tools.magic;
        }
        // æ›´æ–°å€’è®¡æ—¶æ˜¾ç¤º
        function updateMoveTimerDisplay() {
            const timerElement = document.getElementById('move-timer');
            if (timerElement) {
                timerElement.textContent = gameState.moveTimeLeft;
                // æ ¹æ®å‰©ä½™æ—¶é—´æ”¹å˜é¢œè‰²å’Œå¤§å°
                if (gameState.moveTimeLeft <= 3) {
                    timerElement.style.color = '#ff4757'; // çº¢è‰²
                    timerElement.style.fontWeight = 'bold';
                } else if (gameState.moveTimeLeft <= 5) {
                    timerElement.style.color = '#ffa502'; // æ©™è‰²
                } else {
                    timerElement.style.color = '#6a11cb'; // ç´«è‰²
                }
            }
        }
        // é‡ç½®æ­¥æ•°è®¡æ—¶å™¨
        function resetMoveTimer() {
            // æ¸…é™¤ä¹‹å‰çš„è®¡æ—¶å™¨
            if (gameState.moveTimer) {
                clearInterval(gameState.moveTimer);
                gameState.moveTimer = null;
            }
            
            // é‡ç½®æ—¶é—´
            gameState.moveTimeLeft = gameState.baseMoveTime;
            updateMoveTimerDisplay();
            
            // å¯åŠ¨æ–°è®¡æ—¶å™¨
            gameState.moveTimer = setInterval(() => {
                gameState.moveTimeLeft--;
                updateMoveTimerDisplay();
                
                // æ—¶é—´åˆ°
                if (gameState.moveTimeLeft <= 0) {
                    clearInterval(gameState.moveTimer);
                    gameState.moveTimer = null;
                    // æ—¶é—´åˆ°æç¤ºï¼Œä½†ä¸å‡å°‘æ­¥æ•°
                    showFloatingText("æ—¶é—´åˆ°ï¼è¯·åŠ å¿«æ“ä½œé€Ÿåº¦", "#ff4757");
                    // é‡å¯è®¡æ—¶å™¨
                    resetMoveTimer();
                }
            }, 1000);
        }
        // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
        function checkGameEnd() {
            // æ¸…é™¤è®¡æ—¶å™¨
            if (gameState.moveTimer) {
                clearInterval(gameState.moveTimer);
                gameState.moveTimer = null;
            }
            
            if (gameState.moves <= 0) {
                if (gameState.score >= gameState.targetScore) {
                    // é€šå…³ - å…³å¡å¥–åŠ±
                    const levelBonus = Math.min(5, 1 + Math.floor(gameState.level / 20));
                    gameState.coins += levelBonus;
                    showFireworks();
                    showFloatingText(`æ­å–œé€šå…³ï¼è·å¾—${levelBonus}ä¸‡èŠ±å¸å¥–åŠ±ï¼`, "#2ed573");
                    
                    // ä¿å­˜ç”¨æˆ·æ•°æ®
                    saveUserData();
                    
                    setTimeout(() => {
                        nextLevel();
                    }, 2000);
                } else {
                    // å¤±è´¥
                    showFloatingText(`æ¸¸æˆç»“æŸï¼å·®${gameState.targetScore - gameState.score}åˆ†é€šå…³`, "#ff4757");
                    setTimeout(() => {
                        showAttemptsModal();
                    }, 2000);
                }
            } else if (gameState.score >= gameState.targetScore) {
                // æå‰é€šå…³ - å…³å¡å¥–åŠ±
                const levelBonus = Math.min(5, 1 + Math.floor(gameState.level / 20));
                gameState.coins += levelBonus;
                showFireworks();
                showFloatingText(`æ­å–œæå‰é€šå…³ï¼è·å¾—${levelBonus}ä¸‡èŠ±å¸å¥–åŠ±ï¼`, "#2ed573");
                
                // ä¿å­˜ç”¨æˆ·æ•°æ®
                saveUserData();
                
                setTimeout(() => {
                    nextLevel();
                }, 2000);
            }
        }
        // ä¸‹ä¸€å…³
        function nextLevel() {
            // æ¸…é™¤å½“å‰è®¡æ—¶å™¨
            if (gameState.moveTimer) {
                clearInterval(gameState.moveTimer);
                gameState.moveTimer = null;
            }
            
            gameState.level++;
            // éšç€å…³å¡å¢åŠ ï¼Œç›®æ ‡åˆ†æ•°å¢é•¿æ›´å¿«
            gameState.targetScore = 500 + Math.floor(gameState.level * 30 * (1 + gameState.level * 0.08));
            // æ­¥æ•°éšå…³å¡é€’å‡ï¼Œä½†ä¸ä½äº10æ­¥
            gameState.moves = Math.max(10, 30 - Math.floor(gameState.level / 3));
            gameState.score = 0;
            // å‡å°‘æ¯æ­¥æ—¶é—´
            gameState.baseMoveTime = Math.max(5, 10 - Math.floor(gameState.level / 10));
            gameState.moveTimeLeft = gameState.baseMoveTime;
            createBoard();
            renderBoard();
            updateUI();
            // é‡å¯è®¡æ—¶å™¨
            resetMoveTimer();
            showFloatingText(`ç¬¬${gameState.level}å…³å¼€å§‹`, "#6a11cb");
            
            // ä¿å­˜ç”¨æˆ·æ•°æ®
            saveUserData();
        }
        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            // æ¸…é™¤å½“å‰è®¡æ—¶å™¨
            if (gameState.moveTimer) {
                clearInterval(gameState.moveTimer);
                gameState.moveTimer = null;
            }
            
            gameState.score = 0;
            gameState.moves = 30;
            gameState.baseMoveTime = 10;
            gameState.moveTimeLeft = gameState.baseMoveTime;
            createBoard();
            renderBoard();
            updateUI();
            // é‡å¯è®¡æ—¶å™¨
            resetMoveTimer();
            showFloatingText("æ¸¸æˆå·²é‡ç½®", "#6a11cb");
        }
        // æ˜¾ç¤ºæ¬¡æ•°ä¸è¶³å¼¹çª—
        function showAttemptsModal() {
            openModal('attempts-modal');
        }
        // è§‚çœ‹å¹¿å‘Š
        function watchAd() {
            closeModal('attempts-modal');
            gameState.coins += 20; // è§‚çœ‹å¹¿å‘Šå¥–åŠ±
            showFloatingText('è§‚çœ‹å¹¿å‘Šå®Œæˆï¼è·å¾—20ä¸‡èŠ±å¸å¥–åŠ±ï¼', '#ffa502');
            updateUI();
            
            // ä¿å­˜æ•°æ®åˆ°æ•°æ®åº“
            saveUserData();
        }
        // åˆ†äº«åˆ°ç¾¤ç»„
        function shareToGroup() {
            closeModal('attempts-modal');
            showFloatingText('åˆ†äº«åŠŸèƒ½å·²è§¦å‘ï¼Œè¯·åœ¨å¼¹å‡ºçš„Telegramç•Œé¢ä¸­é€‰æ‹©ç¾¤ç»„åˆ†äº«', '#2ed573');
            // å®é™…å®ç°ä¸­ä¼šè°ƒç”¨Telegramåˆ†äº«åŠŸèƒ½
        }
        // ç­¾åˆ° - è°ƒæ•´ç­¾åˆ°å¥–åŠ±
        function checkin() {
            // æ ¹æ®è¿ç»­ç­¾åˆ°å¤©æ•°ç»™å¥–åŠ±
            const reward = Math.min(10, 2 + Math.floor(Math.random() * 3)); // 2-10ä¸‡èŠ±å¸
            gameState.coins += reward;
            showFloatingText(`ç­¾åˆ°æˆåŠŸï¼è·å¾—${reward}ä¸‡èŠ±å¸å¥–åŠ±ï¼`, '#2ed573');
            updateUI();
            closeModal('checkin-modal');
            
            // ä¿å­˜æ•°æ®åˆ°æ•°æ®åº“
            saveUserData();
        }
        // æäº¤æç°ç”³è¯·
        function submitWithdraw(e) {
            e.preventDefault();
            const account = document.getElementById('alipay-account').value;
            const name = document.getElementById('real-name').value;
            const amount = parseInt(document.getElementById('withdraw-amount').value);
            
            if (!account || !name) {
                showFloatingText('è¯·å¡«å†™å®Œæ•´çš„æ”¯ä»˜å®è´¦å·å’ŒçœŸå®å§“å', '#ff4757');
                return;
            }
            
            // æç°é‡‘é¢è°ƒæ•´ä¸º1000èµ·ï¼Œä»¥1000çš„å€æ•°
            if (isNaN(amount) || amount < 1000 || amount % 1000 !== 0) {
                showFloatingText('æç°é‡‘é¢å¿…é¡»æ˜¯1000çš„å€æ•°ä¸”ä¸å°äº1000', '#ff4757');
                return;
            }
            
            if (amount > gameState.coins) {
                showFloatingText('ä¸‡èŠ±å¸ä½™é¢ä¸è¶³', '#ff4757');
                return;
            }
            
            gameState.coins -= amount;
            updateUI();
            closeModal('withdraw-modal');
            showFloatingText(`æç°ç”³è¯·å·²æäº¤ï¼${amount}ä¸‡èŠ±å¸å·²æ‰£é™¤ï¼Œé¢„è®¡3ä¸ªå·¥ä½œæ—¥å†…åˆ°è´¦`, '#2ed573');
            
            // ä¿å­˜æ•°æ®åˆ°æ•°æ®åº“
            saveUserData();
            
            // è®°å½•æç°äº¤æ˜“
            saveTransaction(amount, 'æç°', 'completed');
        }
        // æ˜¾ç¤ºæˆå°±
        function showAchievements() {
            const grid = document.getElementById('achievements-grid');
            grid.innerHTML = '';
            
            achievements.forEach(achievement => {
                const item = document.createElement('div');
                item.className = `achievement-item ${achievement.unlocked ? '' : 'locked'}`;
                item.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div class="achievement-name">${achievement.name}</div>
                `;
                grid.appendChild(item);
            });
            
            openModal('achievements-modal');
        }
        // æ‰“å¼€å¼¹çª—
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        // å…³é—­å¼¹çª—
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        // æ˜¾ç¤ºæµ®åŠ¨æ–‡å­—
        function showFloatingText(text, color) {
            const floatingText = document.createElement('div');
            floatingText.textContent = text;
            floatingText.style.position = 'fixed';
            floatingText.style.top = '50%';
            floatingText.style.left = '50%';
            floatingText.style.transform = 'translate(-50%, -50%)';
            floatingText.style.backgroundColor = color;
            floatingText.style.color = 'white';
            floatingText.style.padding = '15px 25px';
            floatingText.style.borderRadius = '30px';
            floatingText.style.zIndex = '2000';
            floatingText.style.fontWeight = 'bold';
            floatingText.style.boxShadow = '0 5px 15px rgba(0,0,0,0.3)';
            floatingText.style.opacity = '0';
            floatingText.style.transition = 'opacity 0.3s, transform 0.3s';
            
            document.body.appendChild(floatingText);
            
            // æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(() => {
                floatingText.style.opacity = '1';
                floatingText.style.transform = 'translate(-50%, -50%) scale(1.1)';
            }, 10);
            
            // ç§»é™¤å…ƒç´ 
            setTimeout(() => {
                floatingText.style.opacity = '0';
                floatingText.style.transform = 'translate(-50%, -50%) scale(0.8)';
                setTimeout(() => {
                    document.body.removeChild(floatingText);
                }, 300);
            }, 2000);
        }
        // æ˜¾ç¤ºçƒŸèŠ±æ•ˆæœ
        function showFireworks() {
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    createFirework(Math.random() * window.innerWidth, Math.random() * window.innerHeight);
                }, i * 300);
            }
        }
        // åˆ›å»ºçƒŸèŠ±ç²’å­
        function createFirework(x, y) {
            const colors = ['#ff9a9e', '#fad0c4', '#a18cd1', '#fbc2eb', '#6a11cb', '#2575fc'];
            
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'firework-particle';
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;
                particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                
                // éšæœºæ–¹å‘
                const angle = Math.random() * Math.PI * 2;
                const distance = 50 + Math.random() * 100;
                const xOffset = Math.cos(angle) * distance;
                const yOffset = Math.sin(angle) * distance;
                
                particle.style.setProperty('--x', `${xOffset}px`);
                particle.style.setProperty('--y', `${yOffset}px`);
                
                document.body.appendChild(particle);
                
                // 2ç§’åç§»é™¤
                setTimeout(() => {
                    particle.remove();
                }, 1000);
            }
        }
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
