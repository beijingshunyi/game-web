<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∏áËä±Ê∂àÊ∂à‰πê</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background-color: #fff;
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        
        /* È°∂ÈÉ®ÂØºËà™Ê†è */
        .header {
            background: linear-gradient(135deg, #ff7e5f, #feb47b);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .coins {
            display: flex;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 20px;
        }
        
        .coins i {
            margin-right: 5px;
            color: #ffd700;
        }
        
        .menu-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }
        
        /* ‰∏ªÈ°µÂÜÖÂÆπ */
        .main-content {
            padding: 20px;
        }
        
        .level-map {
            background-color: #f9f9f9;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 400px;
            position: relative;
            overflow: hidden;
        }
        
        .level-path {
            position: relative;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .level-node {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #ff7e5f;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            position: absolute;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .level-node:hover {
            transform: scale(1.1);
        }
        
        .level-node.completed {
            background-color: #4CAF50;
        }
        
        .level-node.current {
            background-color: #2196F3;
            animation: pulse 2s infinite;
        }
        
        .level-node.locked {
            background-color: #9e9e9e;
            cursor: not-allowed;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(33, 150, 243, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(33, 150, 243, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(33, 150, 243, 0);
            }
        }
        
        .level-stars {
            position: absolute;
            bottom: -15px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
        }
        
        .level-stars i {
            color: #ffd700;
            font-size: 12px;
            margin: 0 1px;
        }
        
        /* Â∫ïÈÉ®ÂØºËà™ */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: white;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #757575;
            text-decoration: none;
            font-size: 12px;
            transition: color 0.3s;
        }
        
        .nav-item.active {
            color: #ff7e5f;
        }
        
        .nav-item i {
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        /* ÁôªÂΩïÈ°µÈù¢ */
        .login-page {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #ff7e5f, #feb47b);
            color: white;
            text-align: center;
            padding: 20px;
        }
        
        .login-page h1 {
            font-size: 32px;
            margin-bottom: 20px;
        }
        
        .login-page p {
            margin-bottom: 30px;
            font-size: 16px;
            line-height: 1.5;
        }
        
        .login-btn {
            background-color: white;
            color: #ff7e5f;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        
        /* Ê∏∏ÊàèÈ°µÈù¢ */
        .game-page {
            display: none;
            padding-bottom: 70px;
        }
        
        .game-header {
            background-color: #ff7e5f;
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .game-info {
            display: flex;
            align-items: center;
        }
        
        .game-info-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 10px;
        }
        
        .game-info-item span {
            font-size: 12px;
        }
        
        .game-info-item strong {
            font-size: 18px;
        }
        
        .game-board {
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        
        .board {
            display: grid;
            grid-template-columns: repeat(8, 40px);
            grid-template-rows: repeat(8, 40px);
            gap: 2px;
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .tile {
            width: 40px;
            height: 40px;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tile:hover {
            transform: scale(1.05);
        }
        
        .tile.selected {
            box-shadow: 0 0 0 3px #ffeb3b;
            transform: scale(1.1);
        }
        
        .tile.type-1 { background-color: #f44336; }
        .tile.type-2 { background-color: #e91e63; }
        .tile.type-3 { background-color: #9c27b0; }
        .tile.type-4 { background-color: #673ab7; }
        .tile.type-5 { background-color: #3f51b5; }
        .tile.type-6 { background-color: #2196f3; }
        
        .tile.rocket-h::before {
            content: "‚Üí";
            color: white;
            font-size: 24px;
            font-weight: bold;
        }
        
        .tile.rocket-v::before {
            content: "‚Üì";
            color: white;
            font-size: 24px;
            font-weight: bold;
        }
        
        .tile.bomb::before {
            content: "üí£";
            font-size: 24px;
        }
        
        .tile.rainbow::before {
            content: "üåà";
            font-size: 24px;
        }
        
        .tile.ice::after {
            content: "‚ùÑÔ∏è";
            position: absolute;
            top: 0;
            right: 0;
            font-size: 16px;
        }
        
        .tile.rope::after {
            content: "üîó";
            position: absolute;
            top: 0;
            right: 0;
            font-size: 16px;
        }
        
        .tile.chocolate::after {
            content: "üç´";
            position: absolute;
            top: 0;
            right: 0;
            font-size: 16px;
        }
        
        .tile.cage::after {
            content: "üîí";
            position: absolute;
            top: 0;
            right: 0;
            font-size: 16px;
        }
        
        .tile.cloud::after {
            content: "‚òÅÔ∏è";
            position: absolute;
            top: 0;
            right: 0;
            font-size: 16px;
        }
        
        .game-items {
            display: flex;
            justify-content: space-around;
            padding: 15px;
            background-color: #f9f9f9;
            border-top: 1px solid #eee;
        }
        
        .game-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .game-item:hover {
            transform: scale(1.1);
        }
        
        .game-item i {
            font-size: 24px;
            margin-bottom: 5px;
            color: #ff7e5f;
        }
        
        .game-item span {
            font-size: 12px;
        }
        
        /* ‰ªªÂä°È°µÈù¢ */
        .tasks-page {
            display: none;
            padding: 20px;
            padding-bottom: 70px;
        }
        
        .task-card {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .task-title {
            font-weight: bold;
            font-size: 16px;
        }
        
        .task-reward {
            display: flex;
            align-items: center;
            color: #ff7e5f;
        }
        
        .task-reward i {
            margin-right: 5px;
            color: #ffd700;
        }
        
        .task-description {
            color: #757575;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .task-progress {
            height: 8px;
            background-color: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }
        
        .task-progress-bar {
            height: 100%;
            background-color: #ff7e5f;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .task-progress-text {
            font-size: 12px;
            color: #757575;
            text-align: right;
        }
        
        .task-completed {
            color: #4CAF50;
            font-weight: bold;
        }
        
        /* Á≠æÂà∞È°µÈù¢ */
        .check-in-page {
            display: none;
            padding: 20px;
            padding-bottom: 70px;
            text-align: center;
        }
        
        .check-in-card {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .check-in-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #ff7e5f;
        }
        
        .check-in-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .check-in-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 10px;
            background-color: #f9f9f9;
            position: relative;
        }
        
        .check-in-day.checked {
            background-color: #ff7e5f;
            color: white;
        }
        
        .check-in-day.today {
            border: 2px solid #ff7e5f;
        }
        
        .check-in-day-number {
            font-weight: bold;
            font-size: 14px;
        }
        
        .check-in-day-reward {
            font-size: 10px;
            margin-top: 2px;
        }
        
        .check-in-btn {
            background-color: #ff7e5f;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .check-in-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        
        .check-in-btn:disabled {
            background-color: #9e9e9e;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .consecutive-days {
            margin-top: 15px;
            color: #757575;
            font-size: 14px;
        }
        
        /* ÊéíË°åÊ¶úÈ°µÈù¢ */
        .leaderboard-page {
            display: none;
            padding: 20px;
            padding-bottom: 70px;
        }
        
        .leaderboard-card {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .leaderboard-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #ff7e5f;
            text-align: center;
        }
        
        .leaderboard-list {
            list-style: none;
        }
        
        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .leaderboard-item:last-child {
            border-bottom: none;
        }
        
        .leaderboard-rank {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            margin-right: 15px;
        }
        
        .leaderboard-item:nth-child(1) .leaderboard-rank {
            background-color: #ffd700;
            color: white;
        }
        
        .leaderboard-item:nth-child(2) .leaderboard-rank {
            background-color: #c0c0c0;
            color: white;
        }
        
        .leaderboard-item:nth-child(3) .leaderboard-rank {
            background-color: #cd7f32;
            color: white;
        }
        
        .leaderboard-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
        }
        
        .leaderboard-info {
            flex: 1;
        }
        
        .leaderboard-name {
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .leaderboard-coins {
            display: flex;
            align-items: center;
            color: #757575;
            font-size: 14px;
        }
        
        .leaderboard-coins i {
            margin-right: 5px;
            color: #ffd700;
        }
        
        .user-rank {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 10px;
            text-align: center;
        }
        
        .user-rank-title {
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .user-rank-info {
            font-size: 18px;
            color: #ff7e5f;
        }
        
        /* ÊèêÁé∞È°µÈù¢ */
        .withdraw-page {
            display: none;
            padding: 20px;
            padding-bottom: 70px;
        }
        
        .withdraw-card {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .withdraw-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #ff7e5f;
            text-align: center;
        }
        
        .withdraw-balance {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .withdraw-balance-label {
            color: #757575;
        }
        
        .withdraw-balance-value {
            font-size: 18px;
            font-weight: bold;
            color: #ff7e5f;
        }
        
        .withdraw-form {
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #ff7e5f;
        }
        
        .withdraw-btn {
            width: 100%;
            background-color: #ff7e5f;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .withdraw-btn:hover {
            background-color: #e56a4f;
        }
        
        .withdraw-btn:disabled {
            background-color: #9e9e9e;
            cursor: not-allowed;
        }
        
        .withdraw-records {
            margin-top: 20px;
        }
        
        .withdraw-records-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .withdraw-record {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .withdraw-record:last-child {
            border-bottom: none;
        }
        
        .withdraw-record-info {
            flex: 1;
        }
        
        .withdraw-record-amount {
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .withdraw-record-date {
            font-size: 12px;
            color: #757575;
        }
        
        .withdraw-record-status {
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-approved {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-completed {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .status-rejected {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        /* ÊàêÂ∞±È°µÈù¢ */
        .achievements-page {
            display: none;
            padding: 20px;
            padding-bottom: 70px;
        }
        
        .achievement-card {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
        }
        
        .achievement-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .achievement-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 15px;
            font-size: 24px;
        }
        
        .achievement-icon.unlocked {
            background-color: #ff7e5f;
            color: white;
        }
        
        .achievement-info {
            flex: 1;
        }
        
        .achievement-title {
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .achievement-description {
            font-size: 14px;
            color: #757575;
        }
        
        .achievement-reward {
            display: flex;
            align-items: center;
            color: #ff7e5f;
            font-weight: bold;
        }
        
        .achievement-reward i {
            margin-right: 5px;
            color: #ffd700;
        }
        
        /* ÂºπÂá∫ÊèêÁ§∫ */
        .toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 16px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .toast.show {
            opacity: 1;
        }
        
        /* Ê∏∏ÊàèÊ¨°Êï∞‰∏çË∂≥ÂºπÁ™ó */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 200;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            color: #ff7e5f;
        }
        
        .modal-body {
            margin-bottom: 20px;
            text-align: center;
        }
        
        .modal-footer {
            display: flex;
            justify-content: space-between;
        }
        
        .modal-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .modal-btn-cancel {
            background-color: #f0f0f0;
            color: #757575;
            margin-right: 10px;
        }
        
        .modal-btn-confirm {
            background-color: #ff7e5f;
            color: white;
        }
        
        .modal-btn:hover {
            opacity: 0.9;
        }
        
        /* È°µËÑö */
        .footer {
            padding: 10px;
            text-align: center;
            font-size: 12px;
            color: #757575;
            background-color: #f9f9f9;
            margin-top: 20px;
        }
        
        .footer a {
            color: #ff7e5f;
            text-decoration: none;
        }
        
        /* Âä†ËΩΩÂä®Áîª */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ff7e5f;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ÁôªÂΩïÈ°µÈù¢ -->
        <div class="login-page" id="loginPage">
            <h1>‰∏áËä±Ê∂àÊ∂à‰πê</h1>
            <p>ÂÆåÊàêÂÖ≥Âç°Âíå‰ªªÂä°ÂèØËé∑Âæó‰∏áËä±Â∏ÅÔºåÁ¥ØÁßØ‰∏ÄÂÆöÊï∞ÈáèÂêéÂèØ‰ª•ÊèêÁé∞ÔºÅ</p>
            <button class="login-btn" id="loginBtn">‰ΩøÁî®TelegramÁôªÂΩï</button>
        </div>
        
        <!-- ‰∏ªÈ°µÈù¢ -->
        <div class="main-page" id="mainPage" style="display: none;">
            <div class="header">
                <div class="coins">
                    <i class="fas fa-coins"></i>
                    <span id="userCoins">0</span>
                </div>
                <h1>‰∏áËä±Ê∂àÊ∂à‰πê</h1>
                <button class="menu-btn" id="menuBtn">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <div class="main-content">
                <div class="level-map" id="levelMap">
                    <div class="level-path" id="levelPath">
                        <!-- ÂÖ≥Âç°ËäÇÁÇπÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                    </div>
                </div>
            </div>
            
            <div class="bottom-nav">
                <a href="#" class="nav-item active" data-page="main">
                    <i class="fas fa-home"></i>
                    <span>È¶ñÈ°µ</span>
                </a>
                <a href="#" class="nav-item" data-page="tasks">
                    <i class="fas fa-tasks"></i>
                    <span>‰ªªÂä°</span>
                </a>
                <a href="#" class="nav-item" data-page="checkin">
                    <i class="fas fa-calendar-check"></i>
                    <span>Á≠æÂà∞</span>
                </a>
                <a href="#" class="nav-item" data-page="leaderboard">
                    <i class="fas fa-trophy"></i>
                    <span>ÊéíË°åÊ¶ú</span>
                </a>
                <a href="#" class="nav-item" data-page="withdraw">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>ÊèêÁé∞</span>
                </a>
            </div>
        </div>
        
        <!-- Ê∏∏ÊàèÈ°µÈù¢ -->
        <div class="game-page" id="gamePage">
            <div class="game-header">
                <div class="game-info">
                    <div class="game-info-item">
                        <span>ÁõÆÊ†á</span>
                        <strong id="gameTarget">0</strong>
                    </div>
                    <div class="game-info-item">
                        <span>Ê≠•Êï∞</span>
                        <strong id="gameMoves">0</strong>
                    </div>
                    <div class="game-info-item">
                        <span>ÂàÜÊï∞</span>
                        <strong id="gameScore">0</strong>
                    </div>
                </div>
                <button class="menu-btn" id="backBtn">
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>
            
            <div class="game-board">
                <div class="board" id="gameBoard">
                    <!-- Ê∏∏ÊàèÊ£ãÁõòÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
            
            <div class="game-items">
                <div class="game-item" data-item="refresh">
                    <i class="fas fa-sync-alt"></i>
                    <span>Âà∑Êñ∞</span>
                </div>
                <div class="game-item" data-item="hammer">
                    <i class="fas fa-hammer"></i>
                    <span>Èî§Â≠ê</span>
                </div>
                <div class="game-item" data-item="bomb">
                    <i class="fas fa-bomb"></i>
                    <span>ÁÇ∏Âºπ</span>
                </div>
                <div class="game-item" data-item="color">
                    <i class="fas fa-palette"></i>
                    <span>ÂèòËâ≤</span>
                </div>
            </div>
        </div>
        
        <!-- ‰ªªÂä°È°µÈù¢ -->
        <div class="tasks-page" id="tasksPage">
            <div class="header">
                <div class="coins">
                    <i class="fas fa-coins"></i>
                    <span id="tasksUserCoins">0</span>
                </div>
                <h1>ÊØèÊó•‰ªªÂä°</h1>
                <button class="menu-btn" id="tasksMenuBtn">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <div id="tasksList">
                <!-- ‰ªªÂä°ÂàóË°®Â∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
            </div>
        </div>
        
        <!-- Á≠æÂà∞È°µÈù¢ -->
        <div class="check-in-page" id="checkInPage">
            <div class="header">
                <div class="coins">
                    <i class="fas fa-coins"></i>
                    <span id="checkInUserCoins">0</span>
                </div>
                <h1>ÊØèÊó•Á≠æÂà∞</h1>
                <button class="menu-btn" id="checkInMenuBtn">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <div class="check-in-card">
                <div class="check-in-title">ËøûÁª≠Á≠æÂà∞Ëµ¢Â•ΩÁ§º</div>
                <div class="check-in-calendar" id="checkInCalendar">
                    <!-- Á≠æÂà∞Êó•ÂéÜÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                </div>
                <button class="check-in-btn" id="checkInBtn">Á≠æÂà∞</button>
                <div class="consecutive-days" id="consecutiveDays">Â∑≤ËøûÁª≠Á≠æÂà∞ 0 Â§©</div>
            </div>
        </div>
        
        <!-- ÊéíË°åÊ¶úÈ°µÈù¢ -->
        <div class="leaderboard-page" id="leaderboardPage">
            <div class="header">
                <div class="coins">
                    <i class="fas fa-coins"></i>
                    <span id="leaderboardUserCoins">0</span>
                </div>
                <h1>ÊéíË°åÊ¶ú</h1>
                <button class="menu-btn" id="leaderboardMenuBtn">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <div class="leaderboard-card">
                <div class="leaderboard-title">Êú¨Êúà‰∏áËä±Â∏ÅÊéíË°åÊ¶ú</div>
                <ul class="leaderboard-list" id="leaderboardList">
                    <!-- ÊéíË°åÊ¶úÂàóË°®Â∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                </ul>
                <div class="user-rank" id="userRank">
                    <div class="user-rank-title">ÊÇ®ÁöÑÊéíÂêç</div>
                    <div class="user-rank-info">Êú™‰∏äÊ¶ú</div>
                </div>
            </div>
        </div>
        
        <!-- ÊèêÁé∞È°µÈù¢ -->
        <div class="withdraw-page" id="withdrawPage">
            <div class="header">
                <div class="coins">
                    <i class="fas fa-coins"></i>
                    <span id="withdrawUserCoins">0</span>
                </div>
                <h1>ÊèêÁé∞</h1>
                <button class="menu-btn" id="withdrawMenuBtn">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <div class="withdraw-card">
                <div class="withdraw-title">‰∏áËä±Â∏ÅÊèêÁé∞</div>
                <div class="withdraw-balance">
                    <div class="withdraw-balance-label">ÂΩìÂâç‰ΩôÈ¢ù</div>
                    <div class="withdraw-balance-value" id="currentBalance">0 ‰∏áËä±Â∏Å</div>
                </div>
                
                <div class="withdraw-form">
                    <div class="form-group">
                        <label class="form-label" for="withdrawAmount">ÊèêÁé∞ÈáëÈ¢ù (‰∏áËä±Â∏Å)</label>
                        <input type="number" class="form-input" id="withdrawAmount" placeholder="ËØ∑ËæìÂÖ•ÊèêÁé∞ÈáëÈ¢ùÔºåÊúÄÂ∞ë1000‰∏á" min="1000" step="100">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="alipayAccount">ÊîØ‰ªòÂÆùË¥¶Âè∑</label>
                        <input type="text" class="form-input" id="alipayAccount" placeholder="ËØ∑ËæìÂÖ•ÊîØ‰ªòÂÆùË¥¶Âè∑">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="realName">ÁúüÂÆûÂßìÂêç</label>
                        <input type="text" class="form-input" id="realName" placeholder="ËØ∑ËæìÂÖ•ÁúüÂÆûÂßìÂêç">
                    </div>
                    <button class="withdraw-btn" id="submitWithdrawBtn">Êèê‰∫§ÊèêÁé∞Áî≥ËØ∑</button>
                </div>
                
                <div class="withdraw-records">
                    <div class="withdraw-records-title">ÊèêÁé∞ËÆ∞ÂΩï</div>
                    <div id="withdrawRecordsList">
                        <!-- ÊèêÁé∞ËÆ∞ÂΩïÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ÊàêÂ∞±È°µÈù¢ -->
        <div class="achievements-page" id="achievementsPage">
            <div class="header">
                <div class="coins">
                    <i class="fas fa-coins"></i>
                    <span id="achievementsUserCoins">0</span>
                </div>
                <h1>ÊàêÂ∞±</h1>
                <button class="menu-btn" id="achievementsMenuBtn">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <div id="achievementsList">
                <!-- ÊàêÂ∞±ÂàóË°®Â∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
            </div>
        </div>
        
        <!-- Ê∏∏ÊàèÊ¨°Êï∞‰∏çË∂≥ÂºπÁ™ó -->
        <div class="modal" id="noPlaysModal">
            <div class="modal-content">
                <div class="modal-header">Ê∏∏ÊàèÊ¨°Êï∞‰∏çË∂≥</div>
                <div class="modal-body">
                    <p>‰ªäÊó•ÂÖçË¥πÊ∏∏ÊàèÊ¨°Êï∞Â∑≤Áî®ÂÆåÔºåÊÇ®ÂèØ‰ª•ÈÄöËøá‰ª•‰∏ãÊñπÂºèËé∑ÂèñÈ¢ùÂ§ñÊ∏∏ÊàèÊ¨°Êï∞Ôºö</p>
                    <ul style="text-align: left; margin: 15px 0;">
                        <li>ÂàÜ‰∫´Âà∞TelegramÁæ§ÁªÑÊàñÈ¢ëÈÅìÔºö+2Ê¨°/Êó•ÔºàÊúÄÂ§ö3Ê¨°Ôºâ</li>
                        <li>ËßÇÁúãÂπøÂëäÔºö+1Ê¨°/ÊØèÊ¨°ÔºàÊúÄÂ§ö5Ê¨°/Êó•Ôºâ</li>
                        <li>Â•ΩÂèãËµ†ÈÄÅÔºöÂèØÊé•Êî∂Â•ΩÂèãËµ†ÈÄÅÁöÑÊ∏∏ÊàèÊ¨°Êï∞</li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button class="modal-btn modal-btn-cancel" id="cancelModalBtn">ÂèñÊ∂à</button>
                    <button class="modal-btn modal-btn-confirm" id="shareBtn">ÂàÜ‰∫´Ëé∑ÂèñÊ¨°Êï∞</button>
                </div>
            </div>
        </div>
        
        <!-- ÊèêÁ§∫Ê°Ü -->
        <div class="toast" id="toast"></div>
        
        <!-- È°µËÑö -->
        <div class="footer">
            Êú¨Ê∏∏ÊàèÁî±Âåó‰∫¨‰øÆËΩ¶„Äê‰∏áËä±Ê•º„ÄëËµûÂä©ÔºõÁî± <a href="https://t.me/bjxc010" target="_blank">@bjxc010</a> ÂºÄÂèë
        </div>
    </div>
    
    <script>
        // APIÂü∫Á°ÄURL
        const API_BASE_URL = 'https://wanhua-game.bingkuijing.workers.dev/api';
        
        // ÂÖ®Â±ÄÂèòÈáè
        let currentUser = null;
        let sessionToken = null;
        let levels = [];
        let gameBoard = [];
        let selectedTile = null;
        let gameLevel = null;
        let gameMoves = 0;
        let gameScore = 0;
        let gameTarget = 0;
        let gameActive = false;
        let isTelegramWebApp = false;
        
        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // Ê£ÄÊü•ÊòØÂê¶Âú®Telegram WebAppÁéØÂ¢É‰∏≠
            checkTelegramWebApp();
            
            // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁôªÂΩï
            checkLoginStatus();
            
            // ÁªëÂÆö‰∫ã‰ª∂
            bindEvents();
        });
        
        // Ê£ÄÊü•ÊòØÂê¶Âú®Telegram WebAppÁéØÂ¢É‰∏≠
        function checkTelegramWebApp() {
            // Ê£ÄÊü•Telegram WebApp
            if (window.Telegram && window.Telegram.WebApp) {
                isTelegramWebApp = true;
                const webApp = window.Telegram.WebApp;
                webApp.ready();
                webApp.expand();
                
                // ËÆæÁΩÆ‰∏ªÈ¢òÈ¢úËâ≤
                webApp.setHeaderColor('#ff7e5f');
                webApp.setBackgroundColor('#ffffff');
                
                // ËÆæÁΩÆ‰∏ªÊåâÈíÆ
                webApp.MainButton.setText('ÂºÄÂßãÊ∏∏Êàè').show().onClick(function() {
                    if (!currentUser) {
                        // Ëá™Âä®ÁôªÂΩï
                        autoLogin();
                    } else {
                        // Â∑≤ÁªèÁôªÂΩïÔºåÂàáÊç¢Âà∞‰∏ªÈ°µÈù¢
                        showMainPage();
                    }
                });
                
                // ÈöêËóèÁôªÂΩïÊåâÈíÆÔºåÊòæÁ§∫‰∏ªÊåâÈíÆ
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainPage').style.display = 'block';
                
                // Â∞ùËØïËá™Âä®ÁôªÂΩï
                autoLogin();
            } else {
                // ‰∏çÂú®Telegram‰∏≠ÔºåÊòæÁ§∫ÁôªÂΩïÈ°µÈù¢
                isTelegramWebApp = false;
                document.getElementById('loginPage').style.display = 'flex';
                document.getElementById('mainPage').style.display = 'none';
            }
        }
        
        // Ëá™Âä®ÁôªÂΩï
        function autoLogin() {
            if (!isTelegramWebApp || !window.Telegram || !window.Telegram.WebApp) return;
            
            const webApp = window.Telegram.WebApp;
            const initData = webApp.initData;
            
            if (!initData) {
                showToast('Êó†Ê≥ïËé∑ÂèñÁôªÂΩï‰ø°ÊÅØÔºåËØ∑ÈáçËØï');
                return;
            }
            
            // ÂèëÈÄÅÁî®Êà∑Êï∞ÊçÆÂà∞ÂêéÁ´ØËøõË°åÈ™åËØÅ
            fetch(`${API_BASE_URL}/auth`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(initData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    currentUser = data.user;
                    sessionToken = data.session_token;
                    localStorage.setItem('sessionToken', sessionToken);
                    showMainPage();
                    loadUserData();
                    showToast('ÁôªÂΩïÊàêÂäüÔºÅ');
                    
                    // ÈöêËóè‰∏ªÊåâÈíÆ
                    if (window.Telegram && window.Telegram.WebApp) {
                        window.Telegram.WebApp.MainButton.hide();
                    }
                } else {
                    showToast('ÁôªÂΩïÂ§±Ë¥•Ôºö' + data.message);
                }
            })
            .catch(error => {
                console.error('Error logging in:', error);
                showToast('ÁôªÂΩïÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
            });
        }
        
        // Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ
        function checkLoginStatus() {
            const savedSessionToken = localStorage.getItem('sessionToken');
            
            if (savedSessionToken && !isTelegramWebApp) {
                // È™åËØÅ‰ºöËØù
                fetch(`${API_BASE_URL}/validate-session`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ session_token: savedSessionToken })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        currentUser = data.user;
                        sessionToken = savedSessionToken;
                        showMainPage();
                        loadUserData();
                    } else {
                        if (!isTelegramWebApp) {
                            showLoginPage();
                        }
                    }
                })
                .catch(error => {
                    console.error('Error validating session:', error);
                    if (!isTelegramWebApp) {
                        showLoginPage();
                    }
                });
            }
        }
        
        // ÊòæÁ§∫ÁôªÂΩïÈ°µÈù¢
        function showLoginPage() {
            if (isTelegramWebApp) {
                // Âú®Telegram‰∏≠Ôºå‰∏çÊòæÁ§∫ÁôªÂΩïÈ°µÈù¢ÔºåÂ∞ùËØïËá™Âä®ÁôªÂΩï
                autoLogin();
                return;
            }
            
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('mainPage').style.display = 'none';
        }
        
        // ÊòæÁ§∫‰∏ªÈ°µÈù¢
        function showMainPage() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainPage').style.display = 'block';
            
            // Âä†ËΩΩÂÖ≥Âç°
            loadLevels();
        }
        
        // ÁªëÂÆö‰∫ã‰ª∂
        function bindEvents() {
            // ÁôªÂΩïÊåâÈíÆ
            document.getElementById('loginBtn').addEventListener('click', function() {
                // ‰ΩøÁî®TelegramÁôªÂΩï
                if (window.Telegram && window.Telegram.WebApp) {
                    const webApp = window.Telegram.WebApp;
                    webApp.ready();
                    
                    const user = webApp.initDataUnsafe.user;
                    
                    if (user) {
                        // ÂèëÈÄÅÁî®Êà∑Êï∞ÊçÆÂà∞ÂêéÁ´ØËøõË°åÈ™åËØÅ
                        fetch(`${API_BASE_URL}/auth`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(window.Telegram.WebApp.initData)
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                currentUser = data.user;
                                sessionToken = data.session_token;
                                localStorage.setItem('sessionToken', sessionToken);
                                showMainPage();
                                loadUserData();
                                showToast('ÁôªÂΩïÊàêÂäüÔºÅ');
                            } else {
                                showToast('ÁôªÂΩïÂ§±Ë¥•Ôºö' + data.message);
                            }
                        })
                        .catch(error => {
                            console.error('Error logging in:', error);
                            showToast('ÁôªÂΩïÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
                        });
                    } else {
                        showToast('Êó†Ê≥ïËé∑ÂèñÁî®Êà∑‰ø°ÊÅØÔºåËØ∑ÈáçËØï');
                    }
                } else {
                    showToast('ËØ∑Âú®TelegramÂÜÖÊâìÂºÄÊ∏∏Êàè');
                }
            });
            
            // Â∫ïÈÉ®ÂØºËà™
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const page = this.getAttribute('data-page');
                    switchPage(page);
                });
            });
            
            // ËøîÂõûÊåâÈíÆ
            document.getElementById('backBtn').addEventListener('click', function() {
                document.getElementById('gamePage').style.display = 'none';
                document.getElementById('mainPage').style.display = 'block';
            });
            
            // ËèúÂçïÊåâÈíÆ
            document.getElementById('menuBtn').addEventListener('click', function() {
                // ÊòæÁ§∫ËèúÂçï
                showMenu();
            });
            
            document.getElementById('tasksMenuBtn').addEventListener('click', function() {
                showMenu();
            });
            
            document.getElementById('checkInMenuBtn').addEventListener('click', function() {
                showMenu();
            });
            
            document.getElementById('leaderboardMenuBtn').addEventListener('click', function() {
                showMenu();
            });
            
            document.getElementById('withdrawMenuBtn').addEventListener('click', function() {
                showMenu();
            });
            
            document.getElementById('achievementsMenuBtn').addEventListener('click', function() {
                showMenu();
            });
            
            // Á≠æÂà∞ÊåâÈíÆ
            document.getElementById('checkInBtn').addEventListener('click', function() {
                if (!currentUser) return;
                
                fetch(`${API_BASE_URL}/check-in`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${sessionToken}`
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showToast(`Á≠æÂà∞ÊàêÂäüÔºÅËé∑Âæó${data.coin_reward}‰∏áËä±Â∏Å`);
                        document.getElementById('checkInBtn').disabled = true;
                        document.getElementById('checkInBtn').textContent = 'Â∑≤Á≠æÂà∞';
                        document.getElementById('consecutiveDays').textContent = `Â∑≤ËøûÁª≠Á≠æÂà∞ ${data.consecutive_days} Â§©`;
                        updateCoins(data.coin_reward);
                        loadCheckInCalendar();
                    } else {
                        showToast(data.message);
                    }
                })
                .catch(error => {
                    console.error('Error checking in:', error);
                    showToast('Á≠æÂà∞Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
                });
            });
            
            // ÊèêÁé∞ÊåâÈíÆ
            document.getElementById('submitWithdrawBtn').addEventListener('click', function() {
                if (!currentUser) return;
                
                const amount = parseInt(document.getElementById('withdrawAmount').value);
                const alipayAccount = document.getElementById('alipayAccount').value.trim();
                const realName = document.getElementById('realName').value.trim();
                
                if (!amount || amount < 1000) {
                    showToast('ÊèêÁé∞ÈáëÈ¢ù‰∏çËÉΩÂ∞ë‰∫é1000‰∏áËä±Â∏Å');
                    return;
                }
                
                if (!alipayAccount) {
                    showToast('ËØ∑ËæìÂÖ•ÊîØ‰ªòÂÆùË¥¶Âè∑');
                    return;
                }
                
                if (!realName) {
                    showToast('ËØ∑ËæìÂÖ•ÁúüÂÆûÂßìÂêç');
                    return;
                }
                
                fetch(`${API_BASE_URL}/withdraw`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${sessionToken}`
                    },
                    body: JSON.stringify({
                        amount,
                        alipay_account: alipayAccount,
                        real_name: realName
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showToast('ÊèêÁé∞Áî≥ËØ∑Â∑≤Êèê‰∫§ÔºåËØ∑Á≠âÂæÖÂÆ°Ê†∏');
                        document.getElementById('withdrawAmount').value = '';
                        document.getElementById('alipayAccount').value = '';
                        document.getElementById('realName').value = '';
                        loadWithdrawRecords();
                        updateCoins(-amount);
                    } else {
                        showToast(data.message);
                    }
                })
                .catch(error => {
                    console.error('Error submitting withdrawal:', error);
                    showToast('ÊèêÁé∞Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
                });
            });
            
            // Ê∏∏ÊàèÈÅìÂÖ∑ÊåâÈíÆ
            document.querySelectorAll('.game-item').forEach(item => {
                item.addEventListener('click', function() {
                    const itemType = this.getAttribute('data-item');
                    useGameItem(itemType);
                });
            });
            
            // Ê®°ÊÄÅÊ°ÜÊåâÈíÆ
            document.getElementById('cancelModalBtn').addEventListener('click', function() {
                document.getElementById('noPlaysModal').style.display = 'none';
            });
            
            document.getElementById('shareBtn').addEventListener('click', function() {
                document.getElementById('noPlaysModal').style.display = 'none';
                
                if (window.Telegram && window.Telegram.WebApp) {
                    window.Telegram.WebApp.shareURL(`https://t.me/bjxcyouxiBot?start=share_${currentUser.id}`);
                } else {
                    showToast('ËØ∑Âú®TelegramÂÜÖÊâìÂºÄÊ∏∏Êàè');
                }
            });
        }
        
        // ÂàáÊç¢È°µÈù¢
        function switchPage(page) {
            // ÈöêËóèÊâÄÊúâÈ°µÈù¢
            document.getElementById('mainPage').style.display = 'none';
            document.getElementById('tasksPage').style.display = 'none';
            document.getElementById('checkInPage').style.display = 'none';
            document.getElementById('leaderboardPage').style.display = 'none';
            document.getElementById('withdrawPage').style.display = 'none';
            document.getElementById('achievementsPage').style.display = 'none';
            
            // ÊòæÁ§∫ÈÄâ‰∏≠ÁöÑÈ°µÈù¢
            switch(page) {
                case 'main':
                    document.getElementById('mainPage').style.display = 'block';
                    break;
                case 'tasks':
                    document.getElementById('tasksPage').style.display = 'block';
                    loadTasks();
                    break;
                case 'checkin':
                    document.getElementById('checkInPage').style.display = 'block';
                    loadCheckInCalendar();
                    break;
                case 'leaderboard':
                    document.getElementById('leaderboardPage').style.display = 'block';
                    loadLeaderboard();
                    break;
                case 'withdraw':
                    document.getElementById('withdrawPage').style.display = 'block';
                    loadWithdrawRecords();
                    break;
                case 'achievements':
                    document.getElementById('achievementsPage').style.display = 'block';
                    loadAchievements();
                    break;
            }
            
            // Êõ¥Êñ∞ÂØºËà™Ê†èÊøÄÊ¥ªÁä∂ÊÄÅ
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-page') === page) {
                    item.classList.add('active');
                }
            });
        }
        
        // ÊòæÁ§∫ËèúÂçï
        function showMenu() {
            if (window.Telegram && window.Telegram.WebApp) {
                const webApp = window.Telegram.WebApp;
                
                webApp.showPopup({
                    title: 'ËèúÂçï',
                    message: 'ËØ∑ÈÄâÊã©Êìç‰Ωú',
                    buttons: [
                        { id: 'profile', text: '‰∏™‰∫∫ËµÑÊñô' },
                        { id: 'achievements', text: 'ÊàëÁöÑÊàêÂ∞±' },
                        { id: 'help', text: 'Â∏ÆÂä©' },
                        { id: 'cancel', text: 'ÂèñÊ∂à' }
                    ]
                }, function(buttonId) {
                    if (buttonId === 'profile') {
                        showToast('‰∏™‰∫∫ËµÑÊñôÂäüËÉΩÂºÄÂèë‰∏≠');
                    } else if (buttonId === 'achievements') {
                        switchPage('achievements');
                    } else if (buttonId === 'help') {
                        if (window.Telegram && window.Telegram.WebApp) {
                            window.Telegram.WebApp.openTelegramLink(`https://t.me/bjxcyouxiBot?start=help`);
                        } else {
                            window.open(`https://t.me/bjxcyouxiBot?start=help`, '_blank');
                        }
                    }
                });
            } else {
                showToast('ËØ∑Âú®TelegramÂÜÖÊâìÂºÄÊ∏∏Êàè');
            }
        }
        
        // Âä†ËΩΩÁî®Êà∑Êï∞ÊçÆ
        function loadUserData() {
            if (!currentUser || !sessionToken) return;
            
            // Êõ¥Êñ∞Áî®Êà∑‰∏áËä±Â∏Å
            document.getElementById('userCoins').textContent = currentUser.coins;
            document.getElementById('tasksUserCoins').textContent = currentUser.coins;
            document.getElementById('checkInUserCoins').textContent = currentUser.coins;
            document.getElementById('leaderboardUserCoins').textContent = currentUser.coins;
            document.getElementById('withdrawUserCoins').textContent = currentUser.coins;
            document.getElementById('achievementsUserCoins').textContent = currentUser.coins;
            document.getElementById('currentBalance').textContent = `${currentUser.coins} ‰∏áËä±Â∏Å`;
            
            // Ëé∑ÂèñÊúÄÊñ∞Áî®Êà∑Êï∞ÊçÆ
            fetch(`${API_BASE_URL}/user`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${sessionToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    currentUser = data.user;
                    
                    // Êõ¥Êñ∞Áî®Êà∑‰∏áËä±Â∏Å
                    document.getElementById('userCoins').textContent = currentUser.coins;
                    document.getElementById('tasksUserCoins').textContent = currentUser.coins;
                    document.getElementById('checkInUserCoins').textContent = currentUser.coins;
                    document.getElementById('leaderboardUserCoins').textContent = currentUser.coins;
                    document.getElementById('withdrawUserCoins').textContent = currentUser.coins;
                    document.getElementById('achievementsUserCoins').textContent = currentUser.coins;
                    document.getElementById('currentBalance').textContent = `${currentUser.coins} ‰∏áËä±Â∏Å`;
                }
            })
            .catch(error => {
                console.error('Error loading user data:', error);
            });
        }
        
        // Âä†ËΩΩÂÖ≥Âç°
        function loadLevels() {
            if (!sessionToken) return;
            
            fetch(`${API_BASE_URL}/levels`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${sessionToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    levels = data.levels;
                    renderLevelMap();
                } else {
                    showToast('Âä†ËΩΩÂÖ≥Âç°Â§±Ë¥•Ôºö' + data.message);
                }
            })
            .catch(error => {
                console.error('Error loading levels:', error);
                showToast('Âä†ËΩΩÂÖ≥Âç°Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
            });
        }
        
        // Ê∏≤ÊüìÂÖ≥Âç°Âú∞Âõæ
        function renderLevelMap() {
            const levelPath = document.getElementById('levelPath');
            levelPath.innerHTML = '';
            
            // ËÆ°ÁÆóÂÖ≥Âç°‰ΩçÁΩÆ
            const pathWidth = levelPath.offsetWidth;
            const pathHeight = levelPath.offsetHeight;
            
            levels.forEach((level, index) => {
                const levelNode = document.createElement('div');
                levelNode.className = 'level-node';
                levelNode.textContent = level.level_number;
                
                // Ê∑ªÂä†ÂÖ≥Âç°Áä∂ÊÄÅ
                if (level.user_progress.is_completed) {
                    levelNode.classList.add('completed');
                } else if (index === 0 || levels[index - 1].user_progress.is_completed) {
                    levelNode.classList.add('current');
                } else {
                    levelNode.classList.add('locked');
                }
                
                // Ê∑ªÂä†ÊòüÊòü
                if (level.user_progress.stars > 0) {
                    const starsContainer = document.createElement('div');
                    starsContainer.className = 'level-stars';
                    
                    for (let i = 0; i < 3; i++) {
                        const star = document.createElement('i');
                        star.className = i < level.user_progress.stars ? 'fas fa-star' : 'far fa-star';
                        starsContainer.appendChild(star);
                    }
                    
                    levelNode.appendChild(starsContainer);
                }
                
                // ËÆæÁΩÆ‰ΩçÁΩÆ
                const angle = (index / levels.length) * Math.PI * 2;
                const radius = Math.min(pathWidth, pathHeight) * 0.4;
                const x = Math.cos(angle) * radius + pathWidth / 2 - 25;
                const y = Math.sin(angle) * radius + pathHeight / 2 - 25;
                
                levelNode.style.left = `${x}px`;
                levelNode.style.top = `${y}px`;
                
                // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂
                levelNode.addEventListener('click', function() {
                    if (levelNode.classList.contains('locked')) {
                        showToast('ËØ∑ÂÖàÂÆåÊàêÂâç‰∏ÄÂÖ≥');
                    } else {
                        startLevel(level.id);
                    }
                });
                
                levelPath.appendChild(levelNode);
            });
        }
        
        // ÂºÄÂßãÂÖ≥Âç°
        function startLevel(levelId) {
            if (!sessionToken) return;
            
            // Ê£ÄÊü•Ê∏∏ÊàèÊ¨°Êï∞
            fetch(`${API_BASE_URL}/user`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${sessionToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const remainingPlays = data.user.remaining_plays;
                    
                    if (remainingPlays.total <= 0) {
                        // ÊòæÁ§∫Ê∏∏ÊàèÊ¨°Êï∞‰∏çË∂≥ÂºπÁ™ó
                        document.getElementById('noPlaysModal').style.display = 'flex';
                        return;
                    }
                    
                    // ‰ΩøÁî®Ê∏∏ÊàèÊ¨°Êï∞
                    let playType = 'free';
                    if (remainingPlays.free > 0) {
                        playType = 'free';
                    } else if (remainingPlays.ad > 0) {
                        playType = 'ad';
                    } else if (remainingPlays.share > 0) {
                        playType = 'share';
                    }
                    
                    fetch(`${API_BASE_URL}/use-play`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${sessionToken}`
                        },
                        body: JSON.stringify({ type: playType })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Âä†ËΩΩÂÖ≥Âç°Êï∞ÊçÆ
                            loadLevelData(levelId);
                        } else {
                            showToast(data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error using play:', error);
                        showToast('‰ΩøÁî®Ê∏∏ÊàèÊ¨°Êï∞Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
                    });
                } else {
                    showToast('Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•Ôºö' + data.message);
                }
            })
            .catch(error => {
                console.error('Error getting user info:', error);
                showToast('Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
            });
        }
        
        // Âä†ËΩΩÂÖ≥Âç°Êï∞ÊçÆ
        function loadLevelData(levelId) {
            fetch(`${API_BASE_URL}/levels/${levelId}`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${sessionToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    gameLevel = data.level;
                    gameMoves = gameLevel.max_moves;
                    gameScore = 0;
                    gameTarget = gameLevel.target_score;
                    
                    // Êõ¥Êñ∞Ê∏∏ÊàèÁïåÈù¢
                    document.getElementById('gameTarget').textContent = gameTarget;
                    document.getElementById('gameMoves').textContent = gameMoves;
                    document.getElementById('gameScore').textContent = gameScore;
                    
                    // ÂàùÂßãÂåñÊ∏∏ÊàèÊ£ãÁõò
                    initGameBoard();
                    
                    // ÊòæÁ§∫Ê∏∏ÊàèÈ°µÈù¢
                    document.getElementById('mainPage').style.display = 'none';
                    document.getElementById('gamePage').style.display = 'block';
                    
                    // ÂºÄÂßãÊ∏∏Êàè
                    gameActive = true;
                } else {
                    showToast('Âä†ËΩΩÂÖ≥Âç°Â§±Ë¥•Ôºö' + data.message);
                }
            })
            .catch(error => {
                console.error('Error loading level data:', error);
                showToast('Âä†ËΩΩÂÖ≥Âç°Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
            });
        }
        
        // ÂàùÂßãÂåñÊ∏∏ÊàèÊ£ãÁõò
        function initGameBoard() {
            const boardElement = document.getElementById('gameBoard');
            boardElement.innerHTML = '';
            gameBoard = [];
            
            // ÂàõÂª∫8x8ÁöÑÊ£ãÁõò
            for (let row = 0; row < 8; row++) {
                gameBoard[row] = [];
                for (let col = 0; col < 8; col++) {
                    const tile = document.createElement('div');
                    tile.className = 'tile';
                    tile.dataset.row = row;
                    tile.dataset.col = col;
                    
                    // ÈöèÊú∫ÁîüÊàêÊñπÂùóÁ±ªÂûã (1-6)
                    const type = Math.floor(Math.random() * 6) + 1;
                    tile.classList.add(`type-${type}`);
                    
                    // Ê∑ªÂä†ÈöúÁ¢çÁâ©
                    if (gameLevel.obstacles && gameLevel.obstacles.length > 0) {
                        gameLevel.obstacles.forEach(obstacle => {
                            if (obstacle.type === 'ice' && obstacle.positions && 
                                obstacle.positions.some(pos => pos[0] === row && pos[1] === col)) {
                                tile.classList.add('ice');
                            } else if (obstacle.type === 'rope' && obstacle.positions && 
                                obstacle.positions.some(pos => pos[0] === row && pos[1] === col)) {
                                tile.classList.add('rope');
                            } else if (obstacle.type === 'cage' && obstacle.positions && 
                                obstacle.positions.some(pos => pos[0] === row && pos[1] === col)) {
                                tile.classList.add('cage');
                            } else if (obstacle.type === 'cloud' && obstacle.positions && 
                                obstacle.positions.some(pos => pos[0] === row && pos[1] === col)) {
                                tile.classList.add('cloud');
                            }
                        });
                    }
                    
                    // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂
                    tile.addEventListener('click', function() {
                        handleTileClick(row, col);
                    });
                    
                    boardElement.appendChild(tile);
                    gameBoard[row][col] = {
                        type: type,
                        element: tile,
                        obstacle: tile.classList.contains('ice') ? 'ice' :
                                 tile.classList.contains('rope') ? 'rope' :
                                 tile.classList.contains('cage') ? 'cage' :
                                 tile.classList.contains('cloud') ? 'cloud' :
                                 tile.classList.contains('chocolate') ? 'chocolate' : null
                    };
                }
            }
            
            // Ê∑ªÂä†Â∑ßÂÖãÂäõÈöúÁ¢ç
            if (gameLevel.obstacles && gameLevel.obstacles.length > 0) {
                gameLevel.obstacles.forEach(obstacle => {
                    if (obstacle.type === 'chocolate' && obstacle.count) {
                        // ÈöèÊú∫ÊîæÁΩÆÂ∑ßÂÖãÂäõ
                        for (let i = 0; i < obstacle.count; i++) {
                            let row, col;
                            do {
                                row = Math.floor(Math.random() * 8);
                                col = Math.floor(Math.random() * 8);
                            } while (gameBoard[row][col].obstacle);
                            
                            gameBoard[row][col].element.classList.add('chocolate');
                            gameBoard[row][col].obstacle = 'chocolate';
                        }
                    }
                });
            }
            
            // Á°Æ‰øùÂàùÂßãÊ£ãÁõòÊ≤°ÊúâÂåπÈÖç
            while (checkForMatches().length > 0) {
                shuffleBoard();
            }
        }
        
        // Â§ÑÁêÜÊñπÂùóÁÇπÂáª
        function handleTileClick(row, col) {
            if (!gameActive) return;
            
            const tile = gameBoard[row][col];
            
            if (selectedTile === null) {
                // ÈÄâÊã©Á¨¨‰∏Ä‰∏™ÊñπÂùó
                selectedTile = { row, col };
                tile.element.classList.add('selected');
            } else {
                // ÈÄâÊã©Á¨¨‰∫å‰∏™ÊñπÂùó
                const firstTile = gameBoard[selectedTile.row][selectedTile.col];
                
                // Ê£ÄÊü•ÊòØÂê¶Áõ∏ÈÇª
                const isAdjacent = 
                    (Math.abs(selectedTile.row - row) === 1 && selectedTile.col === col) ||
                    (Math.abs(selectedTile.col - col) === 1 && selectedTile.row === row);
                
                if (isAdjacent) {
                    // ‰∫§Êç¢ÊñπÂùó
                    swapTiles(selectedTile.row, selectedTile.col, row, col);
                }
                
                // ÂèñÊ∂àÈÄâÊã©
                firstTile.element.classList.remove('selected');
                selectedTile = null;
            }
        }
        
        // ‰∫§Êç¢ÊñπÂùó
        function swapTiles(row1, col1, row2, col2) {
            // ‰∫§Êç¢Êï∞ÊçÆ
            const temp = gameBoard[row1][col1];
            gameBoard[row1][col1] = gameBoard[row2][col2];
            gameBoard[row2][col2] = temp;
            
            // Êõ¥Êñ∞DOM
            updateTileDisplay(row1, col1);
            updateTileDisplay(row2, col2);
            
            // Ê£ÄÊü•ÊòØÂê¶ÊúâÂåπÈÖç
            const matches = checkForMatches();
            
            if (matches.length > 0) {
                // ÊúâÂåπÈÖçÔºåÂ§ÑÁêÜÊ∂àÈô§
                gameMoves--;
                document.getElementById('gameMoves').textContent = gameMoves;
                
                // Â§ÑÁêÜÂåπÈÖç
                processMatches(matches);
                
                // Ê£ÄÊü•Ê∏∏ÊàèÊòØÂê¶ÁªìÊùü
                checkGameEnd();
            } else {
                // Ê≤°ÊúâÂåπÈÖçÔºå‰∫§Êç¢ÂõûÊù•
                setTimeout(() => {
                    const temp = gameBoard[row1][col1];
                    gameBoard[row1][col1] = gameBoard[row2][col2];
                    gameBoard[row2][col2] = temp;
                    
                    updateTileDisplay(row1, col1);
                    updateTileDisplay(row2, col2);
                }, 300);
            }
        }
        
        // Êõ¥Êñ∞ÊñπÂùóÊòæÁ§∫
        function updateTileDisplay(row, col) {
            const tile = gameBoard[row][col];
            const element = tile.element;
            
            // Ê∏ÖÈô§ÊâÄÊúâÁ±ªÂûãÁ±ª
            element.className = 'tile';
            element.dataset.row = row;
            element.dataset.col = col;
            
            // Ê∑ªÂä†Á±ªÂûãÁ±ª
            if (tile.type) {
                element.classList.add(`type-${tile.type}`);
            }
            
            // Ê∑ªÂä†ÁâπÊÆäÂÖÉÁ¥†Á±ª
            if (tile.special) {
                element.classList.add(tile.special);
            }
            
            // Ê∑ªÂä†ÈöúÁ¢çÁâ©Á±ª
            if (tile.obstacle) {
                element.classList.add(tile.obstacle);
            }
        }
        
        // Ê£ÄÊü•ÂåπÈÖç
        function checkForMatches() {
            const matches = [];
            
            // Ê£ÄÊü•Ê∞¥Âπ≥ÂåπÈÖç
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 6; col++) {
                    const type = gameBoard[row][col].type;
                    
                    if (type && gameBoard[row][col + 1].type === type && gameBoard[row][col + 2].type === type) {
                        const match = [{ row, col }, { row, col: col + 1 }, { row, col: col + 2 }];
                        
                        // Ê£ÄÊü•ÊòØÂê¶ÊúâÊõ¥Â§öÁõ∏ÂêåÁöÑ
                        let k = col + 3;
                        while (k < 8 && gameBoard[row][k].type === type) {
                            match.push({ row, col: k });
                            k++;
                        }
                        
                        matches.push(match);
                        col = k - 1; // Ë∑≥ËøáÂ∑≤ÂåπÈÖçÁöÑ
                    }
                }
            }
            
            // Ê£ÄÊü•ÂûÇÁõ¥ÂåπÈÖç
            for (let col = 0; col < 8; col++) {
                for (let row = 0; row < 6; row++) {
                    const type = gameBoard[row][col].type;
                    
                    if (type && gameBoard[row + 1][col].type === type && gameBoard[row + 2][col].type === type) {
                        const match = [{ row, col }, { row: row + 1, col }, { row: row + 2, col }];
                        
                        // Ê£ÄÊü•ÊòØÂê¶ÊúâÊõ¥Â§öÁõ∏ÂêåÁöÑ
                        let k = row + 3;
                        while (k < 8 && gameBoard[k][col].type === type) {
                            match.push({ row: k, col });
                            k++;
                        }
                        
                        matches.push(match);
                        row = k - 1; // Ë∑≥ËøáÂ∑≤ÂåπÈÖçÁöÑ
                    }
                }
            }
            
            return matches;
        }
        
        // Â§ÑÁêÜÂåπÈÖç
        function processMatches(matches) {
            // Ê†áËÆ∞Ë¶ÅÊ∂àÈô§ÁöÑÊñπÂùó
            const toRemove = new Set();
            
            matches.forEach(match => {
                match.forEach(pos => {
                    toRemove.add(`${pos.row},${pos.col}`);
                });
            });
            
            // Ê£ÄÊü•ÁâπÊÆäÂÖÉÁ¥†ÂΩ¢Êàê
            matches.forEach(match => {
                if (match.length === 4) {
                    // ÂΩ¢ÊàêÁÅ´ÁÆ≠
                    const centerPos = match[1]; // ÂèñÁ¨¨‰∫å‰∏™‰ΩçÁΩÆ‰Ωú‰∏∫‰∏≠ÂøÉ
                    const row = centerPos.row;
                    const col = centerPos.col;
                    
                    // Âà§Êñ≠ÊòØÊ∞¥Âπ≥ËøòÊòØÂûÇÁõ¥
                    const isHorizontal = match.every(pos => pos.row === row);
                    
                    gameBoard[row][col].special = isHorizontal ? 'rocket-h' : 'rocket-v';
                    updateTileDisplay(row, col);
                } else if (match.length === 5) {
                    // ÂΩ¢ÊàêÂΩ©ËôπÁêÉ
                    const centerPos = match[2]; // ÂèñÁ¨¨‰∏â‰∏™‰ΩçÁΩÆ‰Ωú‰∏∫‰∏≠ÂøÉ
                    const row = centerPos.row;
                    const col = centerPos.col;
                    
                    gameBoard[row][col].special = 'rainbow';
                    updateTileDisplay(row, col);
                } else if (match.length >= 3 && (match[0].row !== match[1].row || match[1].row !== match[2].row) && 
                          (match[0].col !== match[1].col || match[1].col !== match[2].col)) {
                    // ÂΩ¢ÊàêÁÇ∏Âºπ (TÂûãÊàñLÂûã)
                    const centerPos = match[1]; // ÂèñÁ¨¨‰∫å‰∏™‰ΩçÁΩÆ‰Ωú‰∏∫‰∏≠ÂøÉ
                    const row = centerPos.row;
                    const col = centerPos.col;
                    
                    gameBoard[row][col].special = 'bomb';
                    updateTileDisplay(row, col);
                }
            });
            
            // ËÆ°ÁÆóÂàÜÊï∞
            let score = 0;
            toRemove.forEach(posStr => {
                const [row, col] = posStr.split(',').map(Number);
                score += 10;
                
                // Â§ÑÁêÜÈöúÁ¢çÁâ©
                if (gameBoard[row][col].obstacle) {
                    score += 5;
                    
                    // ÂáèÂ∞ëÈöúÁ¢çÁâ©ÁîüÂëΩÂÄº
                    if (gameBoard[row][col].obstacle === 'ice' || 
                        gameBoard[row][col].obstacle === 'rope' || 
                        gameBoard[row][col].obstacle === 'cage') {
                        // Ëøô‰∫õÈöúÁ¢çÁâ©ÈúÄË¶Å‰∏§Ê¨°Ê∂àÈô§
                        gameBoard[row][col].obstacle = null;
                        updateTileDisplay(row, col);
                    } else {
                        // ÂÖ∂‰ªñÈöúÁ¢çÁâ©Áõ¥Êé•Ê∂àÈô§
                        gameBoard[row][col].obstacle = null;
                        updateTileDisplay(row, col);
                    }
                }
            });
            
            // Êõ¥Êñ∞ÂàÜÊï∞
            gameScore += score;
            document.getElementById('gameScore').textContent = gameScore;
            
            // Ê∂àÈô§ÊñπÂùó
            toRemove.forEach(posStr => {
                const [row, col] = posStr.split(',').map(Number);
                
                // Â¶ÇÊûú‰∏çÊòØÁâπÊÆäÂÖÉÁ¥†ÔºåÂàôÊ∂àÈô§
                if (!gameBoard[row][col].special) {
                    gameBoard[row][col].type = null;
                    updateTileDisplay(row, col);
                }
            });
            
            // ÊñπÂùó‰∏ãËêΩ
            setTimeout(() => {
                dropTiles();
                
                // Â°´ÂÖÖÊñ∞ÊñπÂùó
                setTimeout(() => {
                    fillBoard();
                    
                    // ÂÜçÊ¨°Ê£ÄÊü•ÂåπÈÖç
                    setTimeout(() => {
                        const newMatches = checkForMatches();
                        if (newMatches.length > 0) {
                            processMatches(newMatches);
                        } else {
                            // Ê£ÄÊü•Ê∏∏ÊàèÊòØÂê¶ÁªìÊùü
                            checkGameEnd();
                        }
                    }, 300);
                }, 300);
            }, 300);
        }
        
        // ÊñπÂùó‰∏ãËêΩ
        function dropTiles() {
            for (let col = 0; col < 8; col++) {
                let emptyRow = 7;
                
                for (let row = 7; row >= 0; row--) {
                    if (gameBoard[row][col].type !== null) {
                        if (row !== emptyRow) {
                            // ÁßªÂä®ÊñπÂùó
                            gameBoard[emptyRow][col] = gameBoard[row][col];
                            gameBoard[row][col] = { type: null, element: gameBoard[row][col].element };
                            updateTileDisplay(emptyRow, col);
                            updateTileDisplay(row, col);
                        }
                        emptyRow--;
                    }
                }
            }
        }
        
        // Â°´ÂÖÖÊñ∞ÊñπÂùó
        function fillBoard() {
            for (let col = 0; col < 8; col++) {
                for (let row = 0; row < 8; row++) {
                    if (gameBoard[row][col].type === null) {
                        // ÈöèÊú∫ÁîüÊàêÊñ∞ÊñπÂùó
                        const type = Math.floor(Math.random() * 6) + 1;
                        gameBoard[row][col].type = type;
                        updateTileDisplay(row, col);
                    }
                }
            }
        }
        
        // Ê¥óÁâå
        function shuffleBoard() {
            const types = [];
            
            // Êî∂ÈõÜÊâÄÊúâÁ±ªÂûã
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    if (gameBoard[row][col].type !== null) {
                        types.push(gameBoard[row][col].type);
                    }
                }
            }
            
            // ÈöèÊú∫Êâì‰π±
            for (let i = types.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [types[i], types[j]] = [types[j], types[i]];
            }
            
            // ÈáçÊñ∞ÂàÜÈÖç
            let index = 0;
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    if (gameBoard[row][col].type !== null) {
                        gameBoard[row][col].type = types[index++];
                        updateTileDisplay(row, col);
                    }
                }
            }
        }
        
        // Ê£ÄÊü•Ê∏∏ÊàèÊòØÂê¶ÁªìÊùü
        function checkGameEnd() {
            if (gameMoves <= 0) {
                // Ê≠•Êï∞Áî®ÂÆåÔºåÊ∏∏ÊàèÁªìÊùü
                gameActive = false;
                
                // ËÆ°ÁÆóÊòüÁ∫ß
                let stars = 0;
                if (gameScore >= gameLevel.target_score) {
                    stars = 1;
                    if (gameScore >= gameLevel.target_score * 1.5) {
                        stars = 2;
                    }
                    if (gameScore >= gameLevel.target_score * 2) {
                        stars = 3;
                    }
                }
                
                // ÊòæÁ§∫ÁªìÊûú
                setTimeout(() => {
                    showGameResult(stars);
                }, 500);
            } else if (gameScore >= gameLevel.target_score) {
                // ËææÂà∞ÁõÆÊ†áÂàÜÊï∞ÔºåÂèØ‰ª•ÊèêÂâçÁªìÊùü
                // ËøôÈáå‰∏çËá™Âä®ÁªìÊùüÔºåËÆ©Áé©ÂÆ∂ÁªßÁª≠Áé©
            }
        }
        
        // ÊòæÁ§∫Ê∏∏ÊàèÁªìÊûú
        function showGameResult(stars) {
            if (window.Telegram && window.Telegram.WebApp) {
                const webApp = window.Telegram.WebApp;
                
                let message = `Ê∏∏ÊàèÁªìÊùüÔºÅ\n\nÂæóÂàÜÔºö${gameScore}\nÁõÆÊ†áÔºö${gameLevel.target_score}\nÊòüÁ∫ßÔºö`;
                
                for (let i = 0; i < 3; i++) {
                    message += i < stars ? '‚≠ê' : '‚òÜ';
                }
                
                webApp.showPopup({
                    title: 'Ê∏∏ÊàèÁªìÊûú',
                    message: message,
                    buttons: [
                        { id: 'ok', text: 'Á°ÆÂÆö' }
                    ]
                }, function(buttonId) {
                    // Êèê‰∫§Ê∏∏ÊàèÁªìÊûú
                    submitGameResult(stars);
                });
            } else {
                let message = `Ê∏∏ÊàèÁªìÊùüÔºÅ\n\nÂæóÂàÜÔºö${gameScore}\nÁõÆÊ†áÔºö${gameLevel.target_score}\nÊòüÁ∫ßÔºö`;
                
                for (let i = 0; i < 3; i++) {
                    message += i < stars ? '‚≠ê' : '‚òÜ';
                }
                
                if (confirm(message + '\n\nÁÇπÂáªÁ°ÆÂÆöËøîÂõû‰∏ªÈ°µÈù¢')) {
                    // Êèê‰∫§Ê∏∏ÊàèÁªìÊûú
                    submitGameResult(stars);
                }
            }
        }
        
        // Êèê‰∫§Ê∏∏ÊàèÁªìÊûú
        function submitGameResult(stars) {
            fetch(`${API_BASE_URL}/levels/${gameLevel.id}/complete`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${sessionToken}`
                },
                body: JSON.stringify({
                    score: gameScore,
                    stars: stars
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    if (data.coin_reward > 0) {
                        showToast(`ÊÅ≠ÂñúËé∑Âæó${data.coin_reward}‰∏áËä±Â∏ÅÂ•ñÂä±ÔºÅ`);
                        updateCoins(data.coin_reward);
                    }
                    
                    // ËøîÂõû‰∏ªÈ°µÈù¢
                    document.getElementById('gamePage').style.display = 'none';
                    document.getElementById('mainPage').style.display = 'block';
                    
                    // ÈáçÊñ∞Âä†ËΩΩÂÖ≥Âç°
                    loadLevels();
                } else {
                    showToast('Êèê‰∫§ÁªìÊûúÂ§±Ë¥•Ôºö' + data.message);
                }
            })
            .catch(error => {
                console.error('Error submitting game result:', error);
                showToast('Êèê‰∫§ÁªìÊûúÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
            });
        }
        
        // ‰ΩøÁî®Ê∏∏ÊàèÈÅìÂÖ∑
        function useGameItem(itemType) {
            if (!gameActive) return;
            
            switch(itemType) {
                case 'refresh':
                    // Âà∑Êñ∞Ê£ãÁõò
                    shuffleBoard();
                    gameMoves--;
                    document.getElementById('gameMoves').textContent = gameMoves;
                    checkGameEnd();
                    break;
                    
                case 'hammer':
                    // Èî§Â≠êÔºöÊ∂àÈô§Âçï‰∏™ÊñπÂùó
                    if (selectedTile) {
                        const row = selectedTile.row;
                        const col = selectedTile.col;
                        
                        // Ê∂àÈô§ÊñπÂùó
                        gameBoard[row][col].type = null;
                        updateTileDisplay(row, col);
                        
                        // Â¢ûÂä†ÂàÜÊï∞
                        gameScore += 20;
                        document.getElementById('gameScore').textContent = gameScore;
                        
                        // ÊñπÂùó‰∏ãËêΩ
                        setTimeout(() => {
                            dropTiles();
                            
                            // Â°´ÂÖÖÊñ∞ÊñπÂùó
                            setTimeout(() => {
                                fillBoard();
                                
                                // ÂÜçÊ¨°Ê£ÄÊü•ÂåπÈÖç
                                setTimeout(() => {
                                    const newMatches = checkForMatches();
                                    if (newMatches.length > 0) {
                                        processMatches(newMatches);
                                    } else {
                                        // Ê£ÄÊü•Ê∏∏ÊàèÊòØÂê¶ÁªìÊùü
                                        checkGameEnd();
                                    }
                                }, 300);
                            }, 300);
                        }, 300);
                        
                        // ÂáèÂ∞ëÊ≠•Êï∞
                        gameMoves--;
                        document.getElementById('gameMoves').textContent = gameMoves;
                        checkGameEnd();
                        
                        // ÂèñÊ∂àÈÄâÊã©
                        selectedTile = null;
                    } else {
                        showToast('ËØ∑ÂÖàÈÄâÊã©‰∏Ä‰∏™ÊñπÂùó');
                    }
                    break;
                    
                case 'bomb':
                    // ÁÇ∏ÂºπÔºöÊ∂àÈô§3x3Âå∫Âüü
                    if (selectedTile) {
                        const row = selectedTile.row;
                        const col = selectedTile.col;
                        
                        // Ê∂àÈô§3x3Âå∫Âüü
                        for (let r = Math.max(0, row - 1); r <= Math.min(7, row + 1); r++) {
                            for (let c = Math.max(0, col - 1); c <= Math.min(7, col + 1); c++) {
                                gameBoard[r][c].type = null;
                                updateTileDisplay(r, c);
                                
                                // Â¢ûÂä†ÂàÜÊï∞
                                gameScore += 20;
                            }
                        }
                        
                        document.getElementById('gameScore').textContent = gameScore;
                        
                        // ÊñπÂùó‰∏ãËêΩ
                        setTimeout(() => {
                            dropTiles();
                            
                            // Â°´ÂÖÖÊñ∞ÊñπÂùó
                            setTimeout(() => {
                                fillBoard();
                                
                                // ÂÜçÊ¨°Ê£ÄÊü•ÂåπÈÖç
                                setTimeout(() => {
                                    const newMatches = checkForMatches();
                                    if (newMatches.length > 0) {
                                        processMatches(newMatches);
                                    } else {
                                        // Ê£ÄÊü•Ê∏∏ÊàèÊòØÂê¶ÁªìÊùü
                                        checkGameEnd();
                                    }
                                }, 300);
                            }, 300);
                        }, 300);
                        
                        // ÂáèÂ∞ëÊ≠•Êï∞
                        gameMoves--;
                        document.getElementById('gameMoves').textContent = gameMoves;
                        checkGameEnd();
                        
                        // ÂèñÊ∂àÈÄâÊã©
                        selectedTile = null;
                    } else {
                        showToast('ËØ∑ÂÖàÈÄâÊã©‰∏Ä‰∏™ÊñπÂùó');
                    }
                    break;
                    
                case 'color':
                    // ÂèòËâ≤ÔºöÂ∞Ü‰∏Ä‰∏™ÊñπÂùóÂèò‰∏∫ÁâπÊÆäÂÖÉÁ¥†
                    if (selectedTile) {
                        const row = selectedTile.row;
                        const col = selectedTile.col;
                        
                        // ÈöèÊú∫Âèò‰∏∫‰∏ÄÁßçÁâπÊÆäÂÖÉÁ¥†
                        const specialTypes = ['rocket-h', 'rocket-v', 'bomb', 'rainbow'];
                        const specialType = specialTypes[Math.floor(Math.random() * specialTypes.length)];
                        
                        gameBoard[row][col].special = specialType;
                        updateTileDisplay(row, col);
                        
                        // ÂáèÂ∞ëÊ≠•Êï∞
                        gameMoves--;
                        document.getElementById('gameMoves').textContent = gameMoves;
                        checkGameEnd();
                        
                        // ÂèñÊ∂àÈÄâÊã©
                        selectedTile = null;
                    } else {
                        showToast('ËØ∑ÂÖàÈÄâÊã©‰∏Ä‰∏™ÊñπÂùó');
                    }
                    break;
            }
        }
        
        // Âä†ËΩΩ‰ªªÂä°
        function loadTasks() {
            if (!sessionToken) return;
            
            fetch(`${API_BASE_URL}/daily-tasks`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${sessionToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    renderTasks(data.tasks);
                } else {
                    showToast('Âä†ËΩΩ‰ªªÂä°Â§±Ë¥•Ôºö' + data.message);
                }
            })
            .catch(error => {
                console.error('Error loading tasks:', error);
                showToast('Âä†ËΩΩ‰ªªÂä°Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
            });
        }
        
        // Ê∏≤Êüì‰ªªÂä°ÂàóË°®
        function renderTasks(tasks) {
            const tasksList = document.getElementById('tasksList');
            tasksList.innerHTML = '';
            
            tasks.forEach(task => {
                const taskCard = document.createElement('div');
                taskCard.className = 'task-card';
                
                const progress = Math.min(100, (task.progress / task.target_value) * 100);
                
                taskCard.innerHTML = `
                    <div class="task-header">
                        <div class="task-title">${task.name}</div>
                        <div class="task-reward">
                            <i class="fas fa-coins"></i>
                            <span>${task.coin_reward}</span>
                        </div>
                    </div>
                    <div class="task-description">${task.description}</div>
                    <div class="task-progress">
                        <div class="task-progress-bar" style="width: ${progress}%"></div>
                    </div>
                    <div class="task-progress-text ${task.is_completed ? 'task-completed' : ''}">
                        ${task.is_completed ? 'Â∑≤ÂÆåÊàê' : `${task.progress}/${task.target_value}`}
                    </div>
                `;
                
                tasksList.appendChild(taskCard);
            });
        }
        
        // Âä†ËΩΩÁ≠æÂà∞Êó•ÂéÜ
        function loadCheckInCalendar() {
            if (!sessionToken) return;
            
            // Ëé∑ÂèñÂΩìÂâçÊó•Êúü
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            const currentDate = today.getDate();
            
            // Ëé∑ÂèñÂΩìÊúàÁ¨¨‰∏ÄÂ§©
            const firstDay = new Date(currentYear, currentMonth, 1);
            const firstDayOfWeek = firstDay.getDay();
            
            // Ëé∑ÂèñÂΩìÊúàÂ§©Êï∞
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            // ÁîüÊàêÊó•ÂéÜ
            const calendar = document.getElementById('checkInCalendar');
            calendar.innerHTML = '';
            
            // Ê∑ªÂä†ÊòüÊúüÊ†áÈ¢ò
            const weekDays = ['Êó•', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠'];
            weekDays.forEach(day => {
                const dayElement = document.createElement('div');
                dayElement.className = 'check-in-day';
                dayElement.innerHTML = `<div class="check-in-day-number">${day}</div>`;
                calendar.appendChild(dayElement);
            });
            
            // Ê∑ªÂä†Á©∫ÁôΩÊó•Êúü
            for (let i = 0; i < firstDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'check-in-day';
                calendar.appendChild(emptyDay);
            }
            
            // Ê∑ªÂä†Êó•Êúü
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'check-in-day';
                
                // ËÆ°ÁÆóÁ≠æÂà∞Â•ñÂä±
                let reward = 10;
                if (day === currentDate) {
                    dayElement.classList.add('today');
                }
                
                if (day < currentDate) {
                    // ËøáÂéªÁöÑÊó•ÊúüÔºåÊ£ÄÊü•ÊòØÂê¶Â∑≤Á≠æÂà∞
                    // ËøôÈáåÁÆÄÂåñÂ§ÑÁêÜÔºåÂÆûÈôÖÂ∫îËØ•‰ªéÂêéÁ´ØËé∑ÂèñÁ≠æÂà∞ËÆ∞ÂΩï
                    const isSignedIn = Math.random() > 0.3; // Ê®°ÊãüÂ∑≤Á≠æÂà∞
                    
                    if (isSignedIn) {
                        dayElement.classList.add('checked');
                    }
                }
                
                dayElement.innerHTML = `
                    <div class="check-in-day-number">${day}</div>
                    <div class="check-in-day-reward">${reward}</div>
                `;
                
                calendar.appendChild(dayElement);
            }
            
            // Ê£ÄÊü•‰ªäÊó•ÊòØÂê¶Â∑≤Á≠æÂà∞
            fetch(`${API_BASE_URL}/user`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${sessionToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Ê£ÄÊü•‰ªäÊó•ÊòØÂê¶Â∑≤Á≠æÂà∞
                    const todayStr = today.toISOString().split('T')[0];
                    const lastCheckIn = data.user.last_check_in;
                    
                    if (lastCheckIn === todayStr) {
                        document.getElementById('checkInBtn').disabled = true;
                        document.getElementById('checkInBtn').textContent = 'Â∑≤Á≠æÂà∞';
                    }
                    
                    // Êõ¥Êñ∞ËøûÁª≠Á≠æÂà∞Â§©Êï∞
                    document.getElementById('consecutiveDays').textContent = `Â∑≤ËøûÁª≠Á≠æÂà∞ ${data.user.consecutive_check_in_days} Â§©`;
                }
            })
            .catch(error => {
                console.error('Error checking check-in status:', error);
            });
        }
        
        // Âä†ËΩΩÊéíË°åÊ¶ú
        function loadLeaderboard() {
            if (!sessionToken) return;
            
            fetch(`${API_BASE_URL}/leaderboard`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${sessionToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    renderLeaderboard(data.leaderboard, data.user_rank);
                } else {
                    showToast('Âä†ËΩΩÊéíË°åÊ¶úÂ§±Ë¥•Ôºö' + data.message);
                }
            })
            .catch(error => {
                console.error('Error loading leaderboard:', error);
                showToast('Âä†ËΩΩÊéíË°åÊ¶úÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
            });
        }
        
        // Ê∏≤ÊüìÊéíË°åÊ¶ú
        function renderLeaderboard(leaderboard, userRank) {
            const leaderboardList = document.getElementById('leaderboardList');
            leaderboardList.innerHTML = '';
            
            leaderboard.forEach((entry, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'leaderboard-item';
                
                const avatar = entry.users.photo_url || `https://ui-avatars.com/api/?name=${entry.users.first_name}&background=ff7e5f&color=fff`;
                
                listItem.innerHTML = `
                    <div class="leaderboard-rank">${entry.rank}</div>
                    <img class="leaderboard-avatar" src="${avatar}" alt="${entry.users.first_name}">
                    <div class="leaderboard-info">
                        <div class="leaderboard-name">${entry.users.first_name || entry.users.username}</div>
                        <div class="leaderboard-coins">
                            <i class="fas fa-coins"></i>
                            <span>${entry.coins_earned}</span>
                        </div>
                    </div>
                `;
                
                leaderboardList.appendChild(listItem);
            });
            
            // Êõ¥Êñ∞Áî®Êà∑ÊéíÂêç
            const userRankElement = document.getElementById('userRank');
            if (userRank) {
                userRankElement.querySelector('.user-rank-info').textContent = `Á¨¨ ${userRank} Âêç`;
            } else {
                userRankElement.querySelector('.user-rank-info').textContent = 'Êú™‰∏äÊ¶ú';
            }
        }
        
        // Âä†ËΩΩÊèêÁé∞ËÆ∞ÂΩï
        function loadWithdrawRecords() {
            if (!sessionToken) return;
            
            fetch(`${API_BASE_URL}/withdrawals`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${sessionToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    renderWithdrawRecords(data.withdrawals);
                } else {
                    showToast('Âä†ËΩΩÊèêÁé∞ËÆ∞ÂΩïÂ§±Ë¥•Ôºö' + data.message);
                }
            })
            .catch(error => {
                console.error('Error loading withdrawal records:', error);
                showToast('Âä†ËΩΩÊèêÁé∞ËÆ∞ÂΩïÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
            });
        }
        
        // Ê∏≤ÊüìÊèêÁé∞ËÆ∞ÂΩï
        function renderWithdrawRecords(withdrawals) {
            const recordsList = document.getElementById('withdrawRecordsList');
            recordsList.innerHTML = '';
            
            if (withdrawals.length === 0) {
                recordsList.innerHTML = '<div style="text-align: center; padding: 20px; color: #757575;">ÊöÇÊó†ÊèêÁé∞ËÆ∞ÂΩï</div>';
                return;
            }
            
            withdrawals.forEach(withdrawal => {
                const record = document.createElement('div');
                record.className = 'withdraw-record';
                
                const date = new Date(withdrawal.created_at);
                const dateStr = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
                
                let statusText = '';
                let statusClass = '';
                
                switch(withdrawal.status) {
                    case 'pending':
                        statusText = 'ÂÆ°Ê†∏‰∏≠';
                        statusClass = 'status-pending';
                        break;
                    case 'approved':
                        statusText = 'Â∑≤ÈÄöËøá';
                        statusClass = 'status-approved';
                        break;
                    case 'completed':
                        statusText = 'Â∑≤ÂÆåÊàê';
                        statusClass = 'status-completed';
                        break;
                    case 'rejected':
                        statusText = 'Â∑≤ÊãíÁªù';
                        statusClass = 'status-rejected';
                        break;
                }
                
                record.innerHTML = `
                    <div class="withdraw-record-info">
                        <div class="withdraw-record-amount">${withdrawal.amount} ‰∏áËä±Â∏Å (${withdrawal.amount / 1000000} ÂÖÉ)</div>
                        <div class="withdraw-record-date">${dateStr}</div>
                    </div>
                    <div class="withdraw-record-status ${statusClass}">${statusText}</div>
                `;
                
                recordsList.appendChild(record);
            });
        }
        
        // Âä†ËΩΩÊàêÂ∞±
        function loadAchievements() {
            if (!sessionToken) return;
            
            fetch(`${API_BASE_URL}/achievements`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${sessionToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    renderAchievements(data.achievements);
                } else {
                    showToast('Âä†ËΩΩÊàêÂ∞±Â§±Ë¥•Ôºö' + data.message);
                }
            })
            .catch(error => {
                console.error('Error loading achievements:', error);
                showToast('Âä†ËΩΩÊàêÂ∞±Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
            });
        }
        
        // Ê∏≤ÊüìÊàêÂ∞±
        function renderAchievements(achievements) {
            const achievementsList = document.getElementById('achievementsList');
            achievementsList.innerHTML = '';
            
            achievements.forEach(achievement => {
                const achievementCard = document.createElement('div');
                achievementCard.className = 'achievement-card';
                
                const iconClass = achievement.is_unlocked ? 'achievement-icon unlocked' : 'achievement-icon';
                const icon = achievement.icon_url || 'fas fa-trophy';
                
                achievementCard.innerHTML = `
                    <div class="achievement-header">
                        <div class="${iconClass}">
                            <i class="${icon}"></i>
                        </div>
                        <div class="achievement-info">
                            <div class="achievement-title">${achievement.name}</div>
                            <div class="achievement-description">${achievement.description}</div>
                        </div>
                    </div>
                    <div class="achievement-reward">
                        <i class="fas fa-coins"></i>
                        <span>${achievement.coin_reward}</span>
                    </div>
                `;
                
                achievementsList.appendChild(achievementCard);
            });
        }
        
        // Êõ¥Êñ∞‰∏áËä±Â∏Å
        function updateCoins(amount) {
            if (currentUser) {
                currentUser.coins += amount;
                
                // Êõ¥Êñ∞ÊòæÁ§∫
                document.getElementById('userCoins').textContent = currentUser.coins;
                document.getElementById('tasksUserCoins').textContent = currentUser.coins;
                document.getElementById('checkInUserCoins').textContent = currentUser.coins;
                document.getElementById('leaderboardUserCoins').textContent = currentUser.coins;
                document.getElementById('withdrawUserCoins').textContent = currentUser.coins;
                document.getElementById('achievementsUserCoins').textContent = currentUser.coins;
                document.getElementById('currentBalance').textContent = `${currentUser.coins} ‰∏áËä±Â∏Å`;
            }
        }
        
        // ÊòæÁ§∫ÊèêÁ§∫
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
