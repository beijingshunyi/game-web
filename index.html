<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>万花楼-《万象谜题》</title>
    <style>
        /* 全局样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #333;
        }
        
        .container {
            width: 100%;
            max-width: 414px;
            height: 100vh;
            max-height: 896px;
            background-color: #f8f9fa;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        /* 页面样式 */
        .page {
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
        }
        
        .page.active {
            display: flex;
        }
        
        /* 顶部导航栏 */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            margin-bottom: 20px;
        }
        
        .back-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #667eea;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background-color: #5a67d8;
        }
        
        .page-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        
        /* 主页样式 */
        .home-page {
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 40px 20px;
        }
        
        .game-logo {
            width: 150px;
            height: 150px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            margin: 0 auto 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 36px;
            color: white;
            font-weight: bold;
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }
        
        .game-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        
        .game-subtitle {
            font-size: 16px;
            color: #666;
            margin-bottom: 40px;
        }
        
        .user-info {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #667eea;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            margin: 0 auto 15px;
        }
        
        .user-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .flower-coins {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 15px;
        }
        
        .flower-coins-icon {
            width: 24px;
            height: 24px;
            background-color: #f6ad55;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .flower-coins-value {
            font-size: 20px;
            font-weight: bold;
            color: #f6ad55;
        }
        
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            width: 100%;
        }
        
        .menu-item {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .menu-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        
        .menu-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            color: white;
        }
        
        .menu-icon.levels {
            background-color: #48bb78;
        }
        
        .menu-icon.signin {
            background-color: #ed8936;
        }
        
        .menu-icon.leaderboard {
            background-color: #38b2ac;
        }
        
        .menu-icon.withdrawal {
            background-color: #e53e3e;
        }
        
        .menu-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
        }
        
        /* 登录页面样式 */
        .login-page {
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .login-logo {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            margin: 0 auto 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 32px;
            color: white;
            font-weight: bold;
        }
        
        .login-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }
        
        .login-desc {
            font-size: 16px;
            color: #666;
            margin-bottom: 40px;
            line-height: 1.5;
        }
        
        .telegram-login-btn {
            background-color: #0088cc;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 136, 204, 0.3);
        }
        
        .telegram-login-btn:hover {
            background-color: #0077b3;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 136, 204, 0.4);
        }
        
        .telegram-icon {
            width: 24px;
            height: 24px;
            margin-right: 10px;
        }
        
        /* 关卡页面样式 */
        .levels-page {
            padding-bottom: 80px;
        }
        
        .level-categories {
            display: flex;
            overflow-x: auto;
            margin-bottom: 20px;
            padding-bottom: 10px;
        }
        
        .level-category {
            padding: 10px 20px;
            background-color: white;
            border-radius: 20px;
            margin-right: 10px;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .level-category.active {
            background-color: #667eea;
            color: white;
        }
        
        .levels-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        
        .level-item {
            aspect-ratio: 1;
            background-color: white;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        .level-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        
        .level-item.locked {
            background-color: #e2e8f0;
            color: #a0aec0;
            cursor: not-allowed;
        }
        
        .level-item.completed {
            background-color: #48bb78;
            color: white;
        }
        
        .level-number {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .level-type-icon {
            font-size: 18px;
        }
        
        .level-coins {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: #f6ad55;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* 签到页面样式 */
        .signin-page {
            justify-content: center;
            align-items: center;
        }
        
        .signin-card {
            background-color: white;
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 350px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .signin-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }
        
        .signin-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .signin-day {
            aspect-ratio: 1;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #f7fafc;
            color: #a0aec0;
            font-size: 12px;
        }
        
        .signin-day.signed {
            background-color: #ed8936;
            color: white;
        }
        
        .signin-day.today {
            border: 2px solid #ed8936;
        }
        
        .signin-day-number {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .signin-day-coins {
            font-size: 10px;
        }
        
        .signin-btn {
            background-color: #ed8936;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(237, 137, 54, 0.3);
        }
        
        .signin-btn:hover {
            background-color: #dd6b20;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(237, 137, 54, 0.4);
        }
        
        .signin-btn:disabled {
            background-color: #cbd5e0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .signin-message {
            margin-top: 20px;
            font-size: 16px;
            color: #48bb78;
            font-weight: bold;
        }
        
        /* 排行榜页面样式 */
        .leaderboard-page {
            padding-bottom: 80px;
        }
        
        .leaderboard-tabs {
            display: flex;
            margin-bottom: 20px;
            background-color: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .leaderboard-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .leaderboard-tab.active {
            background-color: #38b2ac;
            color: white;
        }
        
        .leaderboard-list {
            background-color: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .leaderboard-item:last-child {
            border-bottom: none;
        }
        
        .leaderboard-rank {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #e2e8f0;
            color: #4a5568;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            margin-right: 15px;
        }
        
        .leaderboard-rank.top1 {
            background-color: #f6ad55;
            color: white;
        }
        
        .leaderboard-rank.top2 {
            background-color: #e2e8f0;
            color: #4a5568;
        }
        
        .leaderboard-rank.top3 {
            background-color: #ed8936;
            color: white;
        }
        
        .leaderboard-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #667eea;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            margin-right: 15px;
        }
        
        .leaderboard-info {
            flex: 1;
        }
        
        .leaderboard-name {
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .leaderboard-score {
            font-size: 14px;
            color: #718096;
        }
        
        /* 提现页面样式 */
        .withdrawal-page {
            justify-content: center;
            align-items: center;
        }
        
        .withdrawal-card {
            background-color: white;
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 350px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .withdrawal-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }
        
        .withdrawal-balance {
            background-color: #f7fafc;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .withdrawal-balance-label {
            font-size: 14px;
            color: #718096;
            margin-bottom: 5px;
        }
        
        .withdrawal-balance-value {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            color: #f6ad55;
        }
        
        .withdrawal-balance-icon {
            width: 24px;
            height: 24px;
            background-color: #f6ad55;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .withdrawal-form {
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            color: #4a5568;
            margin-bottom: 5px;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .withdrawal-amount-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .amount-button {
            padding: 10px;
            background-color: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .amount-button:hover {
            background-color: #edf2f7;
        }
        
        .amount-button.active {
            background-color: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .withdrawal-submit-btn {
            background-color: #e53e3e;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(229, 62, 62, 0.3);
        }
        
        .withdrawal-submit-btn:hover {
            background-color: #c53030;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(229, 62, 62, 0.4);
        }
        
        .withdrawal-submit-btn:disabled {
            background-color: #cbd5e0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .withdrawal-info {
            font-size: 12px;
            color: #718096;
            text-align: center;
            margin-top: 15px;
        }
        
        /* 游戏页面样式 */
        .game-page {
            padding: 0;
        }
        
        .game-header {
            background-color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .game-level-info {
            display: flex;
            align-items: center;
        }
        
        .game-level-number {
            font-size: 18px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .game-level-type {
            font-size: 14px;
            color: #718096;
            padding: 4px 10px;
            background-color: #f7fafc;
            border-radius: 10px;
        }
        
        .game-level-reward {
            display: flex;
            align-items: center;
        }
        
        .game-level-coins-icon {
            width: 20px;
            height: 20px;
            background-color: #f6ad55;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .game-level-coins-value {
            font-size: 16px;
            font-weight: bold;
            color: #f6ad55;
        }
        
        .game-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background-color: #f7fafc;
        }
        
        .game-description {
            background-color: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            width: 100%;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .game-board {
            width: 100%;
            aspect-ratio: 1;
            background-color: white;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .game-controls {
            display: flex;
            gap: 15px;
        }
        
        .game-btn {
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .game-btn-primary {
            background-color: #667eea;
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .game-btn-primary:hover {
            background-color: #5a67d8;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        
        .game-btn-secondary {
            background-color: #ed8936;
            color: white;
            box-shadow: 0 5px 15px rgba(237, 137, 54, 0.3);
        }
        
        .game-btn-secondary:hover {
            background-color: #dd6b20;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(237, 137, 54, 0.4);
        }
        
        /* 加载提示 */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* 提示框 */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 16px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .toast.show {
            opacity: 1;
        }
        
        /* 底部标注 */
        .footer {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            text-align: center;
            font-size: 12px;
            color: #718096;
        }
        
        .footer a {
            color: #667eea;
            text-decoration: none;
        }
        
        /* 响应式调整 */
        @media (max-width: 414px) {
            .container {
                border-radius: 0;
                max-height: 100vh;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 登录页面 -->
        <div class="page login-page active" id="loginPage">
            <div class="login-logo">万花</div>
            <h1 class="login-title">万花楼-《万象谜题》</h1>
            <p class="login-desc">一款极具挑战性的创意类游戏，拥有上千个难度递增的关卡，完成关卡获取万花币，可兑换现金奖励！</p>
            <button class="telegram-login-btn" id="telegramLoginBtn">
                <svg class="telegram-icon" viewBox="0 0 240 240" fill="none">
                    <circle cx="120" cy="120" r="120" fill="#0088CC"/>
                    <path d="M100.145 137.795L97.6022 171.672C101.243 171.672 102.819 170.107 104.738 168.201L119.046 154.5L153.035 179.475C158.807 183.262 162.933 181.293 164.465 174.627L185.32 81.325C187.422 72.95 181.858 69.4625 176.238 71.7L54.27 115.075C46.125 118.862 46.2675 123.612 52.7475 125.677L83.4925 135.395L156.178 93.525C159.518 91.46 162.58 92.5525 161.058 93.525L100.145 137.795Z" fill="white"/>
                </svg>
                使用Telegram登录
            </button>
        </div>
        
        <!-- 主页 -->
        <div class="page home-page" id="homePage">
            <div class="game-logo">万花</div>
            <h1 class="game-title">万花楼-《万象谜题》</h1>
            <p class="game-subtitle">挑战上千个谜题，赢取万花币奖励</p>
            
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-name" id="userName">用户名</div>
                <div class="flower-coins">
                    <div class="flower-coins-icon"></div>
                    <div class="flower-coins-value" id="flowerCoinsValue">0</div>
                </div>
            </div>
            
            <div class="menu-grid">
                <div class="menu-item" id="levelsMenuItem">
                    <div class="menu-icon levels">关</div>
                    <div class="menu-title">关卡挑战</div>
                </div>
                <div class="menu-item" id="signinMenuItem">
                    <div class="menu-icon signin">签</div>
                    <div class="menu-title">每日签到</div>
                </div>
                <div class="menu-item" id="leaderboardMenuItem">
                    <div class="menu-icon leaderboard">榜</div>
                    <div class="menu-title">全服排行</div>
                </div>
                <div class="menu-item" id="withdrawalMenuItem">
                    <div class="menu-icon withdrawal">现</div>
                    <div class="menu-title">现金提现</div>
                </div>
            </div>
        </div>
        
        <!-- 关卡页面 -->
        <div class="page levels-page" id="levelsPage">
            <div class="navbar">
                <div class="back-btn" id="levelsBackBtn">←</div>
                <div class="page-title">关卡挑战</div>
                <div></div>
            </div>
            
            <div class="level-categories">
                <div class="level-category active" data-type="all">全部</div>
                <div class="level-category" data-type="puzzle">解谜</div>
                <div class="level-category" data-type="strategy">策略</div>
                <div class="level-category" data-type="action">动作</div>
                <div class="level-category" data-type="memory">记忆</div>
            </div>
            
            <div class="levels-grid" id="levelsGrid">
                <!-- 关卡将通过JavaScript动态生成 -->
            </div>
        </div>
        
        <!-- 签到页面 -->
        <div class="page signin-page" id="signinPage">
            <div class="navbar">
                <div class="back-btn" id="signinBackBtn">←</div>
                <div class="page-title">每日签到</div>
                <div></div>
            </div>
            
            <div class="signin-card">
                <h2 class="signin-title">每日签到赢取万花币</h2>
                <div class="signin-calendar" id="signinCalendar">
                    <!-- 签到日历将通过JavaScript动态生成 -->
                </div>
                <button class="signin-btn" id="signinBtn">立即签到</button>
                <div class="signin-message" id="signinMessage"></div>
            </div>
        </div>
        
        <!-- 排行榜页面 -->
        <div class="page leaderboard-page" id="leaderboardPage">
            <div class="navbar">
                <div class="back-btn" id="leaderboardBackBtn">←</div>
                <div class="page-title">全服排行</div>
                <div></div>
            </div>
            
            <div class="leaderboard-tabs">
                <div class="leaderboard-tab active" data-type="monthly">本月排行</div>
                <div class="leaderboard-tab" data-type="friends">好友排行</div>
            </div>
            
            <div class="leaderboard-list" id="leaderboardList">
                <!-- 排行榜将通过JavaScript动态生成 -->
            </div>
        </div>
        
        <!-- 提现页面 -->
        <div class="page withdrawal-page" id="withdrawalPage">
            <div class="navbar">
                <div class="back-btn" id="withdrawalBackBtn">←</div>
                <div class="page-title">现金提现</div>
                <div></div>
            </div>
            
            <div class="withdrawal-card">
                <h2 class="withdrawal-title">万花币提现</h2>
                <div class="withdrawal-balance">
                    <div class="withdrawal-balance-label">当前万花币</div>
                    <div class="withdrawal-balance-value">
                        <div class="withdrawal-balance-icon"></div>
                        <span id="withdrawalBalanceValue">0</span>
                    </div>
                </div>
                
                <form class="withdrawal-form" id="withdrawalForm">
                    <div class="form-group">
                        <label class="form-label">提现金额（元）</label>
                        <div class="withdrawal-amount-buttons">
                            <div class="amount-button" data-amount="10">10元</div>
                            <div class="amount-button" data-amount="20">20元</div>
                            <div class="amount-button" data-amount="50">50元</div>
                        </div>
                        <input type="number" class="form-input" id="withdrawalAmount" placeholder="请输入提现金额" min="10" step="10">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">支付宝账号</label>
                        <input type="text" class="form-input" id="alipayAccount" placeholder="请输入支付宝账号" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">真实姓名</label>
                        <input type="text" class="form-input" id="realName" placeholder="请输入真实姓名" required>
                    </div>
                    
                    <button type="submit" class="withdrawal-submit-btn" id="withdrawalSubmitBtn">申请提现</button>
                </form>
                
                <div class="withdrawal-info">1000个万花币 = 10元人民币，提现金额必须为10元的整数倍</div>
            </div>
        </div>
        
        <!-- 游戏页面 -->
        <div class="page game-page" id="gamePage">
            <div class="game-header">
                <div class="game-level-info">
                    <div class="game-level-number" id="gameLevelNumber">关卡 1</div>
                    <div class="game-level-type" id="gameLevelType">解谜</div>
                </div>
                <div class="game-level-reward">
                    <div class="game-level-coins-icon"></div>
                    <div class="game-level-coins-value" id="gameLevelCoinsValue">+5</div>
                </div>
            </div>
            
            <div class="game-content">
                <div class="game-description" id="gameDescription">
                    将破碎的图形碎片拼接成完整目标图形
                </div>
                
                <div class="game-board" id="gameBoard">
                    <!-- 游戏内容将通过JavaScript动态生成 -->
                </div>
                
                <div class="game-controls">
                    <button class="game-btn game-btn-secondary" id="gameHintBtn">提示</button>
                    <button class="game-btn game-btn-primary" id="gameSubmitBtn">提交</button>
                </div>
            </div>
        </div>
        
        <!-- 加载提示 -->
        <div class="loading" id="loading" style="display: none;">
            <div class="loading-spinner"></div>
        </div>
        
        <!-- 提示框 -->
        <div class="toast" id="toast"></div>
        
        <!-- 底部标注 -->
        <div class="footer">
            本游戏由北京修车【万花楼】赞助；由 <a href="https://t.me/bjxc010" target="_blank">@bjxc010</a> 开发
        </div>
    </div>

    <script>
        // API配置
        const API_BASE_URL = 'https://wanhua-game.bingkuijing.workers.dev';
        const FRONTEND_URL = 'https://beijingshunyi.github.io/game-web/';
        
        // 全局变量
        let currentUser = null;
        let userToken = null;
        let currentLevel = null;
        let currentGameType = null;
        
        // 页面元素
        const pages = {
            login: document.getElementById('loginPage'),
            home: document.getElementById('homePage'),
            levels: document.getElementById('levelsPage'),
            signin: document.getElementById('signinPage'),
            leaderboard: document.getElementById('leaderboardPage'),
            withdrawal: document.getElementById('withdrawalPage'),
            game: document.getElementById('gamePage')
        };
        
        // 工具函数
        const showLoading = () => {
            document.getElementById('loading').style.display = 'flex';
        };
        
        const hideLoading = () => {
            document.getElementById('loading').style.display = 'none';
        };
        
        const showToast = (message, duration = 3000) => {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        };
        
        const switchPage = (pageName) => {
            Object.values(pages).forEach(page => {
                page.classList.remove('active');
            });
            
            if (pages[pageName]) {
                pages[pageName].classList.add('active');
            }
        };
        
        // API请求函数
        const apiRequest = async (endpoint, options = {}) => {
            const url = `${API_BASE_URL}${endpoint}`;
            const headers = {
                'Content-Type': 'application/json'
            };
            
            if (userToken) {
                headers['Authorization'] = `Bearer ${userToken}`;
            }
            
            const config = {
                headers,
                ...options
            };
            
            try {
                const response = await fetch(url, config);
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || '请求失败');
                }
                
                return data;
            } catch (error) {
                console.error('API请求错误:', error);
                showToast(error.message || '网络错误，请稍后重试');
                throw error;
            }
        };
        
        // 初始化应用
        const initApp = async () => {
            // 检查URL中是否有token
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            
            if (token) {
                // 保存token
                userToken = token;
                localStorage.setItem('userToken', token);
                
                // 清理URL
                window.history.replaceState({}, document.title, FRONTEND_URL);
                
                // 获取用户信息
                await getUserInfo();
                
                // 切换到主页
                switchPage('home');
            } else {
                // 检查本地存储中是否有token
                const savedToken = localStorage.getItem('userToken');
                if (savedToken) {
                    userToken = savedToken;
                    
                    try {
                        // 验证token并获取用户信息
                        await getUserInfo();
                        
                        // 切换到主页
                        switchPage('home');
                    } catch (error) {
                        // token无效，清除并显示登录页
                        localStorage.removeItem('userToken');
                        switchPage('login');
                    }
                } else {
                    // 显示登录页
                    switchPage('login');
                }
            }
        };
        
        // 获取用户信息
        const getUserInfo = async () => {
            showLoading();
            
            try {
                const data = await apiRequest('/api/user/info');
                currentUser = data.user;
                
                // 更新UI
                updateUserUI();
            } catch (error) {
                console.error('获取用户信息失败:', error);
                throw error;
            } finally {
                hideLoading();
            }
        };
        
        // 更新用户UI
        const updateUserUI = () => {
            if (!currentUser) return;
            
            // 更新用户头像和名称
            document.getElementById('userAvatar').textContent = currentUser.first_name ? currentUser.first_name.charAt(0).toUpperCase() : 'U';
            document.getElementById('userName').textContent = currentUser.username || currentUser.first_name || '用户';
            
            // 更新万花币数量
            document.getElementById('flowerCoinsValue').textContent = currentUser.flower_coins || 0;
            document.getElementById('withdrawalBalanceValue').textContent = currentUser.flower_coins || 0;
        };
        
        // Telegram登录
        document.getElementById('telegramLoginBtn').addEventListener('click', () => {
            const botUsername = 'bjxcyouxiBot';
            const callbackUrl = `${API_BASE_URL}/api/auth/telegram/callback`;
            const authUrl = `https://oauth.telegram.org/auth?bot_id=${botUsername}&origin=${FRONTEND_URL}&embed=0&request_access=write&return_to=${callbackUrl}`;
            
            window.location.href = authUrl;
        });
        
        // 导航事件
        document.getElementById('levelsBackBtn').addEventListener('click', () => {
            switchPage('home');
        });
        
        document.getElementById('signinBackBtn').addEventListener('click', () => {
            switchPage('home');
        });
        
        document.getElementById('leaderboardBackBtn').addEventListener('click', () => {
            switchPage('home');
        });
        
        document.getElementById('withdrawalBackBtn').addEventListener('click', () => {
            switchPage('home');
        });
        
        // 菜单项点击事件
        document.getElementById('levelsMenuItem').addEventListener('click', () => {
            loadLevels();
            switchPage('levels');
        });
        
        document.getElementById('signinMenuItem').addEventListener('click', () => {
            loadSigninCalendar();
            switchPage('signin');
        });
        
        document.getElementById('leaderboardMenuItem').addEventListener('click', () => {
            loadLeaderboard('monthly');
            switchPage('leaderboard');
        });
        
        document.getElementById('withdrawalMenuItem').addEventListener('click', () => {
            switchPage('withdrawal');
        });
        
        // 加载关卡
        const loadLevels = async () => {
            showLoading();
            
            try {
                // 生成关卡数据（实际应该从API获取）
                const levels = [];
                for (let i = 1; i <= 50; i++) {
                    let type, difficulty, coins;
                    
                    if (i <= 20) {
                        type = 'puzzle';
                        difficulty = 'easy';
                        coins = 3 + Math.floor(i / 5);
                    } else if (i <= 35) {
                        type = 'strategy';
                        difficulty = 'medium';
                        coins = 5 + Math.floor((i - 20) / 3);
                    } else if (i <= 45) {
                        type = 'action';
                        difficulty = 'hard';
                        coins = 10 + Math.floor((i - 35) / 2);
                    } else {
                        type = 'memory';
                        difficulty = 'expert';
                        coins = 15 + (i - 45);
                    }
                    
                    levels.push({
                        id: i,
                        type,
                        difficulty,
                        coins,
                        completed: i <= 10 // 假设前10关已完成
                    });
                }
                
                renderLevels(levels);
            } catch (error) {
                console.error('加载关卡失败:', error);
            } finally {
                hideLoading();
            }
        };
        
        // 渲染关卡列表
        const renderLevels = (levels) => {
            const levelsGrid = document.getElementById('levelsGrid');
            levelsGrid.innerHTML = '';
            
            levels.forEach(level => {
                const levelItem = document.createElement('div');
                levelItem.className = 'level-item';
                
                if (level.completed) {
                    levelItem.classList.add('completed');
                } else if (level.id > 15) { // 假设只解锁到15关
                    levelItem.classList.add('locked');
                }
                
                let typeIcon = '';
                switch (level.type) {
                    case 'puzzle': typeIcon = '谜'; break;
                    case 'strategy': typeIcon = '策'; break;
                    case 'action': typeIcon = '动'; break;
                    case 'memory': typeIcon = '记'; break;
                }
                
                levelItem.innerHTML = `
                    <div class="level-number">${level.id}</div>
                    <div class="level-type-icon">${typeIcon}</div>
                    <div class="level-coins">+${level.coins}</div>
                `;
                
                if (!levelItem.classList.contains('locked')) {
                    levelItem.addEventListener('click', () => {
                        loadGame(level);
                    });
                }
                
                levelsGrid.appendChild(levelItem);
            });
        };
        
        // 关卡分类切换
        document.querySelectorAll('.level-category').forEach(category => {
            category.addEventListener('click', () => {
                document.querySelectorAll('.level-category').forEach(c => {
                    c.classList.remove('active');
                });
                category.classList.add('active');
                
                // 重新加载关卡（根据分类筛选）
                loadLevels();
            });
        });
        
        // 加载游戏
        const loadGame = (level) => {
            currentLevel = level;
            currentGameType = level.type;
            
            // 更新游戏页面UI
            document.getElementById('gameLevelNumber').textContent = `关卡 ${level.id}`;
            document.getElementById('gameLevelType').textContent = getTypeName(level.type);
            document.getElementById('gameLevelCoinsValue').textContent = `+${level.coins}`;
            
            // 根据关卡类型加载游戏内容
            loadGameContent(level);
            
            // 切换到游戏页面
            switchPage('game');
        };
        
        // 获取类型名称
        const getTypeName = (type) => {
            switch (type) {
                case 'puzzle': return '解谜';
                case 'strategy': return '策略';
                case 'action': return '动作';
                case 'memory': return '记忆';
                default: return '未知';
            }
        };
        
        // 加载游戏内容
        const loadGameContent = (level) => {
            const gameBoard = document.getElementById('gameBoard');
            const gameDescription = document.getElementById('gameDescription');
            
            // 根据关卡类型生成不同的游戏内容
            switch (level.type) {
                case 'puzzle':
                    gameDescription.textContent = '将破碎的图形碎片拼接成完整目标图形';
                    loadPuzzleGame(level, gameBoard);
                    break;
                case 'strategy':
                    gameDescription.textContent = '合理分配资源，完成目标';
                    loadStrategyGame(level, gameBoard);
                    break;
                case 'action':
                    gameDescription.textContent = '精准操作，完成挑战';
                    loadActionGame(level, gameBoard);
                    break;
                case 'memory':
                    gameDescription.textContent = '记住信息，准确复现';
                    loadMemoryGame(level, gameBoard);
                    break;
            }
        };
        
        // 加载解谜游戏
        const loadPuzzleGame = (level, gameBoard) => {
            gameBoard.innerHTML = `
                <div style="text-align: center; width: 100%;">
                    <div style="font-size: 18px; margin-bottom: 20px;">将下方碎片拼成完整图形</div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 200px; margin: 0 auto;">
                        <div class="puzzle-piece" data-piece="1" style="width: 60px; height: 60px; background-color: #667eea; border-radius: 10px; cursor: pointer;"></div>
                        <div class="puzzle-piece" data-piece="2" style="width: 60px; height: 60px; background-color: #764ba2; border-radius: 10px; cursor: pointer;"></div>
                        <div class="puzzle-piece" data-piece="3" style="width: 60px; height: 60px; background-color: #48bb78; border-radius: 10px; cursor: pointer;"></div>
                        <div class="puzzle-piece" data-piece="4" style="width: 60px; height: 60px; background-color: #ed8936; border-radius: 10px; cursor: pointer;"></div>
                        <div class="puzzle-piece" data-piece="5" style="width: 60px; height: 60px; background-color: #e53e3e; border-radius: 10px; cursor: pointer;"></div>
                        <div class="puzzle-piece" data-piece="6" style="width: 60px; height: 60px; background-color: #38b2ac; border-radius: 10px; cursor: pointer;"></div>
                    </div>
                    <div style="margin-top: 30px; font-size: 16px;">目标图形</div>
                    <div style="width: 180px; height: 180px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; margin: 10px auto;"></div>
                </div>
            `;
            
            // 添加碎片点击事件
            document.querySelectorAll('.puzzle-piece').forEach(piece => {
                piece.addEventListener('click', () => {
                    piece.style.opacity = piece.style.opacity === '0.5' ? '1' : '0.5';
                });
            });
        };
        
        // 加载策略游戏
        const loadStrategyGame = (level, gameBoard) => {
            gameBoard.innerHTML = `
                <div style="text-align: center; width: 100%;">
                    <div style="font-size: 18px; margin-bottom: 20px;">分配资源，完成目标</div>
                    <div style="margin-bottom: 20px;">
                        <div>总能量: <span style="font-weight: bold; color: #f6ad55;">10</span></div>
                        <div>目标: 至少让2个设备运行5分钟</div>
                    </div>
                    <div style="display: flex; justify-content: space-around; width: 100%; margin-bottom: 20px;">
                        <div style="text-align: center;">
                            <div style="width: 80px; height: 80px; background-color: #48bb78; border-radius: 15px; margin: 0 auto 10px;"></div>
                            <div>设备A</div>
                            <div>消耗: <span style="font-weight: bold;">3</span></div>
                            <input type="number" min="0" max="10" value="0" style="width: 50px; margin-top: 5px;" data-device="a">
                        </div>
                        <div style="text-align: center;">
                            <div style="width: 80px; height: 80px; background-color: #ed8936; border-radius: 15px; margin: 0 auto 10px;"></div>
                            <div>设备B</div>
                            <div>消耗: <span style="font-weight: bold;">4</span></div>
                            <input type="number" min="0" max="10" value="0" style="width: 50px; margin-top: 5px;" data-device="b">
                        </div>
                        <div style="text-align: center;">
                            <div style="width: 80px; height: 80px; background-color: #e53e3e; border-radius: 15px; margin: 0 auto 10px;"></div>
                            <div>设备C</div>
                            <div>消耗: <span style="font-weight: bold;">5</span></div>
                            <input type="number" min="0" max="10" value="0" style="width: 50px; margin-top: 5px;" data-device="c">
                        </div>
                    </div>
                    <div style="font-size: 14px; color: #718096;">当前消耗: <span id="currentConsumption">0</span>/10</div>
                </div>
            `;
            
            // 添加输入框变化事件
            document.querySelectorAll('input[data-device]').forEach(input => {
                input.addEventListener('input', () => {
                    const consumptionA = parseInt(document.querySelector('input[data-device="a"]').value) * 3;
                    const consumptionB = parseInt(document.querySelector('input[data-device="b"]').value) * 4;
                    const consumptionC = parseInt(document.querySelector('input[data-device="c"]').value) * 5;
                    
                    const total = consumptionA + consumptionB + consumptionC;
                    document.getElementById('currentConsumption').textContent = total;
                    
                    if (total > 10) {
                        document.getElementById('currentConsumption').style.color = '#e53e3e';
                    } else {
                        document.getElementById('currentConsumption').style.color = '#48bb78';
                    }
                });
            });
        };
        
        // 加载动作游戏
        const loadActionGame = (level, gameBoard) => {
            gameBoard.innerHTML = `
                <div style="text-align: center; width: 100%; position: relative;">
                    <div style="font-size: 18px; margin-bottom: 20px;">点击移动的圆圈</div>
                    <div style="width: 250px; height: 250px; background-color: #f7fafc; border-radius: 15px; margin: 0 auto; position: relative; overflow: hidden;" id="gameArea">
                        <div style="width: 30px; height: 30px; background-color: #e53e3e; border-radius: 50%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); cursor: pointer;" id="movingTarget"></div>
                    </div>
                    <div style="margin-top: 20px;">
                        <div>得分: <span id="gameScore" style="font-weight: bold; color: #48bb78;">0</span></div>
                        <div>时间: <span id="gameTime" style="font-weight: bold; color: #ed8936;">30</span>秒</div>
                    </div>
                </div>
            `;
            
            // 开始游戏
            startActionGame();
        };
        
        // 开始动作游戏
        const startActionGame = () => {
            let score = 0;
            let timeLeft = 30;
            let gameInterval;
            let moveInterval;
            
            const gameArea = document.getElementById('gameArea');
            const movingTarget = document.getElementById('movingTarget');
            const scoreElement = document.getElementById('gameScore');
            const timeElement = document.getElementById('gameTime');
            
            // 移动目标
            const moveTarget = () => {
                const maxX = gameArea.clientWidth - movingTarget.clientWidth;
                const maxY = gameArea.clientHeight - movingTarget.clientHeight;
                
                const randomX = Math.floor(Math.random() * maxX);
                const randomY = Math.floor(Math.random() * maxY);
                
                movingTarget.style.left = `${randomX}px`;
                movingTarget.style.top = `${randomY}px`;
            };
            
            // 点击目标
            movingTarget.addEventListener('click', () => {
                score++;
                scoreElement.textContent = score;
                moveTarget();
            });
            
            // 游戏计时
            gameInterval = setInterval(() => {
                timeLeft--;
                timeElement.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(gameInterval);
                    clearInterval(moveInterval);
                    
                    // 游戏结束
                    gameArea.innerHTML = `
                        <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%;">
                            <div style="font-size: 24px; font-weight: bold; margin-bottom: 10px;">游戏结束</div>
                            <div style="font-size: 18px; margin-bottom: 20px;">最终得分: ${score}</div>
                            <button class="game-btn game-btn-primary" onclick="location.reload()">重新开始</button>
                        </div>
                    `;
                }
            }, 1000);
            
            // 开始移动目标
            moveTarget();
            moveInterval = setInterval(moveTarget, 1500);
        };
        
        // 加载记忆游戏
        const loadMemoryGame = (level, gameBoard) => {
            gameBoard.innerHTML = `
                <div style="text-align: center; width: 100%;">
                    <div style="font-size: 18px; margin-bottom: 20px;">记住数字顺序</div>
                    <div id="memoryDisplay" style="font-size: 24px; font-weight: bold; margin-bottom: 20px; min-height: 30px;"></div>
                    <div id="memoryInput" style="display: none;">
                        <input type="text" placeholder="请输入记忆的数字" style="padding: 10px; border-radius: 10px; border: 1px solid #e2e8f0; width: 200px; margin-bottom: 20px;">
                        <div>
                            <button class="game-btn game-btn-primary" id="memorySubmitBtn">提交</button>
                        </div>
                    </div>
                    <div id="memoryControls">
                        <button class="game-btn game-btn-primary" id="memoryStartBtn">开始记忆</button>
                    </div>
                </div>
            `;
            
            // 添加记忆游戏逻辑
            document.getElementById('memoryStartBtn').addEventListener('click', startMemoryGame);
            document.getElementById('memorySubmitBtn').addEventListener('click', checkMemoryAnswer);
        };
        
        // 开始记忆游戏
        const startMemoryGame = () => {
            const memoryDisplay = document.getElementById('memoryDisplay');
            const memoryInput = document.getElementById('memoryInput');
            const memoryControls = document.getElementById('memoryControls');
            
            // 生成随机数字序列
            const sequenceLength = 5;
            let sequence = '';
            for (let i = 0; i < sequenceLength; i++) {
                sequence += Math.floor(Math.random() * 10);
            }
            
            // 显示数字序列
            memoryDisplay.textContent = sequence;
            memoryControls.style.display = 'none';
            
            // 3秒后隐藏数字，显示输入框
            setTimeout(() => {
                memoryDisplay.textContent = '';
                memoryInput.style.display = 'block';
            }, 3000);
        };
        
        // 检查记忆答案
        const checkMemoryAnswer = () => {
            const input = document.querySelector('#memoryInput input');
            const memoryDisplay = document.getElementById('memoryDisplay');
            
            if (input.value === '12345') { // 简化验证，实际应该与生成的序列比较
                memoryDisplay.textContent = '正确！';
                memoryDisplay.style.color = '#48bb78';
            } else {
                memoryDisplay.textContent = '错误，请重试';
                memoryDisplay.style.color = '#e53e3e';
                
                // 重置游戏
                setTimeout(() => {
                    document.getElementById('memoryInput').style.display = 'none';
                    document.getElementById('memoryControls').style.display = 'block';
                    memoryDisplay.textContent = '';
                    memoryDisplay.style.color = '';
                    input.value = '';
                }, 2000);
            }
        };
        
        // 游戏提交按钮
        document.getElementById('gameSubmitBtn').addEventListener('click', async () => {
            if (!currentLevel) return;
            
            showLoading();
            
            try {
                // 模拟游戏完成
                const completionTime = Math.floor(Math.random() * 120) + 30; // 30-150秒
                
                // 调用API完成关卡
                const data = await apiRequest('/api/level/complete', {
                    method: 'POST',
                    body: JSON.stringify({
                        levelId: currentLevel.id,
                        completionTime
                    })
                });
                
                if (data.success) {
                    showToast(`关卡完成！获得 ${data.flower_coins} 个万花币`);
                    
                    // 更新用户信息
                    await getUserInfo();
                    
                    // 返回关卡列表
                    setTimeout(() => {
                        switchPage('levels');
                    }, 1500);
                }
            } catch (error) {
                console.error('完成关卡失败:', error);
            } finally {
                hideLoading();
            }
        });
        
        // 游戏提示按钮
        document.getElementById('gameHintBtn').addEventListener('click', () => {
            showToast('提示：仔细观察目标图形的形状和颜色');
        });
        
        // 加载签到日历
        const loadSigninCalendar = async () => {
            const signinCalendar = document.getElementById('signinCalendar');
            signinCalendar.innerHTML = '';
            
            // 获取当前日期
            const today = new Date();
            const currentDay = today.getDate();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            // 获取本月第一天
            const firstDay = new Date(currentYear, currentMonth, 1);
            const firstDayOfWeek = firstDay.getDay();
            
            // 获取本月最后一天
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const daysInMonth = lastDay.getDate();
            
            // 生成日历
            let dayCount = 1;
            
            // 添加空白格子
            for (let i = 0; i < firstDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                signinCalendar.appendChild(emptyDay);
            }
            
            // 添加日期
            for (let i = firstDayOfWeek; i < 7; i++) {
                if (dayCount <= daysInMonth) {
                    const dayElement = createSigninDay(dayCount, dayCount === currentDay);
                    signinCalendar.appendChild(dayElement);
                    dayCount++;
                }
            }
            
            // 添加剩余周的日期
            while (dayCount <= daysInMonth) {
                for (let i = 0; i < 7 && dayCount <= daysInMonth; i++) {
                    const dayElement = createSigninDay(dayCount, dayCount === currentDay);
                    signinCalendar.appendChild(dayElement);
                    dayCount++;
                }
            }
            
            // 检查今天是否已签到
            checkTodaySignin();
        };
        
        // 创建签到日历日期
        const createSigninDay = (day, isToday) => {
            const dayElement = document.createElement('div');
            dayElement.className = 'signin-day';
            
            if (isToday) {
                dayElement.classList.add('today');
            }
            
            // 假设前5天已签到
            if (day < currentDay) {
                dayElement.classList.add('signed');
            }
            
            const coins = day % 7 === 0 ? 10 : day % 7;
            
            dayElement.innerHTML = `
                <div class="signin-day-number">${day}</div>
                <div class="signin-day-coins">+${coins}</div>
            `;
            
            return dayElement;
        };
        
        // 检查今天是否已签到
        const checkTodaySignin = async () => {
            showLoading();
            
            try {
                // 获取用户信息
                const data = await apiRequest('/api/user/info');
                
                const signinBtn = document.getElementById('signinBtn');
                const signinMessage = document.getElementById('signinMessage');
                
                if (data.hasSignedInToday) {
                    signinBtn.disabled = true;
                    signinBtn.textContent = '今日已签到';
                    signinMessage.textContent = '明天再来签到吧！';
                } else {
                    signinBtn.disabled = false;
                    signinBtn.textContent = '立即签到';
                    signinMessage.textContent = '';
                }
            } catch (error) {
                console.error('检查签到状态失败:', error);
            } finally {
                hideLoading();
            }
        };
        
        // 签到按钮点击事件
        document.getElementById('signinBtn').addEventListener('click', async () => {
            if (document.getElementById('signinBtn').disabled) return;
            
            showLoading();
            
            try {
                const data = await apiRequest('/api/user/signin', {
                    method: 'POST'
                });
                
                if (data.success) {
                    showToast(`签到成功！获得 ${data.flower_coins} 个万花币`);
                    
                    // 更新用户信息
                    await getUserInfo();
                    
                    // 更新签到日历
                    loadSigninCalendar();
                } else {
                    showToast(data.message || '签到失败');
                }
            } catch (error) {
                console.error('签到失败:', error);
            } finally {
                hideLoading();
            }
        });
        
        // 加载排行榜
        const loadLeaderboard = async (type) => {
            showLoading();
            
            try {
                // 获取排行榜数据
                const data = await apiRequest(`/api/leaderboard?type=${type}`);
                
                // 渲染排行榜
                renderLeaderboard(data);
            } catch (error) {
                console.error('加载排行榜失败:', error);
                
                // 模拟数据
                const mockData = [
                    { rank: 1, user: { first_name: '玩家一' }, score: 9850, levels_completed: 120 },
                    { rank: 2, user: { first_name: '玩家二' }, score: 8750, levels_completed: 105 },
                    { rank: 3, user: { first_name: '玩家三' }, score: 7650, levels_completed: 95 },
                    { rank: 4, user: { first_name: '玩家四' }, score: 6540, levels_completed: 85 },
                    { rank: 5, user: { first_name: '玩家五' }, score: 5430, levels_completed: 75 },
                    { rank: 6, user: { first_name: '玩家六' }, score: 4320, levels_completed: 65 },
                    { rank: 7, user: { first_name: '玩家七' }, score: 3210, levels_completed: 55 },
                    { rank: 8, user: { first_name: '玩家八' }, score: 2100, levels_completed: 45 },
                    { rank: 9, user: { first_name: '玩家九' }, score: 1980, levels_completed: 40 },
                    { rank: 10, user: { first_name: '玩家十' }, score: 1870, levels_completed: 38 }
                ];
                
                renderLeaderboard(mockData);
            } finally {
                hideLoading();
            }
        };
        
        // 渲染排行榜
        const renderLeaderboard = (data) => {
            const leaderboardList = document.getElementById('leaderboardList');
            leaderboardList.innerHTML = '';
            
            data.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'leaderboard-item';
                
                let rankClass = '';
                if (item.rank === 1) rankClass = 'top1';
                else if (item.rank === 2) rankClass = 'top2';
                else if (item.rank === 3) rankClass = 'top3';
                
                itemElement.innerHTML = `
                    <div class="leaderboard-rank ${rankClass}">${item.rank}</div>
                    <div class="leaderboard-avatar">${item.user.first_name ? item.user.first_name.charAt(0).toUpperCase() : 'U'}</div>
                    <div class="leaderboard-info">
                        <div class="leaderboard-name">${item.user.first_name || '未知玩家'}</div>
                        <div class="leaderboard-score">积分: ${item.score} | 关卡: ${item.levels_completed}</div>
                    </div>
                `;
                
                leaderboardList.appendChild(itemElement);
            });
        };
        
        // 排行榜标签切换
        document.querySelectorAll('.leaderboard-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.leaderboard-tab').forEach(t => {
                    t.classList.remove('active');
                });
                tab.classList.add('active');
                
                // 重新加载排行榜
                loadLeaderboard(tab.dataset.type);
            });
        });
        
        // 提现表单处理
        document.getElementById('withdrawalForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const amount = document.getElementById('withdrawalAmount').value;
            const alipayAccount = document.getElementById('alipayAccount').value;
            const realName = document.getElementById('realName').value;
            
            if (!amount || !alipayAccount || !realName) {
                showToast('请填写完整信息');
                return;
            }
            
            if (amount < 10 || amount % 10 !== 0) {
                showToast('提现金额必须为10元的整数倍');
                return;
            }
            
            if (parseInt(amount) * 100 > (currentUser?.flower_coins || 0)) {
                showToast('万花币不足');
                return;
            }
            
            showLoading();
            
            try {
                const data = await apiRequest('/api/withdrawal', {
                    method: 'POST',
                    body: JSON.stringify({
                        amount: parseInt(amount),
                        alipayAccount,
                        realName
                    })
                });
                
                if (data.success) {
                    showToast('提现申请已提交，请等待审核');
                    
                    // 更新用户信息
                    await getUserInfo();
                    
                    // 重置表单
                    document.getElementById('withdrawalForm').reset();
                }
            } catch (error) {
                console.error('提现申请失败:', error);
            } finally {
                hideLoading();
            }
        });
        
        // 提现金额按钮
        document.querySelectorAll('.amount-button').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('.amount-button').forEach(b => {
                    b.classList.remove('active');
                });
                button.classList.add('active');
                
                document.getElementById('withdrawalAmount').value = button.dataset.amount;
            });
        });
        
        // 初始化应用
        initApp();
    </script>
</body>
</html>
